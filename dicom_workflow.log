2025-05-23 12:15:41,979 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 12:15:42,317 - __main__ - CRITICAL - Error CRÍTICO importando módulos de procesamiento: No module named 'pandas'. Asegúrate de que todos los ficheros .py estén en su sitio y sin errores de sintaxis.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 36, in <module>
    import dicom_processing_pipeline
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 8, in <module>
    import pandas as pd
ModuleNotFoundError: No module named 'pandas'
2025-05-23 12:15:54,601 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 12:15:56,580 - __main__ - CRITICAL - Error CRÍTICO importando módulos de procesamiento: No module named 'pydicom'. Asegúrate de que todos los ficheros .py estén en su sitio y sin errores de sintaxis.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 36, in <module>
    import dicom_processing_pipeline
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 9, in <module>
    import pydicom
ModuleNotFoundError: No module named 'pydicom'
2025-05-23 12:17:29,555 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 12:17:31,108 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 12:17:31,433 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 12:17:31,624 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 12:17:31,624 - config - WARNING - CONFIG WARNING: Fichero CSV de calibración LUT Kerma no encontrado en la ruta esperada: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 12:17:31,625 - config - WARNING - CONFIG WARNING: Fichero CSV de linealización física no encontrado en la ruta esperada: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 12:17:31,625 - __main__ - CRITICAL - Abortando debido a errores de configuración de rutas (detectados por config.check_paths()).
2025-05-23 12:17:56,575 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 12:17:57,483 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 12:17:57,828 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 12:17:57,899 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 12:17:57,900 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 12:17:57,902 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 12:17:57,902 - __main__ - INFO - Clasificación BAML se ejecutará en modo SIMULADO (según baml_classification.py).
2025-05-23 12:17:57,902 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 12:17:57,935 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 12:17:57,935 - __main__ - INFO - Cargando datos de calibración para Linealización Física desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 12:17:57,937 - linealize - INFO - Datos de calibración VMP vs K (para linealización física) cargados desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 12:17:57,938 - __main__ - INFO - Se usarán datos para linealización física con RQA: RQA5
2025-05-23 12:17:57,938 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 12:17:57,939 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 12:17:57,939 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 12:17:57,977 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 12:17:57,977 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML (simulada)...
2025-05-23 12:17:59,019 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 12:17:59,030 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 12:18:03,988 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 12:18:03,988 - __main__ - INFO - Clasificación BAML (simulada) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 12:18:03,989 - __main__ - INFO - Calculando pendiente de linealización física para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm (RQA: RQA5)...
2025-05-23 12:18:03,994 - linealize - INFO - Pendiente de linealización calculada para RQA5: 1.600874e+03
2025-05-23 12:18:03,994 - __main__ - INFO - Pendiente de linealización física calculada para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 1.6009e+03
2025-05-23 12:18:03,994 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 12:18:03,994 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 12:18:03,994 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 12:18:03,995 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 12:18:03,995 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 12:18:03,995 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Añadiendo parámetros de linealización física a cabecera: RQA=RQA5, Pendiente=1.6009e+03
2025-05-23 12:18:03,996 - linealize - INFO - Parámetros de linealización (RQA=RQA5, Pendiente=1.6009e+03) añadidos al dataset DICOM en bloque privado (Grupo:0x00F1, Creador:'MIAPP_LINFO_V1').
2025-05-23 12:18:03,996 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 12:18:04,003 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 12:18:04,003 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 12:18:04,051 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:18:04,051 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:18:04,052 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:18:04,052 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 12:18:04,053 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 12:18:04,058 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:18:04,061 - pynetdicom.association - INFO - Requesting Association
2025-05-23 12:18:04,077 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 12:18:04,077 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 12:18:04,096 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 12:18:04,429 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 12:18:04,431 - pacs_operations - INFO - ÉXITO: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 12:18:04,433 - pynetdicom.association - INFO - Releasing Association
2025-05-23 12:18:04,447 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 12:18:04,448 - __main__ - INFO - Todos los ficheros procesados fueron enviados (o intentados enviar) a PACS con un estado C-STORE exitoso (revisa logs de pacs_operations para detalles por fichero).
2025-05-23 12:18:04,448 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 12:18:04,455 - __main__ - INFO - Aplicación finalizada.
2025-05-23 12:48:43,163 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 12:48:45,537 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 12:48:46,258 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 12:48:46,428 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 12:48:46,428 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 12:48:46,440 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 12:48:46,440 - __main__ - INFO - Clasificación BAML se ejecutará en modo SIMULADO (según baml_classification.py).
2025-05-23 12:48:46,441 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 12:48:46,552 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 12:48:46,552 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 12:48:46,552 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 12:48:46,553 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 12:48:46,553 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 12:48:46,957 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 12:48:46,957 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML (simulada)...
2025-05-23 12:48:48,396 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 12:48:48,451 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 12:48:53,318 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 12:48:53,319 - __main__ - INFO - Clasificación BAML (simulada) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 12:48:53,319 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 12:48:53,319 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 12:48:53,319 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 12:48:53,320 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 12:48:53,320 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 12:48:53,320 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 12:48:53,320 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 12:48:53,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 12:48:53,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 12:48:53,368 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:48:53,368 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:48:53,368 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:48:53,368 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 12:48:53,369 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 12:48:53,372 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 12:48:53,376 - pynetdicom.association - INFO - Requesting Association
2025-05-23 12:48:53,385 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 12:48:53,385 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 12:48:53,409 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 12:48:54,282 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 12:48:54,282 - pacs_operations - INFO - ÉXITO: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 12:48:54,284 - pynetdicom.association - INFO - Releasing Association
2025-05-23 12:48:54,287 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 12:48:54,287 - __main__ - INFO - Todos los ficheros procesados fueron enviados (o intentados enviar) a PACS con un estado C-STORE exitoso (revisa logs de pacs_operations para detalles por fichero).
2025-05-23 12:48:54,287 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 12:48:54,290 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:01:36,241 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:01:37,164 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:01:37,516 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:01:37,572 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:01:37,573 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:01:37,573 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:01:37,573 - __main__ - INFO - Clasificación BAML se ejecutará en modo SIMULADO (según baml_classification.py).
2025-05-23 13:01:37,574 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:01:37,578 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:01:37,578 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:01:37,579 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:01:37,579 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:01:37,579 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:01:37,596 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:01:37,596 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML (simulada)...
2025-05-23 13:01:38,568 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:01:38,570 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:01:42,277 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:01:42,278 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 13:01:42,280 - __main__ - INFO - Clasificación BAML (simulada) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'FDT'
2025-05-23 13:01:42,280 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:01:42,281 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:01:42,281 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 132, in process_single_dicom_file
    output_dicom_filepath = dicom_processing_pipeline.process_and_prepare_dicom_for_pacs(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml'
2025-05-23 13:01:42,283 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 13:01:42,283 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:01:42,286 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:03:07,159 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:03:07,964 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:03:08,271 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:03:08,329 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:03:08,330 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:03:08,330 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:03:08,330 - __main__ - INFO - Clasificación BAML se ejecutará en modo SIMULADO (según baml_classification.py).
2025-05-23 13:03:08,331 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:03:08,336 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:03:08,336 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:03:08,336 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:03:08,336 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:03:08,337 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:03:08,352 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:03:08,352 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML (simulada)...
2025-05-23 13:03:09,289 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:03:09,290 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:03:13,242 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:03:13,242 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 13:03:13,243 - __main__ - INFO - Clasificación BAML (simulada) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'FDT'
2025-05-23 13:03:13,243 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:03:13,243 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:03:13,243 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:03:13,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 13:03:13,244 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 13:03:13,244 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Sobrescribiendo 'SeriesDescription' con nueva clasificación BAML: 'FDT'
2025-05-23 13:03:13,244 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Valor: 'FDT'
2025-05-23 13:03:13,244 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:03:13,245 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 13:03:13,246 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 13:03:13,302 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:03:13,302 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:03:13,303 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:03:13,303 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 13:03:13,303 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 13:03:13,309 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:03:13,310 - pynetdicom.association - INFO - Requesting Association
2025-05-23 13:03:13,318 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 13:03:13,318 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 13:03:13,356 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 13:03:13,356 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 13:03:13,363 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 13:03:13,363 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 109, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 13:03:13,381 - pynetdicom.association - INFO - Releasing Association
2025-05-23 13:03:13,385 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 13:03:13,385 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 13:03:13,385 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:03:13,386 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:04:00,949 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:04:01,814 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:04:02,123 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:04:02,177 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:04:02,178 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:04:02,178 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:04:02,179 - __main__ - INFO - Clasificación BAML se ejecutará en modo SIMULADO (según baml_classification.py).
2025-05-23 13:04:02,179 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:04:02,183 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:04:02,183 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:04:02,183 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:04:02,184 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:04:02,184 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:04:02,199 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:04:02,199 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML (simulada)...
2025-05-23 13:04:03,168 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:04:03,170 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:04:06,367 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:04:06,367 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 13:04:06,368 - __main__ - INFO - Clasificación BAML (simulada) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'FDT'
2025-05-23 13:04:06,368 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:04:06,368 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:04:06,368 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:04:06,368 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 13:04:06,369 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 13:04:06,369 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Sobrescribiendo 'SeriesDescription' con nueva clasificación BAML: 'FDT'
2025-05-23 13:04:06,369 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Valor: 'FDT'
2025-05-23 13:04:06,369 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:04:06,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 13:04:06,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 13:04:06,464 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:04:06,464 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:04:06,465 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:04:06,465 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 13:04:06,465 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 13:04:06,468 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:04:06,513 - pynetdicom.association - INFO - Requesting Association
2025-05-23 13:04:06,520 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 13:04:06,521 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 13:04:06,532 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 13:04:06,532 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 13:04:06,534 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 13:04:06,536 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 109, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 13:04:06,540 - pynetdicom.association - INFO - Releasing Association
2025-05-23 13:04:06,554 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 13:04:06,554 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 13:04:06,554 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:04:06,556 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:10:50,046 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:10:51,184 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:10:51,546 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:10:51,609 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:10:51,610 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:10:51,610 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:10:51,610 - __main__ - INFO - Clasificación BAML se ejecutará en modo SIMULADO (según baml_classification.py).
2025-05-23 13:10:51,611 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:10:51,615 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:10:51,615 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:10:51,615 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:10:51,616 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:10:51,616 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:10:51,643 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:10:51,643 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML (simulada)...
2025-05-23 13:10:52,715 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:10:52,717 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:10:56,079 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:10:56,080 - __main__ - INFO - Clasificación BAML (simulada) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 13:10:56,081 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:10:56,081 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:10:56,082 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml_mapeada'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 132, in process_single_dicom_file
    output_dicom_filepath = dicom_processing_pipeline.process_and_prepare_dicom_for_pacs(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml_mapeada'
2025-05-23 13:10:56,084 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 13:10:56,084 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:10:56,087 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:13:16,084 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:13:16,886 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:13:17,198 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:13:17,256 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:13:17,256 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:13:17,256 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:13:17,257 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:13:17,261 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:13:17,261 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:13:17,262 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:13:17,262 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:13:17,262 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:13:17,279 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:13:17,280 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 13:13:18,228 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:13:18,231 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:13:21,708 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:13:21,709 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 13:13:21,709 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:13:21,710 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:13:21,711 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:13:21,711 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 13:13:21,713 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 13:13:21,713 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Nuevo valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 13:13:21,714 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:13:21,715 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 13:13:21,715 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 13:13:21,752 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:13:21,752 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:13:21,753 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:13:21,753 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 13:13:21,753 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 13:13:21,756 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:13:21,791 - pynetdicom.association - INFO - Requesting Association
2025-05-23 13:13:21,800 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 13:13:21,801 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 13:13:21,812 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 13:13:21,812 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 13:13:21,814 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 13:13:21,814 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 109, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 13:13:21,816 - pynetdicom.association - INFO - Releasing Association
2025-05-23 13:13:21,819 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 13:13:21,820 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 13:13:21,820 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:13:21,821 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:58:52,567 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:58:54,475 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:58:54,798 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:58:54,879 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:58:54,880 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:58:54,881 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:58:54,881 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:58:54,904 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:58:54,904 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:58:54,905 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:58:54,905 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:58:54,905 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:58:54,969 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:58:54,969 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 13:58:55,964 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:58:55,972 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:59:04,571 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:59:04,573 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 13:59:04,573 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:59:04,574 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:59:04,574 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:59:04,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 13:59:04,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 13:59:04,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Nuevo valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 13:59:04,577 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:59:04,591 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 13:59:04,591 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 13:59:04,730 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:04,730 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:04,731 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:04,732 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 13:59:04,733 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 13:59:04,824 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:04,829 - pynetdicom.association - INFO - Requesting Association
2025-05-23 13:59:04,854 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 13:59:04,856 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 13:59:04,884 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 13:59:04,884 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 13:59:04,889 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 13:59:04,889 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 13:59:04,893 - pynetdicom.association - INFO - Releasing Association
2025-05-23 13:59:04,897 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 13:59:04,897 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 13:59:04,897 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:59:04,898 - __main__ - INFO - Aplicación finalizada.
2025-05-23 13:59:40,111 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 13:59:40,925 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 13:59:41,238 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 13:59:41,295 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 13:59:41,296 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 13:59:41,297 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:59:41,297 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 13:59:41,300 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 13:59:41,300 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 13:59:41,301 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 13:59:41,301 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 13:59:41,302 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:59:41,318 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 13:59:41,319 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 13:59:42,244 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 13:59:42,246 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 13:59:45,667 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 13:59:45,669 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 13:59:45,669 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 13:59:45,669 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 13:59:45,670 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:59:45,671 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 13:59:45,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 13:59:45,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Nuevo valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 13:59:45,673 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 13:59:45,676 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 13:59:45,676 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 13:59:45,745 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:45,745 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:45,745 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:45,746 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 13:59:45,746 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 13:59:45,750 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 13:59:45,752 - pynetdicom.association - INFO - Requesting Association
2025-05-23 13:59:45,759 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 13:59:45,759 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 13:59:45,770 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 13:59:45,771 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 13:59:45,773 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 13:59:45,773 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 13:59:45,775 - pynetdicom.association - INFO - Releasing Association
2025-05-23 13:59:45,779 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 13:59:45,779 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 13:59:45,780 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 13:59:45,782 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:02:34,480 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:02:35,323 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:02:35,635 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:02:35,693 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:02:35,694 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:02:35,694 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:02:35,694 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:02:35,698 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:02:35,698 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:02:35,699 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:02:35,699 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:02:35,699 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:02:35,717 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:02:35,717 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:02:36,676 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:02:36,679 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:02:40,597 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:02:40,597 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:02:40,597 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:02:40,597 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:02:40,598 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml_original'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 116, in process_single_dicom_file
    output_dicom_filepath = dicom_processing_pipeline.process_and_prepare_dicom_for_pacs(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml_original'
2025-05-23 14:02:40,598 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:02:40,598 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:02:40,601 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:05:57,792 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:05:58,679 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:05:59,007 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:05:59,067 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:05:59,068 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:05:59,069 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:05:59,069 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:05:59,074 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:05:59,074 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:05:59,074 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:05:59,074 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:05:59,075 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:05:59,091 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:05:59,091 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:06:00,076 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:06:00,078 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:06:04,407 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:06:04,408 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:06:04,408 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:06:04,408 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:06:04,408 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: name 'clasificacion_baml_final' is not defined
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 118, in process_single_dicom_file
    clasificacion_baml_mapeada=clasificacion_baml_final, # <--- USAR ESTE NOMBRE
                               ^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'clasificacion_baml_final' is not defined. Did you mean: 'clasificacion_baml_original'?
2025-05-23 14:06:04,410 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:06:04,411 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:06:04,414 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:07:46,600 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:07:47,392 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:07:47,709 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:07:47,763 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:07:47,764 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:07:47,764 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:07:47,764 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:07:47,768 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:07:47,768 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:07:47,769 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:07:47,769 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:07:47,769 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:07:47,784 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:07:47,784 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:07:48,743 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:07:48,745 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:07:52,063 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:07:52,064 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:07:52,065 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:07:52,065 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:07:52,066 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:07:52,067 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:07:52,068 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:07:52,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Sobrescribiendo 'SeriesDescription' con nueva clasificación BAML (mapeada): 'Type1'
2025-05-23 14:07:52,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Valor: 'Type1'
2025-05-23 14:07:52,070 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:07:52,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:07:52,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:07:52,071 - dicom_processing_pipeline - WARNING - Componente de ImageType '['ORIGINAL', 'PRIMARY', '']' contiene caracteres no válidos para CS. Se omite o se limpia (actualmente se omite).
2025-05-23 14:07:52,072 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType quedó vacío después de sanear. Estableciendo a ['DERIVED', 'SECONDARY'].
2025-05-23 14:07:52,072 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 100'.
2025-05-23 14:07:52,119 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:07:52,120 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:07:52,120 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:07:52,120 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 14:07:52,121 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:07:52,124 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:07:52,126 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:07:52,133 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:07:52,134 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:07:52,147 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:07:52,147 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:07:52,149 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:07:52,150 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:07:52,154 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:07:52,162 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:07:52,162 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 14:07:52,162 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:07:52,164 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:11:20,533 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:11:21,409 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:11:21,722 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:11:21,777 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:11:21,777 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:11:21,778 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:11:21,778 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:11:21,782 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:11:21,782 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:11:21,782 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:11:21,783 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:11:21,783 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:11:21,800 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:11:21,800 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:11:22,749 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:11:22,751 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:11:27,320 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:11:27,321 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:11:27,321 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:11:27,321 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:11:27,322 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:11:27,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:11:27,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:11:27,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Sobrescribiendo 'SeriesDescription' con nueva clasificación BAML (mapeada): 'Type1'
2025-05-23 14:11:27,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Valor: 'Type1'
2025-05-23 14:11:27,323 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:11:27,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:11:27,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:11:27,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Forzando ImageType a un valor conocido y válido para prueba.
2025-05-23 14:11:27,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType forzado a: ['ORIGINAL', 'PRIMARY', 'AXIAL_RFB']
2025-05-23 14:11:27,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 100'.
2025-05-23 14:11:27,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:11:27,379 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:11:27,379 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:11:27,380 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 14:11:27,380 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:11:27,384 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:11:27,386 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:11:27,394 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:11:27,395 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:11:27,409 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:11:27,416 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:11:27,418 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:11:27,418 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:11:27,421 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:11:27,447 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:11:27,447 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 14:11:27,447 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:11:27,450 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:14:46,189 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:14:47,016 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:14:47,324 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:14:47,378 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:14:47,379 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:14:47,379 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:14:47,379 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:14:47,383 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:14:47,383 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:14:47,384 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:14:47,384 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:14:47,384 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:14:47,399 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:14:47,399 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:14:48,322 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:14:48,324 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:14:51,817 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:14:51,818 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:14:51,818 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:14:51,818 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:14:51,818 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:14:51,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:14:51,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:14:51,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Sobrescribiendo 'SeriesDescription' con nueva clasificación BAML (mapeada): 'Type1'
2025-05-23 14:14:51,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' actualizada con BAML. Valor: 'Type1'
2025-05-23 14:14:51,820 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:14:51,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:14:51,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:14:51,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:14:51,822 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType forzado a: ['ORIGINAL', 'PRIMARY', 'AXIAL_RFB_V2']
2025-05-23 14:14:51,822 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 100'.
2025-05-23 14:14:51,880 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:14:51,880 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:14:51,880 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:14:51,880 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 14:14:51,881 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:14:51,884 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:14:51,886 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:14:51,894 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:14:51,895 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:14:51,906 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:14:51,907 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:14:51,909 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:14:51,909 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:14:51,912 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:14:51,926 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:14:51,926 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 14:14:51,926 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:14:51,928 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:22:38,230 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:22:39,059 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:22:39,371 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:22:39,428 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:22:39,428 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:22:39,429 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:22:39,429 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:22:39,433 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:22:39,434 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:22:39,434 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:22:39,434 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:22:39,435 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:22:39,455 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:22:39,455 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:22:40,468 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:22:40,470 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:22:43,960 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:22:43,961 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:22:43,961 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:22:43,961 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:22:43,962 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'pixel_values_lut_calib'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 116, in process_single_dicom_file
    output_dicom_filepath = dicom_processing_pipeline.process_and_prepare_dicom_for_pacs(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'pixel_values_lut_calib'
2025-05-23 14:22:43,963 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:22:43,963 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:22:43,968 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:23:03,555 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:23:04,377 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:23:04,716 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:23:04,775 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:23:04,776 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:23:04,776 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:23:04,777 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:23:04,780 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:23:04,781 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:23:04,781 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:23:04,781 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:23:04,781 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:23:04,797 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:23:04,797 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:23:05,728 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:23:05,730 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:23:09,228 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:23:09,228 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:23:09,229 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:23:09,229 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:23:09,229 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'pixel_values_lut_calib'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 116, in process_single_dicom_file
    output_dicom_filepath = dicom_processing_pipeline.process_and_prepare_dicom_for_pacs(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'pixel_values_lut_calib'
2025-05-23 14:23:09,229 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:23:09,230 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:23:09,232 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:25:20,776 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:25:21,612 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:25:21,929 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:25:21,985 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:25:21,986 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:25:21,986 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:25:21,987 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:25:21,990 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:25:21,991 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:25:21,991 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:25:21,991 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:25:21,992 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:25:22,007 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:25:22,008 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:25:22,929 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:25:22,930 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:25:26,609 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:25:26,610 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:25:26,610 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:25:26,611 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:25:26,611 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:25:26,612 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:25:26,613 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:25:26,614 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Estableciendo 'SeriesDescription' a: 'Type1'
2025-05-23 14:25:26,614 - dicom_processing_pipeline - ERROR - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Error al establecer el tag 'SeriesDescription' con valor 'Type1': 'dict' object is not callable
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 216, in process_and_prepare_dicom_for_pacs
    if tag_keyword_clasificacion in pydicom.datadict.keyword_dict():
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable
2025-05-23 14:25:26,615 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:25:26,617 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:25:26,617 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:25:26,617 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType (0008,0008) original eliminado para recreación.
2025-05-23 14:25:26,618 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMAGE_PROC_FINAL']
2025-05-23 14:25:26,618 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 100'.
2025-05-23 14:25:26,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:25:26,661 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:25:26,661 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:25:26,661 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 14:25:26,662 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:25:26,666 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:25:26,668 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:25:26,677 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:25:26,678 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:25:26,688 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:25:26,689 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:25:26,692 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:25:26,692 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:25:26,698 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:25:26,712 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:25:26,712 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 14:25:26,712 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:25:26,715 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:28:38,308 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:28:39,139 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:28:39,446 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:28:39,501 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:28:39,502 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:28:39,503 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:28:39,503 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:28:39,506 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:28:39,507 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:28:39,507 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:28:39,507 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:28:39,508 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:28:39,525 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:28:39,525 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:28:40,584 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:28:40,586 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:28:44,826 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:28:44,827 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:28:44,827 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:28:44,827 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:28:44,827 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:28:44,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:28:44,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:28:44,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Estableciendo 'SeriesDescription' a: 'Type1'
2025-05-23 14:28:44,827 - dicom_processing_pipeline - ERROR - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Error al establecer el tag 'SeriesDescription' con valor 'Type1': 'dict' object is not callable
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 216, in process_and_prepare_dicom_for_pacs
    if tag_keyword_clasificacion in pydicom.datadict.keyword_dict():
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable
2025-05-23 14:28:44,831 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:28:44,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:28:44,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:28:44,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType (0008,0008) original eliminado para recreación.
2025-05-23 14:28:44,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMAGE_PROC_FINAL']
2025-05-23 14:28:44,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 100'.
2025-05-23 14:28:44,880 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:28:44,880 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:28:44,880 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:28:44,881 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 14:28:44,881 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:28:44,884 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:28:44,892 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:28:44,911 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:28:44,912 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:28:44,924 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:28:44,926 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:28:44,928 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:28:44,928 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:28:44,931 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:28:44,943 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:28:44,944 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 14:28:44,944 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:28:44,946 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:31:29,700 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:31:30,554 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:31:30,883 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:31:30,942 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:31:30,942 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:31:30,943 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:31:30,943 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:31:30,947 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:31:30,947 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:31:30,947 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:31:30,948 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:31:30,948 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:31:30,963 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:31:30,963 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:31:31,931 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:31:31,933 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:31:35,426 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:31:35,426 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:31:35,426 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:31:35,427 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:31:35,427 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:31:35,427 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:31:35,428 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:31:35,428 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Estableciendo 'SeriesDescription' a: 'Type1'
2025-05-23 14:31:35,428 - dicom_processing_pipeline - ERROR - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Error al establecer el tag 'SeriesDescription' con valor 'Type1': 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 222, in process_and_prepare_dicom_for_pacs
    valor_escrito_str = str(elemento_escrito.value) if elemento_escrito else "(Tag no encontrado después de escribir!)"
                            ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-05-23 14:31:35,430 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:31:35,431 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:31:35,431 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:31:35,431 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:31:35,440 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_PROC_FINAL_V3']
2025-05-23 14:31:35,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 100'.
2025-05-23 14:31:35,580 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:31:35,581 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:31:35,581 - __main__ - INFO - ÉXITO en procesamiento completo de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:31:35,582 - __main__ - INFO - Se procesaron 1 ficheros con éxito y existen. Iniciando envío a PACS...
2025-05-23 14:31:35,583 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:31:35,588 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:31:35,589 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:31:35,599 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:31:35,599 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:31:35,611 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:31:35,612 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:31:35,613 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:31:35,614 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:31:35,616 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:31:35,620 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:31:35,620 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado correctamente a PACS. Revisa los logs de pacs_operations para detalles por fichero.
2025-05-23 14:31:35,621 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:31:35,623 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:35:11,566 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:35:14,118 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:35:14,563 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:35:14,710 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:35:14,712 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:35:14,714 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:35:14,714 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:35:14,736 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:35:14,738 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO en la configuración.
2025-05-23 14:35:14,738 - __main__ - INFO - Se encontraron 1 ficheros/elementos para intentar procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:35:14,739 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:35:14,739 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:35:14,966 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:35:14,967 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:35:16,628 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:35:16,631 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:35:21,706 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:35:21,707 - __main__ - INFO - Clasificación BAML (original) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:35:21,707 - __main__ - INFO - Datos/parámetros para linealización física no completamente proporcionados. Omitiendo cálculo de pendiente para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm.
2025-05-23 14:35:21,707 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:35:21,707 - __main__ - ERROR - ERROR EXCEPCIÓN durante el procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml_mapeada'
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/main.py", line 116, in process_single_dicom_file
    output_dicom_filepath = dicom_processing_pipeline.process_and_prepare_dicom_for_pacs(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: process_and_prepare_dicom_for_pacs() got an unexpected keyword argument 'clasificacion_baml_mapeada'
2025-05-23 14:35:21,708 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:35:21,708 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM =====
2025-05-23 14:35:21,712 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:45:02,465 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:45:03,942 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:45:04,352 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:45:04,629 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:45:04,629 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:45:04,647 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:45:04,647 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:45:04,684 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:45:04,684 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:45:04,685 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:45:04,685 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:45:04,685 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:45:04,825 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:45:04,825 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:45:06,088 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:45:06,090 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:45:10,026 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:45:10,027 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:45:10,028 - __main__ - INFO - Linealización física omitida para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm (desactivada o datos insuficientes).
2025-05-23 14:45:10,028 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:45:10,029 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:45:10,030 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:45:10,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:45:10,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:45:10,033 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:45:10,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:45:10,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:45:10,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:45:10,049 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:45:10,050 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:45:10,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:10,442 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:10,443 - __main__ - INFO - ÉXITO en procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:10,443 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:45:10,444 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:45:10,453 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:10,457 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:45:11,801 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:45:11,802 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:45:11,826 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:45:11,826 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:45:11,831 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:45:11,831 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:45:11,851 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:45:11,866 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:45:11,866 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-23 14:45:11,866 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:45:11,867 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:45:52,858 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:45:53,689 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:45:54,008 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:45:54,061 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:45:54,062 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:45:54,062 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:45:54,062 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:45:54,069 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:45:54,069 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:45:54,069 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:45:54,070 - __main__ - INFO - --- Iniciando procesamiento para: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm ---
2025-05-23 14:45:54,070 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:45:54,087 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm
2025-05-23 14:45:54,087 - __main__ - INFO - Enviando imagen Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm para clasificación BAML...
2025-05-23 14:45:55,046 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:45:55,047 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:45:58,669 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:45:58,669 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm: 'Type1'
2025-05-23 14:45:58,669 - __main__ - INFO - Linealización física omitida para Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm (desactivada o datos insuficientes).
2025-05-23 14:45:58,670 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm...
2025-05-23 14:45:58,670 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:45:58,670 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientID establecido/actualizado a: SN2133ED
2025-05-23 14:45:58,670 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PatientName establecido/actualizado a: DiDiDR01_Paret
2025-05-23 14:45:58,671 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:45:58,671 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1
2025-05-23 14:45:58,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:45:58,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] LUT Kerma aplicada.
2025-05-23 14:45:58,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:45:58,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:45:58,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:45:58,724 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484478897.1718618427268.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:58,725 - __main__ - INFO - Fichero Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm procesado y guardado como: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:58,725 - __main__ - INFO - ÉXITO en procesamiento de Img0__SN2133ED__KVP=73__mAs=2.0__IE=95.dcm -> Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:58,725 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:45:58,726 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:45:58,730 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm
2025-05-23 14:45:58,731 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:45:58,740 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:45:58,741 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:45:58,754 - pynetdicom.dsutils - ERROR - pydicom.write_dataset() failed:
2025-05-23 14:45:58,754 - pynetdicom.dsutils - ERROR - With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/dsutils.py", line 162, in encode
    write_dataset(fp, ds)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 659, in write_dataset
    with tag_in_exception(tag):
         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 32, in tag_in_exception
    raise type(exc)(msg) from exc
TypeError: With tag (0008, 0008) got exception: encoding without a string argument
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/tag.py", line 28, in tag_in_exception
    yield
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 660, in write_dataset
    write_data_element(fp, dataset.get_item(tag), dataset_encoding)
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/filewriter.py", line 604, in write_data_element
    fp.write(bytes(vr, default_encoding))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: encoding without a string argument

2025-05-23 14:45:58,757 - pynetdicom.association - ERROR - Failed to encode the supplied dataset
2025-05-23 14:45:58,757 - pacs_operations - ERROR - ERROR DE CODIFICACIÓN DEL DATASET para Img1_SN2133ED_KVP73_mAs1.98_IE95.dcm antes del envío: Failed to encode the supplied dataset
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/pacs_operations.py", line 108, in _perform_pacs_send_sync
    status_store = assoc.send_c_store(filepath_str)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pynetdicom/association.py", line 1941, in send_c_store
    raise ValueError("Failed to encode the supplied dataset")
ValueError: Failed to encode the supplied dataset
2025-05-23 14:45:58,760 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:45:58,763 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 14:45:58,763 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-23 14:45:58,763 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:45:58,766 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:46:57,280 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:46:58,444 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:46:58,765 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:46:58,821 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:46:58,822 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:46:58,823 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:46:58,823 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:46:58,828 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:46:58,828 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:46:58,828 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:46:58,828 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1 ---
2025-05-23 14:46:58,828 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1
2025-05-23 14:46:58,832 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 14:46:58,833 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. GDCM), pylibjpeg (req. ). 
2025-05-23 14:46:58,833 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. GDCM), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 74, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. GDCM), pylibjpeg (req. )
2025-05-23 14:46:58,847 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1. Omitiendo.
2025-05-23 14:46:58,847 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1 no generó fichero de salida.
2025-05-23 14:46:58,848 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:46:58,848 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:46:58,848 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:47:28,251 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:47:29,600 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:47:29,910 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:47:29,965 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:47:29,966 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:47:29,967 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:47:29,967 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:47:29,972 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:47:29,972 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:47:29,972 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:47:29,973 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1 ---
2025-05-23 14:47:29,973 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1
2025-05-23 14:47:29,976 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 14:47:29,977 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-23 14:47:29,978 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 74, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-23 14:47:29,980 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1. Omitiendo.
2025-05-23 14:47:29,980 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635482625724.1709552753745.1 no generó fichero de salida.
2025-05-23 14:47:29,980 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:47:29,980 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:47:29,981 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:48:23,581 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:48:24,476 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:48:24,787 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:48:24,846 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:48:24,846 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:48:24,847 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:48:24,847 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:48:24,851 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:48:24,851 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:48:24,852 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:48:24,852 - __main__ - INFO - --- Iniciando procesamiento para: Img0.dcm ---
2025-05-23 14:48:24,852 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0.dcm
2025-05-23 14:48:24,873 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0.dcm
2025-05-23 14:48:24,873 - __main__ - INFO - Enviando imagen Img0.dcm para clasificación BAML...
2025-05-23 14:48:25,804 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:48:25,806 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:48:31,537 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:48:31,537 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para Img0.dcm: 'Type1'
2025-05-23 14:48:31,537 - __main__ - INFO - Linealización física omitida para Img0.dcm (desactivada o datos insuficientes).
2025-05-23 14:48:31,538 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0.dcm...
2025-05-23 14:48:31,538 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:48:31,538 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 14:48:31,538 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 14:48:31,539 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:48:31,539 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:48:31,540 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:48:31,540 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] LUT Kerma aplicada.
2025-05-23 14:48:31,541 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:48:31,541 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:48:31,542 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:48:31,602 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:48:31,603 - __main__ - INFO - Fichero Img0.dcm procesado y guardado como: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:48:31,603 - __main__ - INFO - ÉXITO en procesamiento de Img0.dcm -> Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:48:31,603 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:48:31,603 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:48:31,607 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:48:31,609 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:48:31,628 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:48:31,629 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:48:31,659 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 14:48:32,226 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 14:48:32,229 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 14:48:32,230 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:48:32,247 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 14:48:32,248 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 14:48:32,248 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:48:32,252 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:49:13,914 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:49:14,837 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:49:15,165 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:49:15,223 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:49:15,224 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:49:15,224 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:49:15,224 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:49:15,228 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:49:15,228 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:49:15,229 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:49:15,229 - __main__ - INFO - --- Iniciando procesamiento para: Img0.dcm ---
2025-05-23 14:49:15,229 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0.dcm
2025-05-23 14:49:15,246 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0.dcm
2025-05-23 14:49:15,246 - __main__ - INFO - Enviando imagen Img0.dcm para clasificación BAML...
2025-05-23 14:49:16,186 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:49:16,188 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:49:20,763 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:49:20,763 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para Img0.dcm: 'Type1'
2025-05-23 14:49:20,764 - __main__ - INFO - Linealización física omitida para Img0.dcm (desactivada o datos insuficientes).
2025-05-23 14:49:20,764 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0.dcm...
2025-05-23 14:49:20,764 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:49:20,764 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 14:49:20,765 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 14:49:20,765 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:49:20,765 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:49:20,766 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:49:20,766 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] LUT Kerma aplicada.
2025-05-23 14:49:20,767 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:49:20,767 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:49:20,768 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:49:20,816 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:49:20,817 - __main__ - INFO - Fichero Img0.dcm procesado y guardado como: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:49:20,817 - __main__ - INFO - ÉXITO en procesamiento de Img0.dcm -> Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:49:20,817 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:49:20,817 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:49:20,820 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:49:20,822 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:49:20,829 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:49:20,830 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:49:20,856 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 14:49:21,191 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 14:49:21,192 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 14:49:21,194 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:49:21,207 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 14:49:21,207 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 14:49:21,208 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:49:21,211 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:50:11,731 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:50:12,871 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:50:13,291 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:50:13,357 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:50:13,358 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:50:13,358 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:50:13,358 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:50:13,364 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:50:13,365 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:50:13,365 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:50:13,366 - __main__ - INFO - --- Iniciando procesamiento para: Img0.dcm ---
2025-05-23 14:50:13,366 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0.dcm
2025-05-23 14:50:13,386 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0.dcm
2025-05-23 14:50:13,386 - __main__ - INFO - Enviando imagen Img0.dcm para clasificación BAML...
2025-05-23 14:50:14,509 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:50:14,512 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:50:19,286 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:50:19,287 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para Img0.dcm: 'Type1'
2025-05-23 14:50:19,287 - __main__ - INFO - Linealización física omitida para Img0.dcm (desactivada o datos insuficientes).
2025-05-23 14:50:19,287 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0.dcm...
2025-05-23 14:50:19,287 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:50:19,288 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 14:50:19,288 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 14:50:19,288 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:50:19,288 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:50:19,290 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:50:19,290 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] LUT Kerma aplicada.
2025-05-23 14:50:19,290 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:50:19,291 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:50:19,291 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:50:19,338 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:50:19,338 - __main__ - INFO - Fichero Img0.dcm procesado y guardado como: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:50:19,338 - __main__ - INFO - ÉXITO en procesamiento de Img0.dcm -> Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:50:19,338 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:50:19,339 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:50:19,343 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:50:19,345 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:50:19,359 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:50:19,359 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:50:19,383 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 14:50:19,700 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 14:50:19,701 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 14:50:19,703 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:50:19,708 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 14:50:19,708 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 14:50:19,708 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:50:19,711 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:51:03,446 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:51:04,462 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:51:04,814 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:51:04,879 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:51:04,880 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:51:04,882 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:51:04,882 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:51:04,887 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:51:04,887 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:51:04,888 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:51:04,888 - __main__ - INFO - --- Iniciando procesamiento para: Img0.dcm ---
2025-05-23 14:51:04,888 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img0.dcm
2025-05-23 14:51:04,906 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img0.dcm
2025-05-23 14:51:04,906 - __main__ - INFO - Enviando imagen Img0.dcm para clasificación BAML...
2025-05-23 14:51:06,078 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:51:06,080 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:51:09,696 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:51:09,697 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para Img0.dcm: 'Type1'
2025-05-23 14:51:09,697 - __main__ - INFO - Linealización física omitida para Img0.dcm (desactivada o datos insuficientes).
2025-05-23 14:51:09,698 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img0.dcm...
2025-05-23 14:51:09,698 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:51:09,698 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 14:51:09,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 14:51:09,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:51:09,699 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1
2025-05-23 14:51:09,702 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:51:09,702 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] LUT Kerma aplicada.
2025-05-23 14:51:09,702 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:51:09,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:51:09,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:51:09,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1684750054558.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:51:09,757 - __main__ - INFO - Fichero Img0.dcm procesado y guardado como: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:51:09,757 - __main__ - INFO - ÉXITO en procesamiento de Img0.dcm -> Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:51:09,758 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:51:09,758 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:51:09,761 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm
2025-05-23 14:51:09,765 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:51:09,858 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:51:09,858 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:51:09,881 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 14:51:10,174 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 14:51:10,174 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP73_mAs0.78_IE50.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 14:51:10,176 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:51:10,179 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 14:51:10,180 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 14:51:10,180 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:51:10,181 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:54:00,498 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:54:01,356 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:54:01,675 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:54:01,735 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:54:01,736 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:54:01,737 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:54:01,737 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:54:01,744 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:54:01,744 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:54:01,744 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:54:01,744 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 14:54:01,745 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:54:01,748 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 14:54:01,749 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-23 14:54:01,749 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 74, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-23 14:54:01,751 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1. Omitiendo.
2025-05-23 14:54:01,751 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 no generó fichero de salida.
2025-05-23 14:54:01,751 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:54:01,751 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:54:01,752 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:54:16,400 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:54:17,227 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:54:17,539 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:54:17,595 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:54:17,596 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:54:17,597 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:54:17,597 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:54:17,600 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:54:17,601 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:54:17,601 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:54:17,601 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 14:54:17,602 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:54:17,605 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 14:54:17,606 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-23 14:54:17,606 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/dicom_processing_pipeline.py", line 74, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-23 14:54:17,608 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1. Omitiendo.
2025-05-23 14:54:17,609 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 no generó fichero de salida.
2025-05-23 14:54:17,609 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-23 14:54:17,609 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:54:17,610 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:55:21,224 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:55:22,398 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:55:22,760 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:55:22,817 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:55:22,818 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:55:22,819 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:55:22,819 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:55:22,823 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:55:22,824 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:55:22,824 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:55:22,825 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 14:55:22,825 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:55:22,829 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 14:55:23,386 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 descomprimido exitosamente.
2025-05-23 14:55:23,386 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:55:23,387 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 para clasificación BAML...
2025-05-23 14:55:24,368 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:55:24,369 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:55:27,795 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:55:27,796 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: 'Type1'
2025-05-23 14:55:27,796 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 (desactivada o datos insuficientes).
2025-05-23 14:55:27,797 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1...
2025-05-23 14:55:27,797 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:55:27,798 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientID establecido/actualizado a: SN1946CP
2025-05-23 14:55:27,799 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientName establecido/actualizado a: ARDX134107_Taula
2025-05-23 14:55:27,799 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:55:27,800 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:55:27,803 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:55:27,804 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] LUT Kerma aplicada.
2025-05-23 14:55:27,804 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:55:27,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:55:27,810 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:55:27,882 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:55:27,882 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 procesado y guardado como: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:55:27,883 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 -> Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:55:27,883 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:55:27,883 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:55:27,886 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:55:27,889 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:55:27,897 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:55:27,898 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:55:27,919 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 14:55:28,231 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 14:55:28,232 - pacs_operations - INFO - ÉXITO: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 14:55:28,234 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:55:28,238 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 14:55:28,238 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 14:55:28,238 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:55:28,240 - __main__ - INFO - Aplicación finalizada.
2025-05-23 14:58:26,221 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 14:58:27,406 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 14:58:27,716 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 14:58:27,771 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 14:58:27,772 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 14:58:27,773 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:58:27,773 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 14:58:27,777 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 14:58:27,777 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 14:58:27,777 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 14:58:27,778 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 14:58:27,778 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:58:27,781 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 14:58:28,307 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 descomprimido exitosamente.
2025-05-23 14:58:28,308 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:58:28,308 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 para clasificación BAML...
2025-05-23 14:58:29,280 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 14:58:29,281 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 14:58:32,326 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 14:58:32,327 - __main__ - INFO - Clasificación BAML (original, sin mapeo) para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: 'Type1'
2025-05-23 14:58:32,327 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 (desactivada o datos insuficientes).
2025-05-23 14:58:32,327 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1...
2025-05-23 14:58:32,327 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:58:32,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientID establecido/actualizado a: SN1946CP
2025-05-23 14:58:32,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientName establecido/actualizado a: ARDX134107_Taula
2025-05-23 14:58:32,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] 'SeriesDescription' (Tag: 528446) actualizada con BAML. Valor: 'Objeto de prueba universal | QC_Class:Type1'
2025-05-23 14:58:32,328 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 14:58:32,330 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 14:58:32,330 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] LUT Kerma aplicada.
2025-05-23 14:58:32,330 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 14:58:32,331 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] ImageType forzado a: ['DERIVED', 'PRIMARY', 'IMAGE_REPROCESSED_V_ANTERIOR']
2025-05-23 14:58:32,331 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 14:58:32,447 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:58:32,447 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 procesado y guardado como: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:58:32,455 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 -> Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:58:32,455 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 14:58:32,455 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 14:58:32,458 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 14:58:32,460 - pynetdicom.association - INFO - Requesting Association
2025-05-23 14:58:32,483 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 14:58:32,483 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm. Contextos de presentación aceptados: 7
2025-05-23 14:58:32,525 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 14:58:33,634 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 14:58:33,635 - pacs_operations - INFO - ÉXITO: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 14:58:33,636 - pynetdicom.association - INFO - Releasing Association
2025-05-23 14:58:33,652 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 14:58:33,652 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 14:58:33,652 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (VERSIÓN ANTERIOR BAML) =====
2025-05-23 14:58:33,654 - __main__ - INFO - Aplicación finalizada.
2025-05-23 15:08:51,589 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 15:08:52,603 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 15:08:52,929 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 15:08:52,994 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 15:08:52,994 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 15:08:52,995 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:08:52,995 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 15:08:53,001 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 15:08:53,001 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 15:08:53,001 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 15:08:53,002 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 15:08:53,002 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:08:53,015 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:08:53,563 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 descomprimido exitosamente.
2025-05-23 15:08:53,564 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:08:53,564 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 para clasificación BAML...
2025-05-23 15:08:54,569 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:08:54,571 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:08:57,815 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:08:57,815 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:08:57,816 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: 'FDT'
2025-05-23 15:08:57,816 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 (desactivada o datos insuficientes).
2025-05-23 15:08:57,816 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1...
2025-05-23 15:08:57,817 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:08:57,817 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientID establecido/actualizado a: SN1946CP
2025-05-23 15:08:57,818 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientName establecido/actualizado a: ARDX134107_Taula
2025-05-23 15:08:57,818 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Estableciendo (sobrescribiendo) 'SeriesDescription' a: 'FDT'
2025-05-23 15:08:57,818 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] 'SeriesDescription' después de actualizar. Valor: 'FDT'
2025-05-23 15:08:57,819 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:08:57,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:08:57,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] LUT Kerma aplicada.
2025-05-23 15:08:57,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:08:57,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:08:57,822 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:08:57,985 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:08:57,986 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 procesado y guardado como: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:08:57,986 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 -> Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:08:57,986 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 15:08:57,986 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 15:08:57,989 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:08:57,992 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:08:58,021 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:08:58,021 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:08:58,040 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:08:58,429 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:08:58,430 - pacs_operations - INFO - ÉXITO: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:08:58,432 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:08:58,436 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 15:08:58,437 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 15:08:58,437 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:08:58,440 - __main__ - INFO - Aplicación finalizada.
2025-05-23 15:13:23,394 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 15:13:24,430 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 15:13:24,779 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 15:13:24,850 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 15:13:24,851 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 15:13:24,851 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:13:24,851 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 15:13:24,858 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 15:13:24,858 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 15:13:24,858 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 15:13:24,858 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 15:13:24,858 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:13:24,864 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:13:25,460 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 descomprimido exitosamente.
2025-05-23 15:13:25,461 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:13:25,461 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 para clasificación BAML...
2025-05-23 15:13:26,641 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:13:26,643 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:13:29,625 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:13:29,625 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:13:29,625 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: 'FDT'
2025-05-23 15:13:29,626 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 (desactivada o datos insuficientes).
2025-05-23 15:13:29,626 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1...
2025-05-23 15:13:29,626 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:13:29,626 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientID establecido/actualizado a: SN1946CP
2025-05-23 15:13:29,627 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientName establecido/actualizado a: ARDX134107_Taula
2025-05-23 15:13:29,627 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Estableciendo (sobrescribiendo) 'SeriesDescription' a: 'FDT'
2025-05-23 15:13:29,628 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] 'SeriesDescription' después de actualizar. Valor: 'FDT'
2025-05-23 15:13:29,628 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:13:29,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:13:29,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] LUT Kerma aplicada.
2025-05-23 15:13:29,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:13:29,630 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:13:29,630 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:13:29,686 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:13:29,686 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 procesado y guardado como: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:13:29,686 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 -> Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:13:29,686 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 15:13:29,687 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 15:13:29,691 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:13:29,694 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:13:29,703 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:13:29,705 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:13:29,731 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:13:29,950 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:13:29,951 - pacs_operations - INFO - ÉXITO: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:13:29,952 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:13:29,967 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 15:13:29,967 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 15:13:29,967 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:13:29,968 - __main__ - INFO - Aplicación finalizada.
2025-05-23 15:21:15,419 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 15:21:16,502 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 15:21:16,876 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 15:21:16,947 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 15:21:16,947 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 15:21:16,948 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:21:16,948 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 15:21:16,953 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 15:21:16,953 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 15:21:16,954 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 15:21:16,954 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 ---
2025-05-23 15:21:16,954 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:21:16,958 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:21:17,555 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 descomprimido exitosamente.
2025-05-23 15:21:17,555 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:21:17,555 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 para clasificación BAML...
2025-05-23 15:21:18,694 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:21:18,699 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:21:21,748 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:21:21,749 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:21:21,749 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1: 'FDT'
2025-05-23 15:21:21,749 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 (desactivada o datos insuficientes).
2025-05-23 15:21:21,749 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1...
2025-05-23 15:21:21,750 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:21:21,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientID establecido/actualizado a: SN1946CP
2025-05-23 15:21:21,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PatientName establecido/actualizado a: ARDX134107_Taula
2025-05-23 15:21:21,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:21:21,751 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:21:21,751 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1
2025-05-23 15:21:21,752 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:21:21,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] LUT Kerma aplicada.
2025-05-23 15:21:21,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:21:21,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:21:21,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:21:21,799 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:21:21,799 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 procesado y guardado como: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:21:21,800 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1709552754143.1 -> Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:21:21,804 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 15:21:21,805 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 15:21:21,808 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm
2025-05-23 15:21:21,812 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:21:21,819 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:21:21,820 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:21:21,847 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:21:22,130 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:21:22,131 - pacs_operations - INFO - ÉXITO: Img5_SN1946CP_KVP73_mAs2.47_IE206.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:21:22,132 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:21:22,156 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-05-23 15:21:22,156 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 15:21:22,156 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:21:22,158 - __main__ - INFO - Aplicación finalizada.
2025-05-23 15:26:44,627 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 15:26:45,634 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 15:26:45,985 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 15:26:46,043 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 15:26:46,044 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 15:26:46,044 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:26:46,045 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 15:26:46,051 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 15:26:46,052 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 15:26:46,053 - __main__ - INFO - Se encontraron 40 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 15:26:46,053 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-05-23 15:26:46,054 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:26:46,057 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:46,610 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-05-23 15:26:46,610 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:26:46,611 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-05-23 15:26:47,599 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:47,600 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:47,600 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 ---
2025-05-23 15:26:47,611 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:26:47,616 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:48,157 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 descomprimido exitosamente.
2025-05-23 15:26:48,158 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:26:48,158 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 para clasificación BAML...
2025-05-23 15:26:49,173 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:49,173 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:49,182 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 ---
2025-05-23 15:26:49,187 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:26:49,192 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:49,725 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 descomprimido exitosamente.
2025-05-23 15:26:49,725 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:26:49,725 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 para clasificación BAML...
2025-05-23 15:26:50,678 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:50,679 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:50,680 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 ---
2025-05-23 15:26:50,694 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:26:50,698 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:50,956 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:26:50,957 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:26:51,285 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 descomprimido exitosamente.
2025-05-23 15:26:51,286 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:26:51,286 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 para clasificación BAML...
2025-05-23 15:26:52,393 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:52,393 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-05-23 15:26:52,394 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:52,394 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:26:52,405 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:52,640 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:26:52,640 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:26:52,931 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-05-23 15:26:52,931 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:26:52,931 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-05-23 15:26:53,989 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:53,990 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 ---
2025-05-23 15:26:53,990 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:53,991 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:26:54,003 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:54,344 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:26:54,345 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:26:54,780 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 descomprimido exitosamente.
2025-05-23 15:26:54,780 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:26:54,780 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 para clasificación BAML...
2025-05-23 15:26:55,883 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:26:55,884 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:26:56,561 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:56,561 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-05-23 15:26:56,561 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:56,561 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:26:56,579 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:57,175 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-05-23 15:26:57,175 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:26:57,175 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-05-23 15:26:57,580 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type3
2025-05-23 15:26:57,580 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'BC'
2025-05-23 15:26:58,090 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:26:58,090 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 ---
2025-05-23 15:26:58,090 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:26:58,090 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:26:58,109 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:26:58,611 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 descomprimido exitosamente.
2025-05-23 15:26:58,611 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:26:58,611 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 para clasificación BAML...
2025-05-23 15:27:00,262 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:00,262 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:00,262 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:00,262 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 ---
2025-05-23 15:27:00,263 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:00,263 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:27:00,283 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:00,830 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 descomprimido exitosamente.
2025-05-23 15:27:00,830 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:27:00,831 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 para clasificación BAML...
2025-05-23 15:27:01,517 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:01,518 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:02,486 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:02,487 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 ---
2025-05-23 15:27:02,487 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:02,487 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:27:02,512 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:03,427 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 descomprimido exitosamente.
2025-05-23 15:27:03,428 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:27:03,428 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 para clasificación BAML...
2025-05-23 15:27:03,551 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:03,551 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:04,435 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:04,436 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 ---
2025-05-23 15:27:04,436 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:04,436 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:27:04,459 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:05,171 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 descomprimido exitosamente.
2025-05-23 15:27:05,171 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:27:05,171 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 para clasificación BAML...
2025-05-23 15:27:05,978 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:06,306 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:09,538 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:09,538 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:10,990 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:10,991 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 ---
2025-05-23 15:27:10,991 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:27:10,991 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:11,034 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:12,143 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 descomprimido exitosamente.
2025-05-23 15:27:12,144 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:27:12,144 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 para clasificación BAML...
2025-05-23 15:27:14,983 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:14,983 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 ---
2025-05-23 15:27:14,984 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:27:14,983 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:15,040 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:15,882 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:15,883 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:15,889 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 descomprimido exitosamente.
2025-05-23 15:27:15,890 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:27:15,890 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 para clasificación BAML...
2025-05-23 15:27:17,999 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:17,999 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:18,078 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:18,079 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 ---
2025-05-23 15:27:18,079 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:18,079 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:27:18,108 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:18,696 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 descomprimido exitosamente.
2025-05-23 15:27:18,697 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:27:18,697 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 para clasificación BAML...
2025-05-23 15:27:19,862 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:19,862 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 ---
2025-05-23 15:27:19,863 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:19,863 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:27:19,910 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:20,447 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 descomprimido exitosamente.
2025-05-23 15:27:20,448 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:27:20,448 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 para clasificación BAML...
2025-05-23 15:27:22,203 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:22,203 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:22,636 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:22,637 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-05-23 15:27:22,637 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:22,638 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:27:22,673 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:23,179 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-05-23 15:27:23,179 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:27:23,180 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-05-23 15:27:23,724 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:23,724 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:24,741 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:24,742 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 ---
2025-05-23 15:27:24,742 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:24,743 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:27:24,757 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:25,343 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 descomprimido exitosamente.
2025-05-23 15:27:25,345 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:27:25,346 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 para clasificación BAML...
2025-05-23 15:27:26,336 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:26,337 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-05-23 15:27:26,337 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:26,337 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:27:26,371 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:26,598 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:26,892 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:26,898 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-05-23 15:27:26,898 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:27:26,898 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-05-23 15:27:27,966 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type3
2025-05-23 15:27:27,967 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'BC'
2025-05-23 15:27:29,182 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:29,182 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 ---
2025-05-23 15:27:29,182 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:29,183 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:27:29,208 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:29,731 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 descomprimido exitosamente.
2025-05-23 15:27:29,731 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:27:29,732 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 para clasificación BAML...
2025-05-23 15:27:29,959 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:29,960 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:31,900 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:31,901 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 ---
2025-05-23 15:27:31,901 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:31,901 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:27:31,928 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:32,210 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type2
2025-05-23 15:27:32,527 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:27:32,532 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 descomprimido exitosamente.
2025-05-23 15:27:32,532 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:27:32,532 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 para clasificación BAML...
2025-05-23 15:27:33,540 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:33,540 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 ---
2025-05-23 15:27:33,540 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:33,541 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:27:33,579 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:34,099 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 descomprimido exitosamente.
2025-05-23 15:27:34,099 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:27:34,100 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 para clasificación BAML...
2025-05-23 15:27:34,889 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type2
2025-05-23 15:27:34,890 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:27:36,185 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:36,186 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 ---
2025-05-23 15:27:36,186 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:36,187 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:27:36,214 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:36,740 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 descomprimido exitosamente.
2025-05-23 15:27:36,741 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:27:36,741 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 para clasificación BAML...
2025-05-23 15:27:37,195 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:37,195 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:37,930 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:37,930 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 ---
2025-05-23 15:27:37,930 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:37,931 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:27:37,961 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:38,461 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 descomprimido exitosamente.
2025-05-23 15:27:38,462 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:27:38,462 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 para clasificación BAML...
2025-05-23 15:27:39,686 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:39,686 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-05-23 15:27:39,686 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:39,687 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:27:39,713 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:39,927 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:39,928 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:40,231 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-05-23 15:27:40,231 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:27:40,231 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-05-23 15:27:41,105 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:41,105 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:42,307 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:42,307 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-05-23 15:27:42,307 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:42,308 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:27:42,331 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:42,890 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-05-23 15:27:42,890 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:27:42,890 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-05-23 15:27:43,248 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:43,249 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:44,176 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:44,176 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 ---
2025-05-23 15:27:44,176 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:44,176 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:27:44,198 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:44,687 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 descomprimido exitosamente.
2025-05-23 15:27:44,687 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:27:44,687 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 para clasificación BAML...
2025-05-23 15:27:45,746 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type3
2025-05-23 15:27:45,746 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'BC'
2025-05-23 15:27:46,316 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:46,316 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 ---
2025-05-23 15:27:46,317 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:46,317 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:27:46,350 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:46,869 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 descomprimido exitosamente.
2025-05-23 15:27:46,870 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:27:46,870 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 para clasificación BAML...
2025-05-23 15:27:47,594 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type3
2025-05-23 15:27:47,595 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'BC'
2025-05-23 15:27:48,481 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:48,481 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-05-23 15:27:48,481 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:48,482 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:27:48,522 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:49,031 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-05-23 15:27:49,031 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:27:49,031 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-05-23 15:27:49,974 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:49,974 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:53,067 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:53,067 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:53,068 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:53,068 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 ---
2025-05-23 15:27:53,069 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:53,069 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:27:53,107 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:53,612 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 descomprimido exitosamente.
2025-05-23 15:27:53,612 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:27:53,613 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 para clasificación BAML...
2025-05-23 15:27:54,563 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:54,564 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 ---
2025-05-23 15:27:54,564 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:54,564 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:27:54,592 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:55,087 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 descomprimido exitosamente.
2025-05-23 15:27:55,087 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:27:55,087 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 para clasificación BAML...
2025-05-23 15:27:56,101 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type2
2025-05-23 15:27:56,101 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:27:56,617 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:56,618 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-05-23 15:27:56,618 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:56,619 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:27:56,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:57,160 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-05-23 15:27:57,160 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:27:57,160 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-05-23 15:27:57,892 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:27:57,892 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:27:58,948 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:27:58,949 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 ---
2025-05-23 15:27:58,949 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:27:58,949 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:27:58,977 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:27:59,504 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 descomprimido exitosamente.
2025-05-23 15:27:59,504 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:27:59,505 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 para clasificación BAML...
2025-05-23 15:28:01,243 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:01,243 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-05-23 15:28:01,243 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:01,243 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:28:01,485 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:02,023 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-05-23 15:28:02,023 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:28:02,023 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-05-23 15:28:02,176 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:28:02,176 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:28:02,507 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:28:02,507 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:28:04,898 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:04,899 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 ---
2025-05-23 15:28:04,899 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:04,899 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:28:04,927 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:05,176 - baml_classification - INFO - Clasificación BAML real recibida (desde .value): Type1
2025-05-23 15:28:05,460 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:28:05,464 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 descomprimido exitosamente.
2025-05-23 15:28:05,465 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:28:05,465 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 para clasificación BAML...
2025-05-23 15:28:05,626 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"54s"}]}}, status_code=429)
2025-05-23 15:28:07,244 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:07,244 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-05-23 15:28:07,244 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:07,244 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:28:07,276 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:07,825 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-05-23 15:28:07,825 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:28:07,826 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-05-23 15:28:08,091 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"52s"}]}}, status_code=429)
2025-05-23 15:28:09,883 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:09,884 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-05-23 15:28:09,885 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:09,885 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:28:09,929 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:10,441 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-05-23 15:28:10,441 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:28:10,442 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-05-23 15:28:11,663 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:11,664 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 ---
2025-05-23 15:28:11,664 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:11,668 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:28:11,690 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:12,231 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 descomprimido exitosamente.
2025-05-23 15:28:12,232 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:28:12,232 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 para clasificación BAML...
2025-05-23 15:28:12,638 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"47s"}]}}, status_code=429)
2025-05-23 15:28:13,749 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"46s"}]}}, status_code=429)
2025-05-23 15:28:14,068 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:14,068 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 ---
2025-05-23 15:28:14,068 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:14,069 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:28:14,095 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:14,595 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 descomprimido exitosamente.
2025-05-23 15:28:14,596 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:28:14,596 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 para clasificación BAML...
2025-05-23 15:28:14,929 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"45s"}]}}, status_code=429)
2025-05-23 15:28:15,897 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:15,898 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-05-23 15:28:15,898 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:15,898 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:28:15,926 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:16,413 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-05-23 15:28:16,413 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:28:16,414 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-05-23 15:28:16,957 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"43s"}]}}, status_code=429)
2025-05-23 15:28:17,956 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:17,956 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-05-23 15:28:17,956 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:17,957 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:28:20,769 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:28:21,345 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"39s"}]}}, status_code=429)
2025-05-23 15:28:21,354 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-05-23 15:28:21,355 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:28:21,355 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-05-23 15:28:22,492 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:28:22,497 - baml_classification - INFO - Enviando imagen al cliente BAML real para clasificación...
2025-05-23 15:28:22,503 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-05-23 15:28:22,503 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-05-23 15:28:22,503 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-05-23 15:28:22,505 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:28:22,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:22,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:22,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:22,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:22,508 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:28:22,524 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:22,524 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-05-23 15:28:22,525 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:22,525 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:22,525 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:22,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:22,703 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:22,703 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1: 'FDT'
2025-05-23 15:28:22,703 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 (desactivada o datos insuficientes).
2025-05-23 15:28:22,703 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1...
2025-05-23 15:28:22,704 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:28:22,704 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:22,704 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:22,704 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:22,705 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:22,705 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:28:22,706 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:22,707 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] LUT Kerma aplicada.
2025-05-23 15:28:22,707 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:22,707 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:22,708 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:22,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:22,821 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 procesado y guardado como: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:22,821 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1: 'FDT'
2025-05-23 15:28:22,822 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 (desactivada o datos insuficientes).
2025-05-23 15:28:22,822 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1...
2025-05-23 15:28:22,823 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:28:22,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:22,824 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:22,824 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:22,824 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:22,824 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:28:22,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:22,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] LUT Kerma aplicada.
2025-05-23 15:28:22,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:22,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:22,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:22,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:28:22,921 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 procesado y guardado como: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:28:22,921 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1: 'FDT'
2025-05-23 15:28:22,922 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 (desactivada o datos insuficientes).
2025-05-23 15:28:22,922 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1...
2025-05-23 15:28:22,922 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:28:22,922 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:22,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:22,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:22,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:22,924 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:28:22,927 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:22,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] LUT Kerma aplicada.
2025-05-23 15:28:22,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:22,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:22,929 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:23,568 - baml_classification - ERROR - Excepción durante la clasificación BAML real.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 82, in _clasificar_con_baml_real_sync
    result = b.ClassifyImage(img=baml_input_image)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"36s"}]}}, status_code=429)
2025-05-23 15:28:24,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:24,151 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 procesado y guardado como: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:24,151 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'BC'
2025-05-23 15:28:24,151 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-05-23 15:28:24,152 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-05-23 15:28:24,152 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:28:24,152 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:24,153 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:24,153 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'BC'
2025-05-23 15:28:24,153 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'BC'
2025-05-23 15:28:24,153 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:28:24,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:24,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-05-23 15:28:24,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:24,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:24,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:25,198 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:25,199 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:25,199 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1: 'FDT'
2025-05-23 15:28:25,199 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 (desactivada o datos insuficientes).
2025-05-23 15:28:25,199 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1...
2025-05-23 15:28:25,199 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:28:25,199 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:25,200 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:25,200 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:25,200 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:25,200 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:28:25,201 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:25,202 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] LUT Kerma aplicada.
2025-05-23 15:28:25,202 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:25,202 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:25,202 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:25,611 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:28:25,611 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 procesado y guardado como: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:28:25,611 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-05-23 15:28:25,611 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-05-23 15:28:25,611 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-05-23 15:28:25,612 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:28:25,612 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:25,612 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:25,612 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:25,613 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:25,613 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:28:25,614 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:25,615 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-05-23 15:28:25,615 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:25,615 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:25,615 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:26,090 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:26,091 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:26,091 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1: 'FDT'
2025-05-23 15:28:26,091 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 (desactivada o datos insuficientes).
2025-05-23 15:28:26,091 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1...
2025-05-23 15:28:26,091 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:28:26,091 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:26,092 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:26,092 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:26,092 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:26,092 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:28:26,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:26,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] LUT Kerma aplicada.
2025-05-23 15:28:26,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:26,095 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:26,095 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:26,473 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:26,473 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 procesado y guardado como: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:26,473 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1: 'FDT'
2025-05-23 15:28:26,473 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 (desactivada o datos insuficientes).
2025-05-23 15:28:26,474 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1...
2025-05-23 15:28:26,474 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:28:26,474 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:26,474 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:26,475 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:26,475 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:26,475 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:28:26,476 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:26,476 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] LUT Kerma aplicada.
2025-05-23 15:28:26,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:26,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:26,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:26,604 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:26,604 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 procesado y guardado como: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:26,605 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1: 'FDT'
2025-05-23 15:28:26,606 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 (desactivada o datos insuficientes).
2025-05-23 15:28:26,606 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1...
2025-05-23 15:28:26,606 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:28:26,606 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:26,606 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:26,607 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:26,607 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:26,607 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:28:26,608 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:26,608 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] LUT Kerma aplicada.
2025-05-23 15:28:26,608 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:26,608 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:26,609 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:26,749 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:26,750 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 procesado y guardado como: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:26,750 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1: 'FDT'
2025-05-23 15:28:26,750 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 (desactivada o datos insuficientes).
2025-05-23 15:28:26,750 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1...
2025-05-23 15:28:26,750 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:28:26,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:26,751 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:26,751 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:26,751 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:26,751 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:28:26,752 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:26,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] LUT Kerma aplicada.
2025-05-23 15:28:26,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:26,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:26,753 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:26,988 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:28:26,988 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 procesado y guardado como: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:28:26,988 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1: 'FDT'
2025-05-23 15:28:26,989 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 (desactivada o datos insuficientes).
2025-05-23 15:28:26,989 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1...
2025-05-23 15:28:26,990 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:28:26,990 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:26,993 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:26,993 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:26,995 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:26,996 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:28:26,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:26,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] LUT Kerma aplicada.
2025-05-23 15:28:26,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:27,000 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:27,000 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:27,267 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:28:27,267 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 procesado y guardado como: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:28:27,268 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1: 'FDT'
2025-05-23 15:28:27,268 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 (desactivada o datos insuficientes).
2025-05-23 15:28:27,268 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1...
2025-05-23 15:28:27,268 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:28:27,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:27,270 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:27,270 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:27,270 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:27,272 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:28:27,274 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:27,274 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] LUT Kerma aplicada.
2025-05-23 15:28:27,275 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:27,276 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:27,276 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:27,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:28:27,452 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 procesado y guardado como: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:28:27,452 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1: 'FDT'
2025-05-23 15:28:27,452 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 (desactivada o datos insuficientes).
2025-05-23 15:28:27,452 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1...
2025-05-23 15:28:27,452 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:28:27,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:27,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:27,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:27,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:27,453 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:28:27,455 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:27,455 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] LUT Kerma aplicada.
2025-05-23 15:28:27,455 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:27,455 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:27,455 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:27,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:27,832 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 procesado y guardado como: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:27,832 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1: 'FDT'
2025-05-23 15:28:27,832 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 (desactivada o datos insuficientes).
2025-05-23 15:28:27,832 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1...
2025-05-23 15:28:27,833 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:28:27,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:27,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:27,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:27,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:27,834 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:28:27,835 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:27,835 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] LUT Kerma aplicada.
2025-05-23 15:28:27,835 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:27,836 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:27,836 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] SpecificCharacterSet actual es 'ISO_IR 100'. Considera cambiarlo a 'ISO_IR 192' (UTF-8) por robustez.
2025-05-23 15:28:33,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:28:33,920 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 procesado y guardado como: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:28:33,921 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'BC'
2025-05-23 15:28:33,921 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-05-23 15:28:33,922 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-05-23 15:28:33,922 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:28:33,922 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:33,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:33,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'BC'
2025-05-23 15:28:33,924 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'BC'
2025-05-23 15:28:33,925 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:28:33,927 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:33,927 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-05-23 15:28:33,927 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:33,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:33,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:34,092 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:34,092 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:34,093 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1: 'FDT'
2025-05-23 15:28:34,093 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 (desactivada o datos insuficientes).
2025-05-23 15:28:34,093 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1...
2025-05-23 15:28:34,094 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:28:34,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:34,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:34,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:34,095 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:34,095 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:28:34,096 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:34,096 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] LUT Kerma aplicada.
2025-05-23 15:28:34,096 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:34,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:34,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:34,259 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:34,259 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 procesado y guardado como: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:34,259 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-05-23 15:28:34,260 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-05-23 15:28:34,260 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-05-23 15:28:34,260 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:28:34,260 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:34,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:34,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:28:34,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:28:34,261 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:28:34,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:34,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-05-23 15:28:34,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:34,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:34,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:34,568 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:28:34,569 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:28:34,569 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1: 'MTF'
2025-05-23 15:28:34,569 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 (desactivada o datos insuficientes).
2025-05-23 15:28:34,569 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1...
2025-05-23 15:28:34,569 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:28:34,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:34,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:34,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:28:34,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:28:34,570 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:28:34,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:34,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] LUT Kerma aplicada.
2025-05-23 15:28:34,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:34,573 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:34,573 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:34,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:34,661 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 procesado y guardado como: Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:34,662 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1: 'FDT'
2025-05-23 15:28:34,662 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 (desactivada o datos insuficientes).
2025-05-23 15:28:34,662 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1...
2025-05-23 15:28:34,663 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:28:34,668 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:34,669 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:34,669 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:34,670 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:34,671 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:28:34,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:34,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] LUT Kerma aplicada.
2025-05-23 15:28:34,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:34,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:34,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:35,205 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:28:35,205 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 procesado y guardado como: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:28:35,205 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1: 'FDT'
2025-05-23 15:28:35,206 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 (desactivada o datos insuficientes).
2025-05-23 15:28:35,206 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1...
2025-05-23 15:28:35,206 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:28:35,206 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:35,207 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:35,207 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:35,207 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:35,208 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:28:35,209 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:35,209 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] LUT Kerma aplicada.
2025-05-23 15:28:35,210 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:35,210 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:35,210 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:35,329 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:35,329 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 procesado y guardado como: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:35,329 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1: 'FDT'
2025-05-23 15:28:35,329 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 (desactivada o datos insuficientes).
2025-05-23 15:28:35,329 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1...
2025-05-23 15:28:35,330 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:28:35,330 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:35,331 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:35,331 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:35,332 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:35,332 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:28:35,336 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:35,336 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] LUT Kerma aplicada.
2025-05-23 15:28:35,336 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:35,338 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:35,339 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:35,592 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:35,592 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 procesado y guardado como: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:35,592 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1: 'FDT'
2025-05-23 15:28:35,592 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 (desactivada o datos insuficientes).
2025-05-23 15:28:35,592 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1...
2025-05-23 15:28:35,593 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:28:35,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:35,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:35,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:35,594 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:35,594 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:28:35,595 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:35,595 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] LUT Kerma aplicada.
2025-05-23 15:28:35,595 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:35,595 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:35,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:35,871 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:35,872 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 procesado y guardado como: Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:35,872 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'BC'
2025-05-23 15:28:35,872 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-05-23 15:28:35,872 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-05-23 15:28:35,873 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:28:35,873 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:35,873 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:35,873 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'BC'
2025-05-23 15:28:35,873 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'BC'
2025-05-23 15:28:35,873 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:28:35,875 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:35,875 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-05-23 15:28:35,875 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:35,875 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:35,876 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:36,044 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:36,044 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'BC'
2025-05-23 15:28:36,044 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,044 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-05-23 15:28:36,045 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:28:36,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'BC'
2025-05-23 15:28:36,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'BC'
2025-05-23 15:28:36,046 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:28:36,047 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-05-23 15:28:36,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,277 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:36,277 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:36,278 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1: 'FDT'
2025-05-23 15:28:36,279 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,279 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1...
2025-05-23 15:28:36,279 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:28:36,280 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,281 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,282 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:36,282 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:36,282 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:28:36,283 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,283 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] LUT Kerma aplicada.
2025-05-23 15:28:36,284 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,284 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,284 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,377 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:36,378 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 procesado y guardado como: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:36,378 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1: 'FDT'
2025-05-23 15:28:36,378 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,378 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1...
2025-05-23 15:28:36,378 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:28:36,378 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:36,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:36,379 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:28:36,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] LUT Kerma aplicada.
2025-05-23 15:28:36,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,473 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:36,473 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 procesado y guardado como: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:36,474 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-05-23 15:28:36,474 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,474 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-05-23 15:28:36,474 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:28:36,475 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,475 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,475 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:28:36,475 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:28:36,476 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:28:36,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-05-23 15:28:36,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,621 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:36,621 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:36,622 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1: 'FDT'
2025-05-23 15:28:36,622 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,622 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1...
2025-05-23 15:28:36,623 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:28:36,623 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,623 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,623 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:36,624 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:36,624 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:28:36,626 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,626 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] LUT Kerma aplicada.
2025-05-23 15:28:36,627 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,627 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,627 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,755 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:28:36,756 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 procesado y guardado como: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:28:36,756 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1: 'FDT'
2025-05-23 15:28:36,756 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,757 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1...
2025-05-23 15:28:36,757 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:28:36,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,758 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,758 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:36,758 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:36,759 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:28:36,760 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,760 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] LUT Kerma aplicada.
2025-05-23 15:28:36,760 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,760 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,761 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,803 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:36,803 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 procesado y guardado como: Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:36,804 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-05-23 15:28:36,804 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,805 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-05-23 15:28:36,805 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:28:36,806 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:36,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:36,807 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:28:36,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-05-23 15:28:36,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,810 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,810 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:36,977 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:36,977 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:36,977 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1: 'FDT'
2025-05-23 15:28:36,978 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 (desactivada o datos insuficientes).
2025-05-23 15:28:36,978 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1...
2025-05-23 15:28:36,978 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:28:36,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:36,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:36,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:28:36,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:28:36,979 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:28:36,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:36,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] LUT Kerma aplicada.
2025-05-23 15:28:36,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:36,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:36,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,169 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:37,170 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 procesado y guardado como: Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:37,171 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,171 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,171 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,171 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-05-23 15:28:37,171 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:28:37,171 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,172 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,172 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,174 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,174 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:28:37,176 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,176 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-05-23 15:28:37,176 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,176 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,177 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,436 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:37,437 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:37,437 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,437 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,438 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,438 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1...
2025-05-23 15:28:37,438 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:28:37,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,440 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,440 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,440 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,441 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:28:37,444 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,444 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] LUT Kerma aplicada.
2025-05-23 15:28:37,445 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,445 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,514 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:37,514 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 procesado y guardado como: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:37,515 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,517 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,517 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,517 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-05-23 15:28:37,518 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:28:37,519 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,520 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,520 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,520 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,520 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:28:37,521 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,521 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-05-23 15:28:37,522 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,522 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,522 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,657 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:37,657 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:37,657 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,658 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,658 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,658 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-05-23 15:28:37,659 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:28:37,659 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,659 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,659 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,660 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:28:37,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-05-23 15:28:37,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,662 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:37,826 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:37,827 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,827 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,831 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,831 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1...
2025-05-23 15:28:37,832 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:28:37,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,833 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,834 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,834 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:28:37,836 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,836 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] LUT Kerma aplicada.
2025-05-23 15:28:37,836 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,837 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,837 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,889 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:28:37,889 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 procesado y guardado como: Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:28:37,889 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,890 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,890 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,890 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1...
2025-05-23 15:28:37,891 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:28:37,891 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,892 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,893 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,893 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:28:37,895 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,896 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] LUT Kerma aplicada.
2025-05-23 15:28:37,896 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,897 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,898 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:37,974 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:37,974 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 procesado y guardado como: Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:37,974 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:37,975 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:37,975 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-05-23 15:28:37,975 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-05-23 15:28:37,975 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:28:37,976 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:37,976 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:37,976 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:37,976 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:37,976 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:28:37,977 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:37,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-05-23 15:28:37,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:37,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:37,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:38,099 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,100 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,100 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLClasificacionReal'
2025-05-23 15:28:38,100 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLClasificacionReal'. Usando 'ClasificacionFallida'.
2025-05-23 15:28:38,100 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-05-23 15:28:38,101 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-05-23 15:28:38,101 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:28:38,101 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:28:38,101 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:28:38,102 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:28:38,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:28:38,102 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:28:38,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:28:38,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-05-23 15:28:38,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:28:38,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:28:38,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:28:38,252 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,252 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,429 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,430 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 -> Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:38,430 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 -> Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:28:38,430 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 -> Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:38,430 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:38,430 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 -> Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:28:38,430 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 -> Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 -> Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 -> Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 -> Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 -> Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 -> Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:28:38,431 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 -> Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 -> Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 -> Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 -> Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 -> Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:28:38,432 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 -> Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 -> Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 -> Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 -> Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 -> Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:38,433 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 -> Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 -> Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 -> Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 -> Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:38,434 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:38,435 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:38,435 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 -> Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:28:38,435 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 -> Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:38,435 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,435 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,436 - __main__ - INFO - Se procesaron 40 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 15:28:38,437 - pacs_operations - INFO - Iniciando envío de 40 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 15:28:38,467 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:28:38,487 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:38,490 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,499 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:38,504 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:38,507 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:38,511 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:38,512 - pacs_operations - INFO - Asociación establecida con PACS para Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:38,557 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:38,573 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:38,587 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:38,589 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:38,666 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:28:38,671 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:38,690 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:38,715 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:38,718 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:38,727 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:38,746 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:38,747 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:38,757 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:38,782 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:38,795 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:38,803 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:38,809 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:38,811 - pacs_operations - INFO - Asociación establecida con PACS para Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:38,811 - pacs_operations - INFO - Asociación establecida con PACS para Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:39,013 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:39,025 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:39,055 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:39,058 - pacs_operations - INFO - Asociación establecida con PACS para Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:39,269 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:39,285 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:39,337 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:39,341 - pacs_operations - INFO - Asociación establecida con PACS para Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:40,550 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:40,552 - pacs_operations - INFO - ÉXITO: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:40,554 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:41,906 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:41,908 - pacs_operations - INFO - ÉXITO: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:41,911 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:41,979 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:41,981 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:41,981 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:42,331 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:28:46,241 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:46,693 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:46,696 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:46,697 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:46,786 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:46,788 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:46,791 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:46,949 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:47,157 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:28:47,181 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:47,234 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:47,246 - pacs_operations - INFO - Asociación establecida con PACS para Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:47,324 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:47,427 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:47,445 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:47,478 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:47,492 - pacs_operations - INFO - Asociación establecida con PACS para Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:47,606 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:47,706 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:47,722 - pacs_operations - INFO - ÉXITO: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:47,740 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:47,767 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:47,785 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:47,796 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:47,816 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:47,842 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:47,850 - pacs_operations - INFO - ÉXITO: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:47,862 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:47,876 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:47,883 - pacs_operations - INFO - ÉXITO: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:47,887 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:47,913 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:47,936 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:47,951 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:47,962 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:47,971 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:48,012 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:48,023 - pacs_operations - INFO - ÉXITO: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:48,025 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:48,069 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:48,076 - pacs_operations - INFO - ÉXITO: Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:48,082 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:48,156 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:28:48,166 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:48,180 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:48,187 - pacs_operations - INFO - Asociación establecida con PACS para Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:48,258 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:48,361 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:28:48,375 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:48,415 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:48,430 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:48,430 - pacs_operations - INFO - Asociación establecida con PACS para Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:48,459 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:48,469 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:48,472 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:48,607 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:48,650 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:48,665 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:48,686 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:48,698 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:48,790 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:48,797 - pacs_operations - INFO - ÉXITO: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:48,798 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:48,863 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:48,900 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:48,914 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:48,929 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:48,936 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:49,119 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:49,120 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:49,153 - pacs_operations - INFO - ÉXITO: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:49,162 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:49,170 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:49,188 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:49,213 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:49,221 - pacs_operations - INFO - Asociación establecida con PACS para Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:49,433 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:49,454 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:49,462 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:49,473 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:49,479 - pacs_operations - INFO - Asociación establecida con PACS para Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:49,515 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:49,522 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:49,526 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:49,607 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:49,611 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:49,616 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:49,830 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:49,838 - pacs_operations - INFO - ÉXITO: Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:49,840 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:50,110 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:50,124 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:50,132 - pacs_operations - INFO - ÉXITO: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:50,141 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:50,143 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:50,157 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:50,158 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:50,197 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:50,201 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:50,215 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:50,236 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:50,238 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:50,239 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:50,251 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:50,280 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:50,282 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:50,283 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:50,520 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:50,526 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:50,530 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:50,538 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:50,546 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:50,570 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:50,577 - pacs_operations - INFO - Asociación establecida con PACS para Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:50,638 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:50,658 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:50,677 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:50,677 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:50,787 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:50,873 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:50,894 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:50,950 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:50,990 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:51,014 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:51,016 - pacs_operations - INFO - Asociación establecida con PACS para Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:51,296 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:28:51,311 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:51,340 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:51,344 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:51,494 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:51,729 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:51,734 - pacs_operations - INFO - ÉXITO: Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:51,737 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:51,758 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:51,766 - pacs_operations - INFO - ÉXITO: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:51,768 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:51,780 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:51,785 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:28:51,799 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:51,810 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:51,815 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:51,830 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:28:51,847 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:51,866 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:51,875 - pacs_operations - INFO - Asociación establecida con PACS para Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:52,055 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:52,058 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:52,063 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:52,088 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:28:52,101 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:52,120 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:52,122 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:52,127 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:52,130 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:52,134 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:52,148 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:52,156 - pacs_operations - INFO - ÉXITO: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:52,162 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:52,231 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:52,251 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:28:52,262 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:52,275 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:52,283 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:52,286 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:52,289 - pacs_operations - INFO - Asociación establecida con PACS para Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:52,309 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:52,310 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:52,530 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:52,540 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:52,556 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:52,570 - pacs_operations - INFO - Asociación establecida con PACS para Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:52,668 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:52,687 - pacs_operations - INFO - ÉXITO: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:52,688 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:52,755 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:52,790 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:52,888 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:28:52,896 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:52,948 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:52,956 - pacs_operations - INFO - Asociación establecida con PACS para Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:53,086 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:53,090 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:53,095 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:53,197 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:53,246 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:28:53,256 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:53,278 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:53,285 - pacs_operations - INFO - Asociación establecida con PACS para Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:53,357 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:53,413 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:53,421 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:53,428 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:53,518 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:28:53,534 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:53,554 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:53,558 - pacs_operations - INFO - ÉXITO: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:53,575 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:53,580 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:53,589 - pacs_operations - INFO - Asociación establecida con PACS para Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:53,781 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:53,799 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:53,803 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:53,806 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:53,822 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:53,839 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:53,857 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:53,860 - pacs_operations - INFO - Asociación establecida con PACS para Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:53,866 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:53,872 - pacs_operations - INFO - ÉXITO: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:53,884 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:54,036 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:54,039 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:54,082 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:54,084 - pacs_operations - INFO - Asociación establecida con PACS para Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:54,200 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:54,209 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:54,226 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:54,236 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:54,256 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:54,258 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:54,316 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:54,335 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:54,341 - pacs_operations - INFO - ÉXITO: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:54,352 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:54,433 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:28:54,443 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:54,463 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:54,468 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:54,569 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:54,665 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:28:54,677 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:54,697 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:54,712 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:54,724 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:54,737 - pacs_operations - INFO - ÉXITO: Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:54,745 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:54,867 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:54,951 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:28:54,971 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:54,996 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:55,010 - pacs_operations - INFO - Asociación establecida con PACS para Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:55,198 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:55,292 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,301 - pacs_operations - INFO - ÉXITO: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,301 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,313 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:28:55,347 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:55,362 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:28:55,396 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:28:55,404 - pacs_operations - INFO - Asociación establecida con PACS para Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:28:55,610 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,615 - pacs_operations - INFO - ÉXITO: Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,618 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,679 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,681 - pacs_operations - INFO - ÉXITO: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,681 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,688 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,689 - pacs_operations - INFO - ÉXITO: Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,702 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,767 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:28:55,831 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,834 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,836 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,844 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,846 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,851 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,857 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,862 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,867 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:55,980 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:55,982 - pacs_operations - INFO - ÉXITO: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:55,983 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:56,078 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:28:56,084 - pacs_operations - INFO - ÉXITO: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:28:56,086 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:28:56,092 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 40 de 40 exitosos, 0 de 40 fallidos.
2025-05-23 15:28:56,092 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 15:28:56,093 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:28:56,119 - __main__ - INFO - Aplicación finalizada.
2025-05-23 15:49:35,458 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 15:49:37,546 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 15:49:37,868 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 15:49:37,948 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 15:49:37,949 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 15:49:37,949 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:49:37,950 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 15:49:37,974 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 15:49:37,974 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 15:49:37,976 - __main__ - INFO - Se encontraron 40 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 15:49:37,976 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-05-23 15:49:37,976 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:49:37,992 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:38,556 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-05-23 15:49:38,556 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:49:38,556 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-05-23 15:49:39,404 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:39,411 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:39,420 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 ---
2025-05-23 15:49:39,433 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:49:39,461 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:40,098 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 descomprimido exitosamente.
2025-05-23 15:49:40,098 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:49:40,098 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 para clasificación BAML...
2025-05-23 15:49:41,217 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:41,218 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:41,219 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 ---
2025-05-23 15:49:41,234 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:49:41,686 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:42,212 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 descomprimido exitosamente.
2025-05-23 15:49:42,212 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:49:42,213 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 para clasificación BAML...
2025-05-23 15:49:43,168 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:43,168 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:43,169 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 ---
2025-05-23 15:49:43,183 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:49:43,207 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:43,770 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:43,770 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:43,771 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 descomprimido exitosamente.
2025-05-23 15:49:43,773 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:49:43,773 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 para clasificación BAML...
2025-05-23 15:49:44,923 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:44,923 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-05-23 15:49:44,924 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:44,924 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:49:44,951 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:45,457 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-05-23 15:49:45,457 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:49:45,457 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-05-23 15:49:45,935 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:45,936 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:46,483 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:46,484 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 ---
2025-05-23 15:49:46,484 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:46,484 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:49:46,516 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:47,030 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:47,031 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:47,036 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 descomprimido exitosamente.
2025-05-23 15:49:47,037 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:49:47,037 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 para clasificación BAML...
2025-05-23 15:49:48,467 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:48,468 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-05-23 15:49:48,468 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:48,468 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:49:48,519 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:49,138 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:49,138 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:49,142 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-05-23 15:49:49,142 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:49:49,142 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-05-23 15:49:49,582 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:49:49,582 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:49:50,042 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:50,042 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 ---
2025-05-23 15:49:50,043 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:50,043 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:49:50,064 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:50,618 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 descomprimido exitosamente.
2025-05-23 15:49:50,619 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:49:50,619 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 para clasificación BAML...
2025-05-23 15:49:51,803 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:51,804 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:52,459 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:52,460 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 ---
2025-05-23 15:49:52,460 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:52,461 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:49:52,490 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:53,036 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 descomprimido exitosamente.
2025-05-23 15:49:53,036 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:49:53,037 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 para clasificación BAML...
2025-05-23 15:49:53,726 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:53,727 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:54,127 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:54,127 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 ---
2025-05-23 15:49:54,128 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:54,128 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:49:54,162 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:54,713 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 descomprimido exitosamente.
2025-05-23 15:49:54,714 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:49:54,714 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 para clasificación BAML...
2025-05-23 15:49:55,778 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:55,779 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 ---
2025-05-23 15:49:55,779 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:55,780 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:49:55,815 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:56,050 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:56,050 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:56,346 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 descomprimido exitosamente.
2025-05-23 15:49:56,346 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:49:56,347 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 para clasificación BAML...
2025-05-23 15:49:57,749 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:49:57,749 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:49:58,679 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:49:58,679 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 ---
2025-05-23 15:49:58,679 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:49:58,680 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:49:58,715 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:49:59,238 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 descomprimido exitosamente.
2025-05-23 15:49:59,239 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:49:59,239 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 para clasificación BAML...
2025-05-23 15:50:00,614 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:00,615 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:00,989 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:00,989 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 ---
2025-05-23 15:50:00,990 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:00,990 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:50:01,029 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:01,547 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 descomprimido exitosamente.
2025-05-23 15:50:01,548 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:50:01,548 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 para clasificación BAML...
2025-05-23 15:50:01,785 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:01,785 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:03,650 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:03,650 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 ---
2025-05-23 15:50:03,650 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:03,650 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:50:03,679 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:04,199 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 descomprimido exitosamente.
2025-05-23 15:50:04,199 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:50:04,199 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 para clasificación BAML...
2025-05-23 15:50:05,426 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:05,427 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 ---
2025-05-23 15:50:05,427 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:05,427 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:50:05,464 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:05,996 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 descomprimido exitosamente.
2025-05-23 15:50:05,997 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:50:05,997 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 para clasificación BAML...
2025-05-23 15:50:06,805 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:06,806 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:06,818 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-05-23 15:50:06,829 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:50:07,033 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:07,034 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:07,159 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:07,776 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-05-23 15:50:07,776 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:50:07,776 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-05-23 15:50:08,873 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:08,874 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 ---
2025-05-23 15:50:08,874 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:50:08,874 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:08,894 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:08,895 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:08,923 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:09,414 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 descomprimido exitosamente.
2025-05-23 15:50:09,414 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:50:09,414 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 para clasificación BAML...
2025-05-23 15:50:10,589 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:10,590 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-05-23 15:50:10,590 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:10,590 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:50:10,637 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:10,861 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:11,134 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:11,139 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-05-23 15:50:11,140 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:50:11,140 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-05-23 15:50:12,986 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:50:12,986 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:50:13,318 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:13,318 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 ---
2025-05-23 15:50:13,318 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:13,319 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:50:13,352 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:13,860 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 descomprimido exitosamente.
2025-05-23 15:50:13,860 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:50:13,860 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 para clasificación BAML...
2025-05-23 15:50:14,070 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"46s"}]}}, status_code=429).
2025-05-23 15:50:15,785 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:15,785 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:16,042 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:16,043 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 ---
2025-05-23 15:50:16,043 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:16,044 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:50:16,071 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:16,075 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:16,595 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 descomprimido exitosamente.
2025-05-23 15:50:16,595 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:50:16,595 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 para clasificación BAML...
2025-05-23 15:50:16,892 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"43s"}]}}, status_code=429).
2025-05-23 15:50:16,933 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"43s"}]}}, status_code=429).
2025-05-23 15:50:17,757 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:17,758 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 ---
2025-05-23 15:50:17,758 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:17,758 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:50:17,793 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:18,556 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 descomprimido exitosamente.
2025-05-23 15:50:18,557 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:50:18,557 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 para clasificación BAML...
2025-05-23 15:50:18,904 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"41s"}]}}, status_code=429).
2025-05-23 15:50:18,935 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:19,761 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"40s"}]}}, status_code=429).
2025-05-23 15:50:20,072 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:20,072 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 ---
2025-05-23 15:50:20,072 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:20,073 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:50:20,118 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:20,647 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 descomprimido exitosamente.
2025-05-23 15:50:20,647 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:50:20,647 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 para clasificación BAML...
2025-05-23 15:50:20,893 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:20,904 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:21,076 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"39s"}]}}, status_code=429).
2025-05-23 15:50:21,683 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:21,684 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:21,684 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 ---
2025-05-23 15:50:21,693 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:50:21,710 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"38s"}]}}, status_code=429).
2025-05-23 15:50:21,744 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:21,961 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"38s"}]}}, status_code=429).
2025-05-23 15:50:22,265 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 descomprimido exitosamente.
2025-05-23 15:50:22,265 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:50:22,265 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 para clasificación BAML...
2025-05-23 15:50:22,878 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"37s"}]}}, status_code=429).
2025-05-23 15:50:23,077 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:23,270 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:23,271 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:23,271 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-05-23 15:50:23,286 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:50:23,312 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:23,834 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:23,853 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-05-23 15:50:23,854 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:50:23,854 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-05-23 15:50:24,389 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"35s"}]}}, status_code=429).
2025-05-23 15:50:24,489 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"35s"}]}}, status_code=429).
2025-05-23 15:50:24,736 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"35s"}]}}, status_code=429).
2025-05-23 15:50:24,878 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:26,257 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:26,390 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:26,592 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"33s"}]}}, status_code=429).
2025-05-23 15:50:26,700 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:27,271 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"32s"}]}}, status_code=429).
2025-05-23 15:50:27,283 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:27,284 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-05-23 15:50:27,296 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:50:27,351 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:28,219 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-05-23 15:50:28,219 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:50:28,220 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-05-23 15:50:28,489 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:28,708 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"31s"}]}}, status_code=429).
2025-05-23 15:50:29,711 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:30,297 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"29s"}]}}, status_code=429).
2025-05-23 15:50:30,512 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"29s"}]}}, status_code=429).
2025-05-23 15:50:30,592 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:30,708 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:31,889 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"28s"}]}}, status_code=429).
2025-05-23 15:50:31,989 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"28s"}]}}, status_code=429).
2025-05-23 15:50:32,026 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:32,026 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 ---
2025-05-23 15:50:32,026 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:32,026 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:50:32,052 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:32,560 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 descomprimido exitosamente.
2025-05-23 15:50:32,561 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:50:32,561 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 para clasificación BAML...
2025-05-23 15:50:32,737 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:33,002 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"27s"}]}}, status_code=429).
2025-05-23 15:50:34,297 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:34,475 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:34,475 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 ---
2025-05-23 15:50:34,475 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:34,476 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:50:34,506 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:35,047 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:35,064 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 descomprimido exitosamente.
2025-05-23 15:50:35,065 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:50:35,065 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 para clasificación BAML...
2025-05-23 15:50:35,284 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:35,402 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"24s"}]}}, status_code=429).
2025-05-23 15:50:35,601 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"24s"}]}}, status_code=429).
2025-05-23 15:50:35,892 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:36,219 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"24s"}]}}, status_code=429).
2025-05-23 15:50:37,023 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:37,024 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:37,024 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-05-23 15:50:37,403 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:37,929 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:50:37,966 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:38,632 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:38,663 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-05-23 15:50:38,663 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:50:38,663 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-05-23 15:50:38,801 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"21s"}]}}, status_code=429).
2025-05-23 15:50:38,917 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"21s"}]}}, status_code=429).
2025-05-23 15:50:39,456 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"20s"}]}}, status_code=429).
2025-05-23 15:50:39,990 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:40,220 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:41,457 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:41,765 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:41,766 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 ---
2025-05-23 15:50:41,766 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:41,766 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:50:41,796 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:42,348 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 descomprimido exitosamente.
2025-05-23 15:50:42,349 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:50:42,349 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 para clasificación BAML...
2025-05-23 15:50:42,603 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"17s"}]}}, status_code=429).
2025-05-23 15:50:42,918 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:43,391 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:43,391 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:43,499 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:50:43,499 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:50:43,602 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:43,916 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:43,916 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 ---
2025-05-23 15:50:43,917 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:43,917 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:50:43,946 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:44,520 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 descomprimido exitosamente.
2025-05-23 15:50:44,520 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:50:44,520 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 para clasificación BAML...
2025-05-23 15:50:44,822 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-23 15:50:44,822 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:50:46,603 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:46,648 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:46,649 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-05-23 15:50:46,649 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:46,649 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:50:46,674 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:46,675 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:46,695 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:46,920 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:47,317 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-05-23 15:50:47,460 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:50:47,460 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-05-23 15:50:47,463 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:47,464 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:47,848 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:47,849 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:50,247 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:50,247 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:50,573 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:50:50,573 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:50:50,679 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:50,679 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:51,039 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:51,039 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 ---
2025-05-23 15:50:51,039 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:51,040 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:50:51,090 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:51,581 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 descomprimido exitosamente.
2025-05-23 15:50:51,581 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:50:51,582 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 para clasificación BAML...
2025-05-23 15:50:53,231 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:53,231 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-05-23 15:50:53,232 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:53,232 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:50:53,259 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:53,798 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-05-23 15:50:53,798 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:50:53,798 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-05-23 15:50:54,729 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:54,730 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:57,379 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:50:57,379 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:50:58,583 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:50:58,584 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 ---
2025-05-23 15:50:58,584 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:50:58,585 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:50:58,608 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:50:59,097 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 descomprimido exitosamente.
2025-05-23 15:50:59,097 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:50:59,098 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 para clasificación BAML...
2025-05-23 15:51:00,928 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:00,928 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-05-23 15:51:00,929 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:51:00,929 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:00,968 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:51:01,525 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-23 15:51:01,525 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:51:01,555 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-05-23 15:51:01,555 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:51:01,556 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-05-23 15:51:04,130 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:51:04,130 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:51:04,352 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:04,353 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-05-23 15:51:04,353 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:04,353 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:51:04,433 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:51:04,940 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-05-23 15:51:04,940 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:51:04,941 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-05-23 15:51:06,021 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:06,022 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 ---
2025-05-23 15:51:06,022 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:06,022 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:51:06,043 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:51:06,545 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 descomprimido exitosamente.
2025-05-23 15:51:06,545 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:51:06,545 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 para clasificación BAML...
2025-05-23 15:51:07,357 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-23 15:51:07,357 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:51:08,326 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:08,326 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 ---
2025-05-23 15:51:08,327 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:08,327 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:51:08,353 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:51:08,828 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 descomprimido exitosamente.
2025-05-23 15:51:08,829 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:51:08,829 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 para clasificación BAML...
2025-05-23 15:51:09,304 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:51:09,305 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:51:11,089 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:11,089 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-05-23 15:51:11,089 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:51:11,089 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:11,114 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:51:11,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-05-23 15:51:11,650 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:51:11,650 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-05-23 15:51:12,722 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"47s"}]}}, status_code=429).
2025-05-23 15:51:13,077 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:51:13,077 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:51:13,451 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:13,452 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-05-23 15:51:13,452 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:13,453 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:51:13,487 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:51:14,051 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-05-23 15:51:14,051 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:51:14,052 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-05-23 15:51:14,726 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:15,153 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"45s"}]}}, status_code=429).
2025-05-23 15:51:17,154 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:17,219 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:51:17,226 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:17,233 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-05-23 15:51:17,236 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-05-23 15:51:17,237 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-05-23 15:51:17,237 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:51:17,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:17,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:17,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:17,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:17,240 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:51:17,264 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:17,265 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-05-23 15:51:17,265 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:17,265 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:17,266 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:17,537 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:17,538 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:17,538 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1: 'FDT'
2025-05-23 15:51:17,538 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 (desactivada o datos insuficientes).
2025-05-23 15:51:17,538 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1...
2025-05-23 15:51:17,539 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:51:17,539 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:17,541 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:17,542 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:17,543 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:17,543 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:51:17,545 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:17,545 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] LUT Kerma aplicada.
2025-05-23 15:51:17,545 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:17,545 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:17,546 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:17,982 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:17,983 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 procesado y guardado como: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:17,983 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1: 'FDT'
2025-05-23 15:51:17,983 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 (desactivada o datos insuficientes).
2025-05-23 15:51:17,983 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1...
2025-05-23 15:51:17,983 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:51:17,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:17,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:17,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:17,985 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:17,985 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:51:17,986 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:17,986 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] LUT Kerma aplicada.
2025-05-23 15:51:17,987 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:17,987 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:17,987 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:18,058 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"42s"}]}}, status_code=429).
2025-05-23 15:51:18,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:51:18,241 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 procesado y guardado como: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:51:18,241 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1: 'FDT'
2025-05-23 15:51:18,241 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 (desactivada o datos insuficientes).
2025-05-23 15:51:18,241 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1...
2025-05-23 15:51:18,242 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:51:18,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:18,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:18,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:18,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:18,243 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:51:18,245 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:18,245 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] LUT Kerma aplicada.
2025-05-23 15:51:18,245 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:18,246 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:18,246 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:18,258 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"41s"}]}}, status_code=429).
2025-05-23 15:51:18,321 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"41s"}]}}, status_code=429).
2025-05-23 15:51:18,566 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:18,566 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 procesado y guardado como: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:18,567 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-05-23 15:51:18,567 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-05-23 15:51:18,567 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-05-23 15:51:18,567 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:51:18,567 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:18,568 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:18,568 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:51:18,568 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:51:18,568 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:51:18,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:18,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-05-23 15:51:18,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:18,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:18,571 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:19,293 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:19,293 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:19,293 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1: 'FDT'
2025-05-23 15:51:19,294 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 (desactivada o datos insuficientes).
2025-05-23 15:51:19,294 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1...
2025-05-23 15:51:19,294 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:51:19,294 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:19,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:19,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:19,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:19,295 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:51:19,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:19,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] LUT Kerma aplicada.
2025-05-23 15:51:19,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:19,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:19,299 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:19,976 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:51:19,977 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 procesado y guardado como: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:51:19,977 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-05-23 15:51:19,977 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-05-23 15:51:19,977 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-05-23 15:51:19,977 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:51:19,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:19,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:19,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:19,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:19,978 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:51:19,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:19,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-05-23 15:51:19,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:19,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:19,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:20,322 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:20,569 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:20,569 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:20,569 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1: 'FDT'
2025-05-23 15:51:20,569 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 (desactivada o datos insuficientes).
2025-05-23 15:51:20,570 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1...
2025-05-23 15:51:20,570 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:51:20,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:20,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:20,574 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:20,574 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:20,574 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:51:20,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:20,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] LUT Kerma aplicada.
2025-05-23 15:51:20,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:20,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:20,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:21,113 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:21,113 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 procesado y guardado como: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:21,113 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1: 'FDT'
2025-05-23 15:51:21,114 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 (desactivada o datos insuficientes).
2025-05-23 15:51:21,114 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1...
2025-05-23 15:51:21,114 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:51:21,114 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:21,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:21,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:21,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:21,115 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:51:21,118 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:21,118 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] LUT Kerma aplicada.
2025-05-23 15:51:21,119 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:21,120 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:21,120 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:21,671 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:21,672 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 procesado y guardado como: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:21,672 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1: 'FDT'
2025-05-23 15:51:21,672 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 (desactivada o datos insuficientes).
2025-05-23 15:51:21,672 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1...
2025-05-23 15:51:21,672 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:51:21,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:21,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:21,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:21,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:21,673 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:51:21,674 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:21,675 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] LUT Kerma aplicada.
2025-05-23 15:51:21,675 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:21,675 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:21,676 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:21,952 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"38s"}]}}, status_code=429).
2025-05-23 15:51:22,058 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:22,253 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:22,253 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 procesado y guardado como: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:22,254 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1: 'FDT'
2025-05-23 15:51:22,254 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 (desactivada o datos insuficientes).
2025-05-23 15:51:22,254 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1...
2025-05-23 15:51:22,254 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:51:22,254 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:22,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:22,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:22,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:22,255 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:51:22,259 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:22,260 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] LUT Kerma aplicada.
2025-05-23 15:51:22,260 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:22,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:22,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:22,272 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:22,734 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:51:22,734 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 procesado y guardado como: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:51:22,734 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1: 'FDT'
2025-05-23 15:51:22,735 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 (desactivada o datos insuficientes).
2025-05-23 15:51:22,735 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1...
2025-05-23 15:51:22,735 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:51:22,736 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:22,736 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:22,737 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:22,739 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:22,740 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:51:22,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:22,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] LUT Kerma aplicada.
2025-05-23 15:51:22,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:22,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:22,743 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:23,546 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"36s"}]}}, status_code=429).
2025-05-23 15:51:24,437 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:51:24,437 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 procesado y guardado como: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:51:24,438 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1: 'FDT'
2025-05-23 15:51:24,438 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 (desactivada o datos insuficientes).
2025-05-23 15:51:24,438 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1...
2025-05-23 15:51:24,438 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:51:24,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:24,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:24,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:24,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:24,440 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:51:24,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:24,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] LUT Kerma aplicada.
2025-05-23 15:51:24,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:24,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:24,443 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:24,924 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"35s"}]}}, status_code=429).
2025-05-23 15:51:25,137 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:25,137 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 procesado y guardado como: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:25,137 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.BamlClientError: Something went wrong with the LLM client Gemini: reqwest::Error { kind: Request, url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent", source: hyper_util::client::legacy::Error(Connect, TimedOut) }
2025-05-23 15:51:25,239 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:25,240 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:25,240 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 (desactivada o datos insuficientes).
2025-05-23 15:51:25,240 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1...
2025-05-23 15:51:25,241 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:51:25,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:25,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:25,244 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:25,244 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:25,245 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:51:25,247 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:25,248 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] LUT Kerma aplicada.
2025-05-23 15:51:25,248 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:25,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:25,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:25,415 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:51:25,415 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 procesado y guardado como: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:51:25,415 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1: 'FDT'
2025-05-23 15:51:25,416 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 (desactivada o datos insuficientes).
2025-05-23 15:51:25,416 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1...
2025-05-23 15:51:25,417 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:51:25,418 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:25,419 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:25,420 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:25,420 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:25,420 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:51:25,421 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:25,422 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] LUT Kerma aplicada.
2025-05-23 15:51:25,422 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:25,422 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:25,423 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] SpecificCharacterSet actual es 'ISO_IR 100'. Considera cambiarlo a 'ISO_IR 192' (UTF-8) por robustez.
2025-05-23 15:51:25,836 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:51:25,837 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 procesado y guardado como: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:51:25,837 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-05-23 15:51:25,837 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-05-23 15:51:25,837 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-05-23 15:51:25,837 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:51:25,838 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:25,838 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:25,838 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:51:25,839 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:51:25,839 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:51:25,840 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:25,841 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-05-23 15:51:25,841 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:25,841 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:25,842 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:25,953 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:26,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:26,101 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:26,101 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1: 'FDT'
2025-05-23 15:51:26,101 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 (desactivada o datos insuficientes).
2025-05-23 15:51:26,101 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1...
2025-05-23 15:51:26,101 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:51:26,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:26,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:26,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:26,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:26,103 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:51:26,107 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:26,108 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] LUT Kerma aplicada.
2025-05-23 15:51:26,109 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:26,111 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:26,111 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:26,290 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:26,290 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 procesado y guardado como: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:26,291 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"29s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f192011f680 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:26,293 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:26,293 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:26,294 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-05-23 15:51:26,294 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-05-23 15:51:26,295 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:51:26,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:26,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:26,296 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:26,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:26,296 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:51:26,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:26,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-05-23 15:51:26,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:26,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:26,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:27,377 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:51:27,377 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:51:27,377 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"26s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f192013f980 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:27,378 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:27,378 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:27,379 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 (desactivada o datos insuficientes).
2025-05-23 15:51:27,379 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1...
2025-05-23 15:51:27,379 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:51:27,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:27,380 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:27,380 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:27,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:27,381 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:51:27,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:27,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] LUT Kerma aplicada.
2025-05-23 15:51:27,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:27,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:27,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:27,651 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"32s"}]}}, status_code=429).
2025-05-23 15:51:27,776 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:27,776 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 procesado y guardado como: Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:27,776 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"21s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f19209b76b0 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:27,777 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:27,777 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:27,777 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 (desactivada o datos insuficientes).
2025-05-23 15:51:27,777 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1...
2025-05-23 15:51:27,778 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:51:27,778 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:27,778 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:27,778 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:27,778 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:27,779 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:51:27,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:27,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] LUT Kerma aplicada.
2025-05-23 15:51:27,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:27,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:27,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:27,965 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:51:27,965 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 procesado y guardado como: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:51:27,965 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"20s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f192015bf50 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:27,966 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:27,966 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:27,967 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 (desactivada o datos insuficientes).
2025-05-23 15:51:27,967 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1...
2025-05-23 15:51:27,967 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:51:27,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:27,968 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:27,968 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:27,968 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:27,968 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:51:27,969 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:27,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] LUT Kerma aplicada.
2025-05-23 15:51:27,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:27,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:27,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:28,307 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:28,307 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 procesado y guardado como: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:28,307 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1: 'FDT'
2025-05-23 15:51:28,307 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 (desactivada o datos insuficientes).
2025-05-23 15:51:28,308 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1...
2025-05-23 15:51:28,308 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:51:28,308 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:28,308 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:28,309 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:28,309 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:28,309 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:51:28,310 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:28,310 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] LUT Kerma aplicada.
2025-05-23 15:51:28,310 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:28,311 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:28,314 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:30,200 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:30,201 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 procesado y guardado como: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:30,201 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-05-23 15:51:30,201 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-05-23 15:51:30,201 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-05-23 15:51:30,202 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:51:30,202 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:30,202 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:30,203 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:51:30,203 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:51:30,203 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:51:30,205 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:30,205 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-05-23 15:51:30,205 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:30,205 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:30,206 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:31,127 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:31,127 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:31,127 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-05-23 15:51:31,128 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-05-23 15:51:31,128 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-05-23 15:51:31,128 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:51:31,128 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:31,129 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:31,129 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:51:31,129 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:51:31,129 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:51:31,130 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:31,131 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-05-23 15:51:31,131 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:31,131 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:31,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:31,664 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:31,959 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:31,959 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:31,960 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1: 'FDT'
2025-05-23 15:51:31,960 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 (desactivada o datos insuficientes).
2025-05-23 15:51:31,961 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1...
2025-05-23 15:51:31,962 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:51:31,965 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:31,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:31,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:31,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:31,968 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:51:31,969 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:31,969 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] LUT Kerma aplicada.
2025-05-23 15:51:31,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:31,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:31,970 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:32,569 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:32,569 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 procesado y guardado como: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:32,569 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1: 'FDT'
2025-05-23 15:51:32,569 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 (desactivada o datos insuficientes).
2025-05-23 15:51:32,569 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1...
2025-05-23 15:51:32,569 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:51:32,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:32,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:32,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:32,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:32,570 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:51:32,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:32,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] LUT Kerma aplicada.
2025-05-23 15:51:32,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:32,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:32,573 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:33,921 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:34,001 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:34,001 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 procesado y guardado como: Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:34,001 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1: 'FDT'
2025-05-23 15:51:34,001 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 (desactivada o datos insuficientes).
2025-05-23 15:51:34,002 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1...
2025-05-23 15:51:34,002 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:51:34,002 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:34,003 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:34,003 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:34,005 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:34,008 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:51:34,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:34,013 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] LUT Kerma aplicada.
2025-05-23 15:51:34,013 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:34,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:34,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:34,586 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:51:34,587 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 procesado y guardado como: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:51:34,587 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1: 'FDT'
2025-05-23 15:51:34,587 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 (desactivada o datos insuficientes).
2025-05-23 15:51:34,587 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1...
2025-05-23 15:51:34,588 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:51:34,588 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:34,589 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:34,589 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:34,590 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:34,591 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:51:34,595 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:34,595 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] LUT Kerma aplicada.
2025-05-23 15:51:34,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:34,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:34,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:35,307 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:35,307 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 procesado y guardado como: Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:35,307 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-05-23 15:51:35,307 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-05-23 15:51:35,308 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-05-23 15:51:35,308 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:51:35,308 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:35,308 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:35,308 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:51:35,309 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:51:35,309 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:51:35,310 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:35,310 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-05-23 15:51:35,310 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:35,311 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:35,311 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:35,805 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:51:36,005 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:36,005 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:36,005 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1: 'FDT'
2025-05-23 15:51:36,006 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 (desactivada o datos insuficientes).
2025-05-23 15:51:36,006 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1...
2025-05-23 15:51:36,006 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:51:36,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:36,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:36,007 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:36,007 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:36,007 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:51:36,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:36,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] LUT Kerma aplicada.
2025-05-23 15:51:36,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:36,009 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:36,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:36,588 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:36,589 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 procesado y guardado como: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:36,589 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-05-23 15:51:36,589 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-05-23 15:51:36,589 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-05-23 15:51:36,590 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:51:36,590 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:36,590 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:36,590 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:36,591 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:36,591 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:51:36,592 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:36,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-05-23 15:51:36,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:36,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:36,594 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:36,737 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:36,737 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:36,737 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1: 'FDT'
2025-05-23 15:51:36,738 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 (desactivada o datos insuficientes).
2025-05-23 15:51:36,739 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1...
2025-05-23 15:51:36,739 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:51:36,739 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:36,739 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:36,739 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:36,740 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:36,740 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:51:36,741 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:36,741 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] LUT Kerma aplicada.
2025-05-23 15:51:36,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:36,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:36,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:37,134 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:37,134 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 procesado y guardado como: Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:37,134 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-05-23 15:51:37,134 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-05-23 15:51:37,135 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-05-23 15:51:37,135 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:51:37,135 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:37,136 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:37,136 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:51:37,136 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:51:37,136 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:51:37,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:37,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-05-23 15:51:37,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:37,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:37,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:37,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:37,572 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:37,573 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1: 'FDT'
2025-05-23 15:51:37,573 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 (desactivada o datos insuficientes).
2025-05-23 15:51:37,573 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1...
2025-05-23 15:51:37,573 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:51:37,574 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:37,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:37,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:37,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:37,576 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:51:37,577 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:37,578 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] LUT Kerma aplicada.
2025-05-23 15:51:37,578 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:37,579 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:37,579 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:37,888 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:37,889 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 procesado y guardado como: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:37,889 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-05-23 15:51:37,889 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-05-23 15:51:37,889 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-05-23 15:51:37,890 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:51:37,890 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:37,892 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:37,892 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:51:37,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:51:37,893 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:51:37,895 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:37,895 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-05-23 15:51:37,895 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:37,895 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:37,896 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:38,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:38,036 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:38,036 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-05-23 15:51:38,036 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-05-23 15:51:38,036 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-05-23 15:51:38,037 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:51:38,037 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:38,037 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:38,037 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:51:38,037 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:51:38,038 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:51:38,039 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:38,039 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-05-23 15:51:38,039 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:38,040 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:38,040 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:38,114 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:38,115 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:38,115 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1: 'FDT'
2025-05-23 15:51:38,115 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 (desactivada o datos insuficientes).
2025-05-23 15:51:38,115 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1...
2025-05-23 15:51:38,115 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:51:38,120 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:38,120 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:38,121 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:51:38,122 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:51:38,123 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:51:38,124 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:38,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] LUT Kerma aplicada.
2025-05-23 15:51:38,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:38,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:38,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:38,176 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:51:38,176 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 procesado y guardado como: Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:51:38,196 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"27s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f19183e4dd0 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:38,197 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:38,198 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:38,198 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-05-23 15:51:38,198 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-05-23 15:51:38,198 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:51:38,198 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:38,199 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:38,199 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:38,199 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:38,199 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:51:38,200 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:38,201 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-05-23 15:51:38,201 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:38,201 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:38,201 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:38,309 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,310 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,310 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"23s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f19183e6a50 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:38,311 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:38,311 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:38,311 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 (desactivada o datos insuficientes).
2025-05-23 15:51:38,311 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1...
2025-05-23 15:51:38,311 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:51:38,311 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:38,312 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:38,312 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:38,312 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:38,312 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:51:38,313 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:38,314 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] LUT Kerma aplicada.
2025-05-23 15:51:38,314 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:38,314 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:38,314 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:38,435 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,435 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 procesado y guardado como: Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,436 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerMinutePerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"15"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"23s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7f1918236e40 state=finished raised BamlClientHttpError>]
2025-05-23 15:51:38,437 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:51:38,437 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:51:38,438 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-05-23 15:51:38,438 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-05-23 15:51:38,438 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:51:38,438 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:51:38,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:51:38,439 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:51:38,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:51:38,439 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:51:38,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:51:38,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-05-23 15:51:38,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:51:38,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:51:38,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:51:38,550 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 -> Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 -> Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 -> Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:38,551 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 -> Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 -> Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 -> Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 -> Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 -> Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 -> Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 -> Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 -> Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 -> Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:51:38,552 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 -> Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 -> Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 -> Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 -> Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 -> Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,553 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 -> Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,558 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:38,558 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:38,558 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 -> Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 -> Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 -> Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 -> Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 -> Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:38,559 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 -> Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 -> Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 -> Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,560 - __main__ - INFO - Se procesaron 40 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 15:51:38,715 - pacs_operations - INFO - Iniciando envío de 40 archivos desde /home/aotal/tmp/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 15:51:38,744 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-23 15:51:38,760 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,764 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,766 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,770 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:38,773 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,779 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 15:51:38,782 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,785 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:38,787 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,791 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:38,794 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,799 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:38,802 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,806 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:38,807 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:38,847 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,851 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,853 - pacs_operations - INFO - Asociación establecida con PACS para Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,855 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,857 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,858 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,859 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,863 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,864 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,864 - pacs_operations - INFO - Asociación establecida con PACS para Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,865 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,872 - pacs_operations - INFO - Asociación establecida con PACS para Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,875 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:38,877 - pacs_operations - INFO - Asociación establecida con PACS para Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,885 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:38,896 - pacs_operations - INFO - Asociación establecida con PACS para Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:39,203 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,306 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,373 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,384 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,662 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,709 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,899 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:39,950 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:40,944 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:40,946 - pacs_operations - INFO - ÉXITO: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:40,950 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:40,989 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:51:41,024 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,025 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,028 - pacs_operations - INFO - ÉXITO: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,035 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:41,053 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:51:41,067 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,070 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,071 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,081 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,085 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,089 - pacs_operations - INFO - Asociación establecida con PACS para Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,091 - pacs_operations - INFO - ÉXITO: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,098 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,100 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:41,102 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,103 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:41,117 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:41,122 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:41,124 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,129 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,130 - pacs_operations - INFO - ÉXITO: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,136 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,142 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:41,144 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,146 - pacs_operations - INFO - ÉXITO: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,147 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:41,161 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,164 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:41,165 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm
2025-05-23 15:51:41,165 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,170 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,175 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,175 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,180 - pacs_operations - INFO - Asociación establecida con PACS para Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,210 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,214 - pacs_operations - INFO - Asociación establecida con PACS para Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,215 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,221 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,828 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,831 - pacs_operations - INFO - ÉXITO: Img21_SN1938BX_KVP70_mAs3.19_IE150.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,831 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:41,848 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:51:41,854 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:41,866 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:41,867 - pacs_operations - INFO - Asociación establecida con PACS para Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:41,957 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:41,959 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:41,974 - pacs_operations - INFO - ÉXITO: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:41,988 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:42,020 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:42,021 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:42,025 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:42,080 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:42,095 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:42,141 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:42,168 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:42,183 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:42,191 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:42,257 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:42,694 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:43,129 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,133 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,137 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,174 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,178 - pacs_operations - INFO - ÉXITO: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,192 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,192 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:43,218 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,242 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:43,265 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,295 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,302 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,326 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,333 - pacs_operations - INFO - Asociación establecida con PACS para Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,385 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,394 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,400 - pacs_operations - INFO - ÉXITO: Img13_SN1938BX_KVP70_mAs0.58_IE28.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,401 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,402 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,407 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,411 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,414 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,418 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,430 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:43,437 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:43,440 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,441 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:43,445 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,455 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,457 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,461 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,462 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,465 - pacs_operations - INFO - Asociación establecida con PACS para Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,474 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,481 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,544 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,546 - pacs_operations - INFO - ÉXITO: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,549 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,557 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,567 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:43,567 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,576 - pacs_operations - INFO - ÉXITO: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:43,588 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:43,591 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,593 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:43,609 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:43,612 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,613 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:43,622 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,633 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,634 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,641 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:43,659 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,660 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:43,663 - pacs_operations - INFO - Asociación establecida con PACS para Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,665 - pacs_operations - INFO - Asociación establecida con PACS para Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:43,710 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:43,801 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:44,007 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:44,052 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:44,211 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:44,240 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:44,274 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:44,381 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:45,043 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,050 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,056 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,065 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,068 - pacs_operations - INFO - ÉXITO: Img20_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,070 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,092 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,100 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,103 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,111 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:51:45,118 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:51:45,140 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,144 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,149 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:51:45,165 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,231 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:45,241 - pacs_operations - INFO - Asociación establecida con PACS para Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:45,349 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:45,358 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,359 - pacs_operations - INFO - ÉXITO: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,359 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,365 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:51:45,370 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,371 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,373 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,374 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,377 - pacs_operations - INFO - ÉXITO: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,378 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,379 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,384 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,386 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,389 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,391 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:45,393 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:45,396 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:51:45,397 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:45,404 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,404 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,406 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 15:51:45,416 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:45,419 - pacs_operations - INFO - Asociación establecida con PACS para Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:45,422 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,423 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:45,431 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:45,433 - pacs_operations - INFO - Asociación establecida con PACS para Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:45,434 - pacs_operations - INFO - ÉXITO: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:45,438 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:45,439 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:45,447 - pacs_operations - INFO - Asociación establecida con PACS para Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:45,456 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:51:45,465 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:45,476 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:45,486 - pacs_operations - INFO - Asociación establecida con PACS para Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:45,689 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:45,760 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:45,794 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:45,831 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:45,857 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:46,260 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,266 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,266 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,268 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,328 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:46,338 - pacs_operations - INFO - ÉXITO: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:46,341 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:46,387 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm
2025-05-23 15:51:46,405 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:46,476 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,485 - pacs_operations - INFO - Asociación establecida con PACS para Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,644 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:46,656 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:46,660 - pacs_operations - INFO - ÉXITO: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:46,664 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:46,666 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:46,666 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:46,673 - pacs_operations - INFO - ÉXITO: Img22_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:46,673 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:46,677 - pacs_operations - INFO - ÉXITO: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:46,682 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:46,683 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:46,685 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:46,699 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:46,700 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:46,702 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:46,718 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:46,718 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:46,721 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:46,737 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:51:46,738 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:46,748 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:46,754 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:46,758 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,760 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:46,762 - pacs_operations - INFO - Asociación establecida con PACS para Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,769 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,770 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,776 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:46,777 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,785 - pacs_operations - INFO - ÉXITO: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:46,786 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,786 - pacs_operations - INFO - Asociación establecida con PACS para Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,790 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:46,791 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:46,818 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-23 15:51:46,837 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:46,847 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:46,851 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:47,156 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:47,221 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:47,253 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:47,259 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:47,291 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:47,958 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:47,961 - pacs_operations - INFO - ÉXITO: Img23_SN1938BX_KVP70_mAs3.19_IE150.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:47,965 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,007 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:51:48,015 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:48,051 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,053 - pacs_operations - INFO - ÉXITO: Img39_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,058 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,065 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:48,068 - pacs_operations - INFO - Asociación establecida con PACS para Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:48,103 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,106 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:51:48,111 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,116 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,119 - pynetdicom.association - INFO - Requesting Association
2025-05-23 15:51:48,160 - pynetdicom.acse - INFO - Association Accepted
2025-05-23 15:51:48,165 - pacs_operations - INFO - Asociación establecida con PACS para Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm. Contextos de presentación aceptados: 7
2025-05-23 15:51:48,227 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,230 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,231 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,319 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:48,320 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,331 - pacs_operations - INFO - ÉXITO: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,341 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,342 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-23 15:51:48,351 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,352 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,353 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,355 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,357 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,360 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,361 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,363 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,366 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,736 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,737 - pacs_operations - INFO - ÉXITO: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,737 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,760 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-23 15:51:48,761 - pacs_operations - INFO - ÉXITO: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-23 15:51:48,762 - pynetdicom.association - INFO - Releasing Association
2025-05-23 15:51:48,776 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/tmp/pacs/output_processed_dicom: 40 de 40 exitosos, 0 de 40 fallidos.
2025-05-23 15:51:48,776 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-23 15:51:48,777 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:51:48,799 - __main__ - INFO - Aplicación finalizada.
2025-05-23 15:57:17,960 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/tmp/pacs/dicom_workflow.log
2025-05-23 15:57:19,636 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 15:57:19,953 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 15:57:20,045 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 15:57:20,046 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 15:57:20,047 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 15:57:20,047 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/tmp/pacs/data/linearizacion.csv
2025-05-23 15:57:20,079 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/tmp/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 15:57:20,080 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 15:57:20,081 - __main__ - INFO - Se encontraron 40 ficheros para procesar en /home/aotal/tmp/pacs/input_dicom_files.
2025-05-23 15:57:20,081 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-05-23 15:57:20,082 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:57:20,101 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:20,645 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-05-23 15:57:20,645 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:57:20,645 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-05-23 15:57:21,451 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:21,459 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:21,459 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 ---
2025-05-23 15:57:21,477 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:57:21,494 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:22,118 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 descomprimido exitosamente.
2025-05-23 15:57:22,118 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:57:22,118 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 para clasificación BAML...
2025-05-23 15:57:23,211 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:23,212 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:23,212 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 ---
2025-05-23 15:57:23,224 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:57:23,249 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:23,782 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 descomprimido exitosamente.
2025-05-23 15:57:23,782 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:57:23,783 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 para clasificación BAML...
2025-05-23 15:57:24,788 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:24,788 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:24,789 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 ---
2025-05-23 15:57:24,808 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:57:24,856 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:25,553 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 descomprimido exitosamente.
2025-05-23 15:57:25,554 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:57:25,554 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 para clasificación BAML...
2025-05-23 15:57:26,669 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:26,670 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:26,678 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-05-23 15:57:26,678 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:57:26,699 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:27,243 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-05-23 15:57:27,244 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:57:27,244 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-05-23 15:57:28,422 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:28,423 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:28,423 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 ---
2025-05-23 15:57:28,434 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:57:28,462 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:28,988 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 descomprimido exitosamente.
2025-05-23 15:57:28,989 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:57:28,989 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 para clasificación BAML...
2025-05-23 15:57:30,276 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:30,277 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:30,277 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-05-23 15:57:30,293 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:57:30,322 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:30,913 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-05-23 15:57:30,914 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:57:30,915 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-05-23 15:57:31,792 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:31,793 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:31,802 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 ---
2025-05-23 15:57:31,806 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:57:32,123 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:32,669 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 descomprimido exitosamente.
2025-05-23 15:57:32,669 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:57:32,669 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 para clasificación BAML...
2025-05-23 15:57:34,607 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:34,608 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:34,608 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 ---
2025-05-23 15:57:34,647 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:57:34,674 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:35,206 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 descomprimido exitosamente.
2025-05-23 15:57:35,206 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:57:35,207 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 para clasificación BAML...
2025-05-23 15:57:36,297 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:36,297 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 ---
2025-05-23 15:57:36,297 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:57:36,328 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:36,836 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:36,837 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:36,838 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:36,846 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 descomprimido exitosamente.
2025-05-23 15:57:36,847 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:57:36,848 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 para clasificación BAML...
2025-05-23 15:57:38,215 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:38,215 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 ---
2025-05-23 15:57:38,216 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:57:38,276 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:39,483 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:39,483 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:39,484 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:39,502 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 descomprimido exitosamente.
2025-05-23 15:57:39,502 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:57:39,502 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 para clasificación BAML...
2025-05-23 15:57:39,744 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:39,745 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:40,252 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:40,252 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:42,543 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:42,543 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:44,592 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:44,593 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 ---
2025-05-23 15:57:44,593 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:44,593 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:57:44,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:45,672 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 descomprimido exitosamente.
2025-05-23 15:57:45,673 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:57:45,673 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 para clasificación BAML...
2025-05-23 15:57:46,650 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:57:46,650 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:57:46,742 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:46,742 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:47,171 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:47,171 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:48,194 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:48,194 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 ---
2025-05-23 15:57:48,195 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:48,195 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:57:48,208 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:57:48,266 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:48,959 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 descomprimido exitosamente.
2025-05-23 15:57:48,959 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:57:48,960 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 para clasificación BAML...
2025-05-23 15:57:50,209 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:50,840 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:57:50,841 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:57:51,137 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:57:51,400 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:51,401 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 ---
2025-05-23 15:57:51,401 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:51,401 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:57:51,431 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:51,999 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 descomprimido exitosamente.
2025-05-23 15:57:52,000 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:57:52,000 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 para clasificación BAML...
2025-05-23 15:57:53,137 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:53,282 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:53,282 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 ---
2025-05-23 15:57:53,282 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:53,283 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:57:53,357 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:54,118 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:57:54,124 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 descomprimido exitosamente.
2025-05-23 15:57:54,125 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:57:54,125 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 para clasificación BAML...
2025-05-23 15:57:55,285 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:55,285 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-05-23 15:57:55,285 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:55,286 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:57:55,321 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:56,120 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:56,144 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-05-23 15:57:56,145 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:57:56,145 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-05-23 15:57:56,520 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:57:57,106 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:57:57,859 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:57,860 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 ---
2025-05-23 15:57:57,860 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:57,860 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:57:57,907 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:57:58,745 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 descomprimido exitosamente.
2025-05-23 15:57:58,747 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 15:57:58,748 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 para clasificación BAML...
2025-05-23 15:57:59,107 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:59,936 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:57:59,980 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:57:59,982 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-05-23 15:57:59,982 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:57:59,982 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:58:00,057 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:00,071 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:00,716 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:00,727 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-05-23 15:58:00,728 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:58:00,728 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-05-23 15:58:01,938 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:02,624 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:04,057 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:04,247 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:04,247 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 ---
2025-05-23 15:58:04,247 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:58:04,305 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:04,922 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:04,922 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:04,938 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 descomprimido exitosamente.
2025-05-23 15:58:04,938 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1
2025-05-23 15:58:04,944 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242984.1 para clasificación BAML...
2025-05-23 15:58:05,950 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:06,478 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:06,932 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:07,205 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:07,798 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:07,798 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 ---
2025-05-23 15:58:07,799 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:58:07,933 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:08,472 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 descomprimido exitosamente.
2025-05-23 15:58:08,472 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:58:08,472 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 para clasificación BAML...
2025-05-23 15:58:09,075 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:09,205 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:09,602 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:09,603 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 ---
2025-05-23 15:58:09,603 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:58:09,618 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:10,162 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:10,170 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 descomprimido exitosamente.
2025-05-23 15:58:10,171 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:58:10,171 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 para clasificación BAML...
2025-05-23 15:58:10,479 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:11,641 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:11,642 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 ---
2025-05-23 15:58:11,642 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:58:11,834 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:12,596 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 descomprimido exitosamente.
2025-05-23 15:58:12,597 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 15:58:12,597 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 para clasificación BAML...
2025-05-23 15:58:13,081 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:15,912 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:16,086 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:16,086 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 ---
2025-05-23 15:58:16,087 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:58:16,119 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:16,655 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:16,671 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 descomprimido exitosamente.
2025-05-23 15:58:16,672 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1
2025-05-23 15:58:16,672 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241082.1 para clasificación BAML...
2025-05-23 15:58:17,132 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:18,729 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:18,730 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-05-23 15:58:18,730 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:58:18,868 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:19,105 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:19,446 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-05-23 15:58:19,446 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:58:19,446 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-05-23 15:58:19,586 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:20,570 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:20,570 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-05-23 15:58:20,571 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:58:20,636 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:20,657 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:21,250 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:21,255 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-05-23 15:58:21,255 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-23 15:58:21,255 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-05-23 15:58:21,743 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:22,444 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:22,445 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 ---
2025-05-23 15:58:22,445 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:58:22,538 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:23,167 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 descomprimido exitosamente.
2025-05-23 15:58:23,168 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-23 15:58:23,168 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 para clasificación BAML...
2025-05-23 15:58:23,912 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:24,636 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:24,655 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:24,990 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:25,253 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:25,344 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:25,345 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 ---
2025-05-23 15:58:25,345 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:58:25,427 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:26,119 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 descomprimido exitosamente.
2025-05-23 15:58:26,120 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-23 15:58:26,121 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 para clasificación BAML...
2025-05-23 15:58:27,119 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:27,520 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:27,520 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-05-23 15:58:27,521 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:58:27,542 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:27,782 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:28,082 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-05-23 15:58:28,082 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-23 15:58:28,083 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-05-23 15:58:28,353 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:29,621 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:30,606 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:30,607 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 ---
2025-05-23 15:58:30,607 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:58:30,629 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:30,886 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:31,220 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 descomprimido exitosamente.
2025-05-23 15:58:31,220 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-23 15:58:31,221 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 para clasificación BAML...
2025-05-23 15:58:31,432 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:31,656 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:31,831 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:32,395 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:32,395 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 ---
2025-05-23 15:58:32,396 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:58:32,432 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:33,027 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:33,034 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:33,044 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 descomprimido exitosamente.
2025-05-23 15:58:33,054 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1
2025-05-23 15:58:33,054 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241391.1 para clasificación BAML...
2025-05-23 15:58:34,345 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:34,346 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-05-23 15:58:34,346 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:58:34,373 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:34,899 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-05-23 15:58:34,899 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-23 15:58:34,900 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-05-23 15:58:35,194 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:35,775 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:36,211 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:36,211 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 ---
2025-05-23 15:58:36,213 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:58:36,230 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:36,527 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:36,919 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 descomprimido exitosamente.
2025-05-23 15:58:36,920 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1
2025-05-23 15:58:36,920 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241182.1 para clasificación BAML...
2025-05-23 15:58:36,984 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:37,194 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:37,776 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:38,577 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:38,578 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-05-23 15:58:38,578 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:58:38,625 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:38,951 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:39,335 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:39,335 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:39,384 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-05-23 15:58:39,385 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-23 15:58:39,385 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-05-23 15:58:39,831 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:40,163 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:41,369 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:42,952 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:43,540 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:43,616 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:43,617 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 ---
2025-05-23 15:58:43,617 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:58:44,410 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:45,066 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:45,087 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 descomprimido exitosamente.
2025-05-23 15:58:45,088 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-23 15:58:45,088 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 para clasificación BAML...
2025-05-23 15:58:45,193 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:46,952 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:47,541 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:49,372 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:51,015 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 199186, Requested 1623. Please try again in 242ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:58:51,645 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:51,645 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-05-23 15:58:51,646 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:58:51,700 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:52,234 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-05-23 15:58:52,234 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-23 15:58:52,234 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-05-23 15:58:53,015 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:53,382 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:58:55,213 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:55,213 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-05-23 15:58:55,213 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:58:55,783 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:56,419 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-05-23 15:58:56,419 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-23 15:58:56,419 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-05-23 15:58:58,803 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:58:58,804 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 ---
2025-05-23 15:58:58,804 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:58:58,823 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:58:59,364 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 descomprimido exitosamente.
2025-05-23 15:58:59,364 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1
2025-05-23 15:58:59,367 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239809.1 para clasificación BAML...
2025-05-23 15:58:59,492 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-23 15:58:59,493 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:58:59,493 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:00,809 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:59:00,810 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 ---
2025-05-23 15:59:00,811 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:59:00,831 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:59:01,386 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 descomprimido exitosamente.
2025-05-23 15:59:01,386 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1
2025-05-23 15:59:01,386 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241274.1 para clasificación BAML...
2025-05-23 15:59:02,917 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:59:02,917 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-05-23 15:59:02,918 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:59:02,965 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:59:03,474 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-05-23 15:59:03,474 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-23 15:59:03,474 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-05-23 15:59:03,505 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:59:03,505 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:59:03,506 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:03,522 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-23 15:59:03,523 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-23 15:59:03,523 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:04,289 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:05,003 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:59:05,004 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-05-23 15:59:05,004 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:59:05,057 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-23 15:59:05,275 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:59:05,275 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:59:05,276 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:59:05,276 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:59:05,276 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:05,277 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:05,575 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-05-23 15:59:05,577 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-23 15:59:05,578 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-05-23 15:59:06,290 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:06,465 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 15:59:06,474 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-05-23 15:59:06,476 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-05-23 15:59:06,476 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-05-23 15:59:06,477 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:59:06,479 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:06,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:06,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:06,485 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:06,486 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-23 15:59:06,509 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:06,509 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-05-23 15:59:06,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:06,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:06,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:06,803 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:59:06,803 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:59:06,804 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1: 'FDT'
2025-05-23 15:59:06,804 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 (desactivada o datos insuficientes).
2025-05-23 15:59:06,804 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1...
2025-05-23 15:59:06,806 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:59:06,806 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:06,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:06,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:06,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:06,807 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1
2025-05-23 15:59:06,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:06,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] LUT Kerma aplicada.
2025-05-23 15:59:06,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:06,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:06,809 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:07,133 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:07,133 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240455.1 procesado y guardado como: Img15_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:07,133 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1: 'FDT'
2025-05-23 15:59:07,134 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 (desactivada o datos insuficientes).
2025-05-23 15:59:07,134 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1...
2025-05-23 15:59:07,134 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:59:07,134 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:07,135 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:07,136 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:07,136 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:07,136 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1
2025-05-23 15:59:07,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:07,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] LUT Kerma aplicada.
2025-05-23 15:59:07,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:07,142 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:07,142 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:07,335 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:59:07,335 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-23 15:59:07,341 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:59:07,343 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-23 15:59:07,349 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:07,349 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:07,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:07,439 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240989.1 procesado y guardado como: Img19_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:07,439 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1: 'FDT'
2025-05-23 15:59:07,440 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 (desactivada o datos insuficientes).
2025-05-23 15:59:07,446 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1...
2025-05-23 15:59:07,447 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:59:07,447 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:07,447 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:07,448 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:07,448 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:07,448 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-23 15:59:07,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:07,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] LUT Kerma aplicada.
2025-05-23 15:59:07,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:07,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:07,452 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:09,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:59:09,043 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 procesado y guardado como: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-23 15:59:09,043 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1: 'FDT'
2025-05-23 15:59:09,043 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 (desactivada o datos insuficientes).
2025-05-23 15:59:09,043 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1...
2025-05-23 15:59:09,044 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:59:09,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:09,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:09,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:09,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:09,044 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-23 15:59:09,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:09,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] LUT Kerma aplicada.
2025-05-23 15:59:09,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:09,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:09,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:09,404 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:09,450 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:59:09,450 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 procesado y guardado como: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-23 15:59:09,450 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-05-23 15:59:09,450 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-05-23 15:59:09,450 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-05-23 15:59:09,451 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:59:09,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:09,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:09,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:59:09,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:59:09,451 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-23 15:59:09,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:09,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-05-23 15:59:09,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:09,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:09,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:10,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:59:10,036 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:59:10,037 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-05-23 15:59:10,037 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-05-23 15:59:10,037 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-05-23 15:59:10,037 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:59:10,037 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:10,038 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:10,038 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:10,038 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:10,038 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-23 15:59:10,041 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:10,041 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-05-23 15:59:10,041 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:10,042 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:10,042 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:10,591 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:59:10,591 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-23 15:59:10,592 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1: 'FDT'
2025-05-23 15:59:10,592 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 (desactivada o datos insuficientes).
2025-05-23 15:59:10,592 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1...
2025-05-23 15:59:10,592 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:59:10,592 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:10,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:10,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:10,593 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:10,593 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-23 15:59:10,597 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:10,598 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] LUT Kerma aplicada.
2025-05-23 15:59:10,598 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:10,598 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:10,598 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:10,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:59:10,920 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 procesado y guardado como: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:59:10,921 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1: 'FDT'
2025-05-23 15:59:10,922 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 (desactivada o datos insuficientes).
2025-05-23 15:59:10,922 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1...
2025-05-23 15:59:10,922 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:59:10,922 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:10,922 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:10,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:10,923 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:10,923 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1
2025-05-23 15:59:10,924 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:10,924 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] LUT Kerma aplicada.
2025-05-23 15:59:10,925 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:10,925 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:10,926 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:11,334 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:11,334 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240895.1 procesado y guardado como: Img18_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:11,334 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9a37076e0 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:11,414 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:11,419 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:11,424 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:11,425 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 (desactivada o datos insuficientes).
2025-05-23 15:59:11,425 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1...
2025-05-23 15:59:11,425 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:59:11,430 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:11,430 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:11,431 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:11,431 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:11,431 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-23 15:59:11,433 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:11,433 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] LUT Kerma aplicada.
2025-05-23 15:59:11,433 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:11,433 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:11,433 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:11,698 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:11,731 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:59:11,731 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 procesado y guardado como: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-23 15:59:11,820 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9c9fbf740 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:11,823 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:11,823 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:11,823 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 (desactivada o datos insuficientes).
2025-05-23 15:59:11,824 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1...
2025-05-23 15:59:11,824 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:59:11,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:11,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:11,826 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:11,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:11,827 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1
2025-05-23 15:59:11,831 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:11,831 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] LUT Kerma aplicada.
2025-05-23 15:59:11,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:11,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:11,834 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:12,689 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:12,689 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:12,692 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-23 15:59:12,693 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 15:59:12,702 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:12,735 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:12,736 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240551.1 procesado y guardado como: Img16_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:12,736 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9a3717980 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:12,737 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:12,737 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:12,737 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 (desactivada o datos insuficientes).
2025-05-23 15:59:12,737 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1...
2025-05-23 15:59:12,737 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:59:12,737 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:12,738 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:12,738 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:12,738 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:12,738 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-23 15:59:12,741 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:12,741 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] LUT Kerma aplicada.
2025-05-23 15:59:12,741 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:12,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:12,742 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:13,199 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:59:13,212 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 procesado y guardado como: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-23 15:59:13,212 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9a3723b30 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:13,213 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:13,214 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:13,214 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 (desactivada o datos insuficientes).
2025-05-23 15:59:13,214 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1...
2025-05-23 15:59:13,214 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:59:13,214 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:13,214 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:13,215 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:13,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:13,215 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-23 15:59:13,233 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:13,233 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] LUT Kerma aplicada.
2025-05-23 15:59:13,233 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:13,233 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:13,233 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:13,725 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:13,726 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:13,796 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:59:13,796 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 procesado y guardado como: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-23 15:59:13,796 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9c9f777a0 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:13,798 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:13,798 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:13,798 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 (desactivada o datos insuficientes).
2025-05-23 15:59:13,798 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1...
2025-05-23 15:59:13,799 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:59:13,799 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:13,800 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:13,800 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:13,801 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:13,801 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1
2025-05-23 15:59:13,804 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:13,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] LUT Kerma aplicada.
2025-05-23 15:59:13,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:13,806 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:13,808 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:14,492 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:14,494 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240645.1 procesado y guardado como: Img17_SN1938BX_KVP70_mAs1.58_IE74.dcm
2025-05-23 15:59:14,494 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9a3767bc0 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:14,497 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:14,498 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:14,498 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-05-23 15:59:14,498 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-05-23 15:59:14,499 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:59:14,499 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:14,500 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:14,501 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:14,502 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:14,503 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-23 15:59:14,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:14,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-05-23 15:59:14,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:14,508 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:14,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:14,698 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:14,699 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:14,816 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:59:14,817 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-23 15:59:14,817 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/tmp/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/tmp/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x7fe9a3765ee0 state=finished raised BamlClientHttpError>]
2025-05-23 15:59:14,818 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1: 'ErrorBAMLExecutorGeneral'
2025-05-23 15:59:14,818 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-23 15:59:14,819 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 (desactivada o datos insuficientes).
2025-05-23 15:59:14,819 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1...
2025-05-23 15:59:14,819 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:59:14,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:14,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:14,819 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-23 15:59:14,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-23 15:59:14,819 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1
2025-05-23 15:59:14,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:14,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] LUT Kerma aplicada.
2025-05-23 15:59:14,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:14,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:14,821 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] SpecificCharacterSet actual es 'ISO_IR 100'. Considera cambiarlo a 'ISO_IR 192' (UTF-8) por robustez.
2025-05-23 15:59:15,403 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:15,544 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:59:15,544 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414243098.1 procesado y guardado como: Img40_SN1938BX_KVP70_mAs2.79_IE131.dcm
2025-05-23 15:59:15,555 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-05-23 15:59:15,556 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-05-23 15:59:15,556 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-05-23 15:59:15,556 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:59:15,557 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:15,557 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:15,558 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 15:59:15,558 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 15:59:15,558 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-23 15:59:15,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:15,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-05-23 15:59:15,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:15,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:15,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:16,361 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:59:16,362 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-23 15:59:16,362 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1: 'FDT'
2025-05-23 15:59:16,363 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 (desactivada o datos insuficientes).
2025-05-23 15:59:16,363 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1...
2025-05-23 15:59:16,363 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:59:16,364 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:16,370 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:16,372 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 15:59:16,376 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 15:59:16,376 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1
2025-05-23 15:59:16,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:16,380 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] LUT Kerma aplicada.
2025-05-23 15:59:16,380 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:16,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:16,381 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:16,818 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:59:16,823 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414240265.1 procesado y guardado como: Img14_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-23 15:59:16,823 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-05-23 15:59:16,823 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-05-23 15:59:16,823 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-05-23 15:59:16,824 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:59:16,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:16,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 15:59:16,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-23 15:59:16,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-23 15:59:16,826 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-23 15:59:16,839 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 15:59:16,839 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-05-23 15:59:16,840 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 15:59:16,840 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 15:59:16,840 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 15:59:17,200 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:59:17,234 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-23 15:59:17,288 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1: 'FDT'
2025-05-23 15:59:17,367 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 (desactivada o datos insuficientes).
2025-05-23 15:59:17,438 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:17,509 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1...
2025-05-23 15:59:21,021 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 15:59:23,167 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 15:59:23,201 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 15:59:24,468 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 15:59:28,439 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 16:00:16,500 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=CustomGPT4oMini, message=Request failed with status code: 429 Too Many Requests. {"error":{"message":"Rate limit reached for gpt-4o-mini in organization org-A8AccMbMts6VnIgCEu2spvFU on tokens per min (TPM): Limit 200000, Used 200000, Requested 1623. Please try again in 486ms. Visit https://platform.openai.com/account/rate-limits to learn more.","type":"tokens","param":null,"code":"rate_limit_exceeded"}}, status_code=429).
2025-05-23 16:00:16,520 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 16:00:16,521 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 16:00:16,577 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 16:00:16,578 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 16:00:16,578 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-23 16:00:16,522 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 16:00:16,536 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 16:00:16,536 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 16:00:16,711 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 16:00:16,711 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] LUT Kerma aplicada.
2025-05-23 16:00:16,711 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 16:00:16,712 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 16:00:16,713 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 16:00:17,536 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 16:00:17,570 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 procesado y guardado como: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-23 16:00:17,584 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1: 'FDT'
2025-05-23 16:00:17,584 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 (desactivada o datos insuficientes).
2025-05-23 16:00:17,584 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1...
2025-05-23 16:00:17,595 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 16:00:17,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 16:00:17,600 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 16:00:17,601 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 16:00:17,602 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 16:00:17,603 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1
2025-05-23 16:00:17,759 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 16:00:17,769 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] LUT Kerma aplicada.
2025-05-23 16:00:17,770 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 16:00:17,771 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 16:00:17,772 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 16:00:18,918 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 16:00:21,232 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1] Archivo DICOM procesado y guardado como: /home/aotal/tmp/pacs/output_processed_dicom/Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 16:00:21,358 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241505.1 procesado y guardado como: Img24_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-23 16:00:21,461 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1: 'FDT'
2025-05-23 16:00:21,462 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 (desactivada o datos insuficientes).
2025-05-23 16:00:21,462 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1...
2025-05-23 16:00:21,472 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 16:00:21,478 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientID establecido/actualizado a: SN1938BX
2025-05-23 16:00:21,483 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-23 16:00:21,483 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-23 16:00:21,487 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-23 16:00:21,487 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-23 16:00:21,554 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 16:00:21,555 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] LUT Kerma aplicada.
2025-05-23 16:00:21,555 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Forzando ImageType a un valor conocido y válido.
2025-05-23 16:00:21,556 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 16:00:21,556 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 21:20:26,732 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-23 21:20:30,243 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 21:20:30,646 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 21:20:30,893 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 21:20:30,893 - config - WARNING - CONFIG WARNING: Directorio de entrada DICOM no encontrado en la ruta esperada: /home/aotal/github/pacs/input_dicom_files
2025-05-23 21:20:30,893 - __main__ - CRITICAL - Abortando debido a errores de configuración de rutas.
2025-05-23 21:21:51,247 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-23 21:21:52,347 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 21:21:52,820 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 21:21:52,878 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 21:21:52,878 - config - WARNING - CONFIG WARNING: Directorio de entrada DICOM no encontrado en la ruta esperada: /home/aotal/github/pacs/input_dicom_files
2025-05-23 21:21:52,879 - __main__ - CRITICAL - Abortando debido a errores de configuración de rutas.
2025-05-23 21:22:19,014 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-23 21:22:20,031 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 21:22:20,398 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 21:22:20,455 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 21:22:20,456 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 21:22:20,456 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 21:22:20,456 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-23 21:22:20,460 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 21:22:20,460 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 21:22:20,461 - __main__ - INFO - No se encontraron ficheros en /home/aotal/github/pacs/input_dicom_files. Finalizando.
2025-05-23 21:22:20,461 - __main__ - INFO - Aplicación finalizada.
2025-05-23 21:23:27,642 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-23 21:23:28,666 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-23 21:23:28,990 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-23 21:23:29,052 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-23 21:23:29,052 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-23 21:23:29,053 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 21:23:29,053 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-23 21:23:29,056 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-23 21:23:29,056 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-23 21:23:29,057 - __main__ - INFO - Se encontraron 2 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-23 21:23:29,057 - __main__ - INFO - --- Iniciando procesamiento para: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm ---
2025-05-23 21:23:29,057 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm
2025-05-23 21:23:29,076 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm
2025-05-23 21:23:29,077 - __main__ - INFO - Enviando imagen Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm para clasificación BAML...
2025-05-23 21:23:30,843 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-23 21:23:30,845 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-23 21:23:30,845 - __main__ - INFO - --- Iniciando procesamiento para: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier ---
2025-05-23 21:23:30,857 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier
2025-05-23 21:23:30,857 - dicom_processing_pipeline - ERROR - Atributo no encontrado procesando Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier: 'FileMetaDataset' object has no attribute 'TransferSyntaxUID'
2025-05-23 21:23:30,858 - __main__ - ERROR - No se pudo leer o obtener píxeles de Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier. Omitiendo.
2025-05-23 21:23:34,714 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-23 21:23:34,714 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-23 21:23:34,715 - __main__ - INFO - Clasificación BAML (mapeada) para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm: 'MTF'
2025-05-23 21:23:34,715 - __main__ - INFO - Linealización física omitida para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm (desactivada o datos insuficientes).
2025-05-23 21:23:34,715 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm...
2025-05-23 21:23:34,716 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993
2025-05-23 21:23:34,716 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PatientID establecido/actualizado a: SN1510CG
2025-05-23 21:23:34,716 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PatientName establecido/actualizado a: DiDiDR02_Portable
2025-05-23 21:23:34,717 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-23 21:23:34,717 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-23 21:23:34,717 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993
2025-05-23 21:23:34,718 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-23 21:23:34,718 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] LUT Kerma aplicada.
2025-05-23 21:23:34,718 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Forzando ImageType a un valor conocido y válido.
2025-05-23 21:23:34,719 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-23 21:23:34,719 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-23 21:23:34,761 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-23 21:23:34,762 - __main__ - INFO - Fichero Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm procesado y guardado como: Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-23 21:23:34,762 - __main__ - INFO - ÉXITO en procesamiento de Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm -> Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-23 21:23:34,762 - __main__ - WARNING - FALLO/OMISIÓN: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier no generó fichero de salida.
2025-05-23 21:23:34,762 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-23 21:23:34,763 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-23 21:23:34,767 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-23 21:23:34,769 - pynetdicom.association - INFO - Requesting Association
2025-05-23 21:23:34,829 - pynetdicom.transport - ERROR - Association request failed: unable to connect to remote
2025-05-23 21:23:34,829 - pynetdicom.transport - ERROR - TCP Initialisation Error: [Errno -2] Name or service not known
2025-05-23 21:23:34,829 - pynetdicom.association - INFO - Aborting Association
2025-05-23 21:23:34,930 - pacs_operations - ERROR - No se pudo establecer asociación con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm.
2025-05-23 21:23:34,930 - pacs_operations - ERROR -   Detalles de la primitiva A-ASSOCIATE-RJ (si es un rechazo): None
2025-05-23 21:23:34,931 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-23 21:23:34,931 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-23 21:23:34,931 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-23 21:23:34,933 - __main__ - INFO - Aplicación finalizada.
2025-05-25 10:53:54,478 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/pacs/dicom_workflow.log
2025-05-25 10:53:57,425 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-25 10:53:57,730 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-25 10:53:57,897 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-25 10:53:57,898 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-25 10:53:57,898 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-25 10:53:57,898 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/pacs/data/linearizacion.csv
2025-05-25 10:53:57,902 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/pacs/data/linearizacion.csv: 6 puntos.
2025-05-25 10:53:57,902 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-25 10:53:57,903 - __main__ - INFO - Se encontraron 2 ficheros para procesar en /home/aotal/pacs/input_dicom_files.
2025-05-25 10:53:57,903 - __main__ - INFO - --- Iniciando procesamiento para: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm ---
2025-05-25 10:53:57,903 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm
2025-05-25 10:53:57,934 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm
2025-05-25 10:53:57,934 - __main__ - INFO - Enviando imagen Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm para clasificación BAML...
2025-05-25 10:53:59,282 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-25 10:53:59,284 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-25 10:53:59,284 - __main__ - INFO - --- Iniciando procesamiento para: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier ---
2025-05-25 10:53:59,295 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier
2025-05-25 10:53:59,296 - dicom_processing_pipeline - ERROR - Atributo no encontrado procesando Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier: 'FileMetaDataset' object has no attribute 'TransferSyntaxUID'
2025-05-25 10:53:59,296 - __main__ - ERROR - No se pudo leer o obtener píxeles de Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier. Omitiendo.
2025-05-25 10:54:01,944 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-25 10:54:01,945 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-25 10:54:01,945 - __main__ - INFO - Clasificación BAML (mapeada) para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm: 'MTF'
2025-05-25 10:54:01,945 - __main__ - INFO - Linealización física omitida para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm (desactivada o datos insuficientes).
2025-05-25 10:54:01,945 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm...
2025-05-25 10:54:01,946 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993
2025-05-25 10:54:01,946 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PatientID establecido/actualizado a: SN1510CG
2025-05-25 10:54:01,946 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PatientName establecido/actualizado a: DiDiDR02_Portable
2025-05-25 10:54:01,946 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-25 10:54:01,946 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-25 10:54:01,946 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993
2025-05-25 10:54:01,947 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-25 10:54:01,948 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] LUT Kerma aplicada.
2025-05-25 10:54:01,948 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Forzando ImageType a un valor conocido y válido.
2025-05-25 10:54:01,948 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-25 10:54:01,948 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-25 10:54:01,978 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Archivo DICOM procesado y guardado como: /home/aotal/pacs/output_processed_dicom/Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:01,978 - __main__ - INFO - Fichero Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm procesado y guardado como: Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:01,979 - __main__ - INFO - ÉXITO en procesamiento de Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm -> Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:01,979 - __main__ - WARNING - FALLO/OMISIÓN: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier no generó fichero de salida.
2025-05-25 10:54:01,979 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-25 10:54:01,979 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-25 10:54:02,563 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:02,564 - pynetdicom.association - INFO - Requesting Association
2025-05-25 10:54:02,603 - pynetdicom.transport - ERROR - Association request failed: unable to connect to remote
2025-05-25 10:54:02,603 - pynetdicom.transport - ERROR - TCP Initialisation Error: [Errno -2] Name or service not known
2025-05-25 10:54:02,603 - pynetdicom.association - INFO - Aborting Association
2025-05-25 10:54:02,703 - pacs_operations - ERROR - No se pudo establecer asociación con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm.
2025-05-25 10:54:02,704 - pacs_operations - ERROR -   Detalles de la primitiva A-ASSOCIATE-RJ (si es un rechazo): None
2025-05-25 10:54:02,704 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-25 10:54:02,704 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-25 10:54:02,704 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-25 10:54:02,705 - __main__ - INFO - Aplicación finalizada.
2025-05-25 10:54:41,265 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/pacs/dicom_workflow.log
2025-05-25 10:54:42,323 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-25 10:54:42,606 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-25 10:54:42,662 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-25 10:54:42,662 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-25 10:54:42,662 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-25 10:54:42,662 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/pacs/data/linearizacion.csv
2025-05-25 10:54:42,666 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/pacs/data/linearizacion.csv: 6 puntos.
2025-05-25 10:54:42,666 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-25 10:54:42,667 - __main__ - INFO - Se encontraron 2 ficheros para procesar en /home/aotal/pacs/input_dicom_files.
2025-05-25 10:54:42,667 - __main__ - INFO - --- Iniciando procesamiento para: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm ---
2025-05-25 10:54:42,667 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm
2025-05-25 10:54:42,677 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm
2025-05-25 10:54:42,678 - __main__ - INFO - Enviando imagen Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm para clasificación BAML...
2025-05-25 10:54:43,919 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-25 10:54:43,921 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-25 10:54:43,921 - __main__ - INFO - --- Iniciando procesamiento para: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier ---
2025-05-25 10:54:43,930 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier
2025-05-25 10:54:43,931 - dicom_processing_pipeline - ERROR - Atributo no encontrado procesando Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier: 'FileMetaDataset' object has no attribute 'TransferSyntaxUID'
2025-05-25 10:54:43,931 - __main__ - ERROR - No se pudo leer o obtener píxeles de Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier. Omitiendo.
2025-05-25 10:54:54,016 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/miniconda3/lib/python3.12/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/miniconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/miniconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.BamlClientError: Something went wrong with the LLM client Gemini: reqwest::Error { kind: Request, url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent", source: hyper_util::client::legacy::Error(Connect, TimedOut) }
2025-05-25 10:54:54,022 - __main__ - INFO - Clasificación BAML (mapeada) para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm: 'ErrorBAMLExecutorGeneral'
2025-05-25 10:54:54,022 - __main__ - WARNING - Clasificación BAML para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-25 10:54:54,022 - __main__ - INFO - Linealización física omitida para Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm (desactivada o datos insuficientes).
2025-05-25 10:54:54,022 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm...
2025-05-25 10:54:54,022 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993
2025-05-25 10:54:54,023 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PatientID establecido/actualizado a: SN1510CG
2025-05-25 10:54:54,023 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PatientName establecido/actualizado a: DiDiDR02_Portable
2025-05-25 10:54:54,023 - dicom_processing_pipeline - WARNING - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-25 10:54:54,023 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-25 10:54:54,023 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993
2025-05-25 10:54:54,026 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-25 10:54:54,026 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] LUT Kerma aplicada.
2025-05-25 10:54:54,026 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Forzando ImageType a un valor conocido y válido.
2025-05-25 10:54:54,026 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-25 10:54:54,026 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-25 10:54:54,055 - dicom_processing_pipeline - INFO - [1.2.826.0.1.3680043.8.498.42044900197124354928246201361539914993] Archivo DICOM procesado y guardado como: /home/aotal/pacs/output_processed_dicom/Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:54,055 - __main__ - INFO - Fichero Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm procesado y guardado como: Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:54,055 - __main__ - INFO - ÉXITO en procesamiento de Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm -> Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:54,055 - __main__ - WARNING - FALLO/OMISIÓN: Img3__SN1510CG__KVP=70__mAs=13.0__IE=835.dcm:Zone.Identifier no generó fichero de salida.
2025-05-25 10:54:54,056 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-25 10:54:54,056 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-25 10:54:54,060 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1510CG_KVP70_mAs13.02_IE835.dcm
2025-05-25 10:54:54,061 - pynetdicom.association - INFO - Requesting Association
2025-05-25 10:56:25,962 - __main__ - INFO - Proceso interrumpido por el usuario.
2025-05-25 10:56:25,971 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:29:25,434 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:29:32,792 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:29:33,209 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:29:33,480 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:29:33,480 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:29:33,481 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:29:33,481 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:29:33,513 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:29:33,513 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:29:33,513 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:29:33,514 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:29:33,514 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:29:33,559 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:29:33,560 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-28 08:29:33,560 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/github/pacs/dicom_processing_pipeline.py", line 79, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-28 08:29:33,561 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1. Omitiendo.
2025-05-28 08:29:33,562 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 no generó fichero de salida.
2025-05-28 08:29:33,562 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-28 08:29:33,562 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:29:33,562 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:30:55,938 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:30:56,902 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:30:57,278 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:30:57,344 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:30:57,345 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:30:57,345 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:30:57,345 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:30:57,352 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:30:57,352 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:30:57,352 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:30:57,353 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:30:57,353 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:30:57,357 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:30:57,358 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-28 08:30:57,358 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/github/pacs/dicom_processing_pipeline.py", line 79, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-28 08:30:57,366 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1. Omitiendo.
2025-05-28 08:30:57,367 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 no generó fichero de salida.
2025-05-28 08:30:57,368 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-28 08:30:57,368 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:30:57,369 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:31:38,807 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:31:40,050 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:31:40,537 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:31:40,954 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:31:40,954 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:31:40,955 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:31:40,955 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:31:40,959 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:31:40,959 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:31:40,959 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:31:40,960 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:31:40,960 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:31:40,965 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:31:40,965 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-28 08:31:40,966 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/github/pacs/dicom_processing_pipeline.py", line 79, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-28 08:31:40,969 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1. Omitiendo.
2025-05-28 08:31:40,969 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 no generó fichero de salida.
2025-05-28 08:31:40,969 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-28 08:31:40,969 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:31:40,970 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:33:00,006 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:33:01,007 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:33:01,359 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:33:01,432 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:33:01,433 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:33:01,433 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:33:01,433 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:33:01,437 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:33:01,437 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:33:01,437 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:33:01,438 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:33:01,438 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:33:01,442 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:33:01,443 - dicom_processing_pipeline - ERROR - Error al descomprimir 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. ). 
2025-05-28 08:33:01,443 - dicom_processing_pipeline - ERROR - Error general leyendo o descomprimiendo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
Traceback (most recent call last):
  File "/home/aotal/github/pacs/dicom_processing_pipeline.py", line 79, in read_and_decompress_dicom
    pixel_array_for_baml = ds.pixel_array
                          ^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1955, in pixel_array
    self.convert_pixel_data()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1512, in convert_pixel_data
    self._convert_pixel_data_without_handler()
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/pydicom/dataset.py", line 1599, in _convert_pixel_data_without_handler
    raise RuntimeError(msg + ', '.join(pkg_msg))
RuntimeError: The following handlers are available to decode the pixel data however they are missing required dependencies: GDCM (req. ), pylibjpeg (req. )
2025-05-28 08:33:01,445 - __main__ - ERROR - No se pudo leer o obtener píxeles de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1. Omitiendo.
2025-05-28 08:33:01,445 - __main__ - WARNING - FALLO/OMISIÓN: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 no generó fichero de salida.
2025-05-28 08:33:01,446 - __main__ - INFO - No se generaron ficheros de salida válidos, no se enviará nada al PACS.
2025-05-28 08:33:01,446 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:33:01,446 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:36:22,374 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:36:23,394 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:36:23,740 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:36:23,804 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:36:23,805 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:36:23,805 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:36:23,806 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:36:23,811 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:36:23,811 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:36:23,812 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:36:23,812 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:36:23,812 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:36:23,816 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:36:24,225 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 descomprimido exitosamente.
2025-05-28 08:36:24,225 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:36:24,226 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 para clasificación BAML...
2025-05-28 08:36:25,112 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:36:25,119 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:36:28,078 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 08:36:28,085 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 08:36:28,085 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 08:36:28,085 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 (desactivada o datos insuficientes).
2025-05-28 08:36:28,085 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1...
2025-05-28 08:36:28,085 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:36:28,086 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientID establecido/actualizado a: SN2136FD
2025-05-28 08:36:28,086 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientName establecido/actualizado a: DiDiDR01_Portable
2025-05-28 08:36:28,086 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 08:36:28,087 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 08:36:28,087 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:36:28,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:36:28,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] LUT Kerma aplicada.
2025-05-28 08:36:28,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:36:28,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:36:28,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:36:28,166 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:36:28,167 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 procesado y guardado como: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:36:28,167 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 -> Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:36:28,167 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 08:36:28,167 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 08:36:28,175 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:36:28,179 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:36:28,195 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:36:28,196 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:36:28,214 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:36:30,985 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:36:30,987 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:36:30,994 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:36:30,997 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-28 08:36:30,997 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-28 08:36:30,997 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:36:31,005 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:38:41,718 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:38:42,656 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:38:42,989 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:38:43,055 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:38:43,056 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:38:43,057 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:38:43,057 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:38:43,061 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:38:43,061 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:38:43,061 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:38:43,062 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:38:43,062 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:38:43,065 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:38:43,448 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 descomprimido exitosamente.
2025-05-28 08:38:43,448 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:38:43,448 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 para clasificación BAML...
2025-05-28 08:38:44,292 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:38:44,293 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:38:46,979 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1.  The image is a monochromatic texture with a gradient-like quality and low contrast.  It fits the description of Type 1 perfectly.  The other types describe images with defined shapes and patterns, which are absent here.\n", Incomplete)., raw_output=Type 1.  The image is a monochromatic texture with a gradient-like quality and low contrast.  It fits the description of Type 1 perfectly.  The other types describe images with defined shapes and patterns, which are absent here.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 08:38:46,981 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 08:38:46,981 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 08:38:46,981 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 (desactivada o datos insuficientes).
2025-05-28 08:38:46,981 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1...
2025-05-28 08:38:46,982 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:38:46,982 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientID establecido/actualizado a: SN2136FD
2025-05-28 08:38:46,982 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientName establecido/actualizado a: DiDiDR01_Portable
2025-05-28 08:38:46,982 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 08:38:46,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 08:38:46,983 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:38:46,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:38:46,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] LUT Kerma aplicada.
2025-05-28 08:38:46,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:38:46,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:38:46,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:38:47,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:38:47,047 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 procesado y guardado como: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:38:47,047 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 -> Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:38:47,048 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 08:38:47,048 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 08:38:47,051 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:38:47,055 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:38:47,064 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:38:47,065 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:38:47,086 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:38:49,960 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:38:49,961 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:38:49,966 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:38:49,979 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-28 08:38:49,979 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-28 08:38:49,979 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:38:49,981 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:44:31,131 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:44:33,223 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:44:33,604 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:44:33,696 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:44:33,696 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:44:33,697 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:44:33,697 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:44:33,726 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:44:33,726 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:44:33,726 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:44:33,726 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:44:33,727 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:44:33,807 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:44:34,457 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 descomprimido exitosamente.
2025-05-28 08:44:34,458 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:44:34,458 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 para clasificación BAML...
2025-05-28 08:44:35,486 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:44:35,494 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:44:40,248 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 08:44:40,252 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 08:44:40,252 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 08:44:40,253 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 (desactivada o datos insuficientes).
2025-05-28 08:44:40,253 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1...
2025-05-28 08:44:40,253 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:44:40,253 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientID establecido/actualizado a: SN2136FD
2025-05-28 08:44:40,254 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientName establecido/actualizado a: DiDiDR01_Portable
2025-05-28 08:44:40,254 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 08:44:40,254 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 08:44:40,254 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:44:40,304 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:44:40,305 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] LUT Kerma aplicada.
2025-05-28 08:44:40,305 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:44:40,305 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:44:40,305 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:44:40,536 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:44:40,536 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 procesado y guardado como: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:44:40,536 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 -> Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:44:40,536 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 08:44:40,537 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 08:44:40,540 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:44:40,547 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:44:40,565 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:44:40,566 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:44:40,588 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:44:44,005 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:44:44,006 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:44:44,011 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:44:44,025 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-28 08:44:44,025 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-28 08:44:44,025 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:44:44,027 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:46:08,147 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:46:09,427 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:46:09,765 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:46:09,832 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:46:09,833 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:46:09,834 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:46:09,835 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:46:09,841 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:46:09,841 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:46:09,841 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:46:09,842 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 ---
2025-05-28 08:46:09,842 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:46:09,846 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:46:10,224 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 descomprimido exitosamente.
2025-05-28 08:46:10,224 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:46:10,224 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 para clasificación BAML...
2025-05-28 08:46:11,000 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:46:11,001 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:46:13,931 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 08:46:13,933 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 08:46:13,933 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 08:46:13,934 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 (desactivada o datos insuficientes).
2025-05-28 08:46:13,934 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1...
2025-05-28 08:46:13,934 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:46:13,934 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientID establecido/actualizado a: SN2136FD
2025-05-28 08:46:13,935 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PatientName establecido/actualizado a: DiDiDR01_Portable
2025-05-28 08:46:13,935 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 08:46:13,935 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 08:46:13,935 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1
2025-05-28 08:46:13,936 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:46:13,937 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] LUT Kerma aplicada.
2025-05-28 08:46:13,937 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:46:13,937 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:46:13,937 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:46:14,055 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:46:14,056 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 procesado y guardado como: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:46:14,056 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635484770538.1748253130091.1 -> Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:46:14,056 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 08:46:14,057 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 08:46:14,064 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm
2025-05-28 08:46:14,086 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:46:14,102 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:46:14,103 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:46:14,152 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:46:16,832 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:46:16,833 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN2136FD_KVP70_mAs1.99_IE109.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:46:16,839 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:46:16,842 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 0 de 1 exitosos, 1 de 1 fallidos.
2025-05-28 08:46:16,843 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-28 08:46:16,843 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:46:16,844 - __main__ - INFO - Aplicación finalizada.
2025-05-28 08:47:23,765 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 08:47:25,333 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 08:47:25,725 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 08:47:25,808 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 08:47:25,808 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 08:47:25,809 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:47:25,809 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 08:47:25,814 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 08:47:25,814 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 08:47:25,814 - __main__ - INFO - Se encontraron 12 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 08:47:25,815 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 ---
2025-05-28 08:47:25,815 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 08:47:25,818 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:26,424 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 descomprimido exitosamente.
2025-05-28 08:47:26,424 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 08:47:26,424 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 para clasificación BAML...
2025-05-28 08:47:27,831 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:27,832 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:27,832 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 ---
2025-05-28 08:47:27,855 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 08:47:27,875 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:28,720 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 descomprimido exitosamente.
2025-05-28 08:47:28,721 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 08:47:28,721 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 para clasificación BAML...
2025-05-28 08:47:30,005 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:30,006 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:30,023 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 ---
2025-05-28 08:47:30,029 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 08:47:30,033 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:30,683 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 descomprimido exitosamente.
2025-05-28 08:47:30,683 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 08:47:30,683 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 para clasificación BAML...
2025-05-28 08:47:33,229 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:33,229 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:34,382 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:34,382 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 ---
2025-05-28 08:47:34,382 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:34,383 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 08:47:34,508 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:35,386 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:35,386 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:36,127 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 descomprimido exitosamente.
2025-05-28 08:47:36,127 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 08:47:36,128 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 para clasificación BAML...
2025-05-28 08:47:38,846 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:38,847 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 ---
2025-05-28 08:47:38,847 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:38,847 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 08:47:38,859 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:39,456 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 descomprimido exitosamente.
2025-05-28 08:47:39,457 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 08:47:39,457 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 para clasificación BAML...
2025-05-28 08:47:41,429 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:41,429 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:41,572 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:41,573 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 ---
2025-05-28 08:47:41,573 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:41,573 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 08:47:41,585 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:42,202 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:42,203 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:42,206 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 descomprimido exitosamente.
2025-05-28 08:47:42,206 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 08:47:42,206 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 para clasificación BAML...
2025-05-28 08:47:44,441 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:44,441 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:44,715 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:44,716 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 ---
2025-05-28 08:47:44,716 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:44,717 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 08:47:44,728 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:45,404 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 descomprimido exitosamente.
2025-05-28 08:47:45,404 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 08:47:45,404 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 para clasificación BAML...
2025-05-28 08:47:46,500 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:46,501 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 ---
2025-05-28 08:47:46,501 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:46,501 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 08:47:46,511 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:47,134 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 descomprimido exitosamente.
2025-05-28 08:47:47,135 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 08:47:47,135 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 para clasificación BAML...
2025-05-28 08:47:48,052 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:48,052 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 ---
2025-05-28 08:47:48,052 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:48,053 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 08:47:48,062 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:48,592 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 descomprimido exitosamente.
2025-05-28 08:47:48,592 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 08:47:48,592 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 para clasificación BAML...
2025-05-28 08:47:51,428 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:51,429 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:52,133 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:52,133 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 ---
2025-05-28 08:47:52,134 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:52,134 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 08:47:52,143 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:53,092 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 descomprimido exitosamente.
2025-05-28 08:47:53,092 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 08:47:53,093 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 para clasificación BAML...
2025-05-28 08:47:54,330 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:54,331 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 ---
2025-05-28 08:47:54,331 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:54,331 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 08:47:54,342 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:54,957 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 descomprimido exitosamente.
2025-05-28 08:47:54,957 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 08:47:54,957 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 para clasificación BAML...
2025-05-28 08:47:57,560 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:47:57,562 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:47:58,093 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 ---
2025-05-28 08:47:58,093 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 08:47:58,093 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:58,093 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:58,206 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 08:47:58,521 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:47:58,521 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:47:59,082 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 descomprimido exitosamente.
2025-05-28 08:47:59,083 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 08:47:59,083 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 para clasificación BAML...
2025-05-28 08:48:01,336 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 08:48:01,343 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1: 'FDT'
2025-05-28 08:48:01,343 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 08:48:01,344 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 (desactivada o datos insuficientes).
2025-05-28 08:48:01,349 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1...
2025-05-28 08:48:01,351 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 08:48:01,351 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:01,354 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:01,354 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:01,354 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:01,355 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 08:48:01,361 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:01,361 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] LUT Kerma aplicada.
2025-05-28 08:48:01,361 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:01,361 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:01,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:02,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 08:48:02,011 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 procesado y guardado como: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 08:48:02,013 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1: 'FDT'
2025-05-28 08:48:02,013 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 (desactivada o datos insuficientes).
2025-05-28 08:48:02,014 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1...
2025-05-28 08:48:02,014 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 08:48:02,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:02,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:02,015 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:02,015 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:02,015 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 08:48:02,016 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:02,016 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] LUT Kerma aplicada.
2025-05-28 08:48:02,016 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:02,017 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:02,017 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:02,137 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 08:48:02,137 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 procesado y guardado como: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 08:48:02,137 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1: 'FDT'
2025-05-28 08:48:02,138 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 (desactivada o datos insuficientes).
2025-05-28 08:48:02,138 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1...
2025-05-28 08:48:02,138 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 08:48:02,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:02,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:02,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:02,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:02,139 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 08:48:02,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:02,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] LUT Kerma aplicada.
2025-05-28 08:48:02,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:02,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:02,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:02,226 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:02,226 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 procesado y guardado como: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:02,227 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1: 'FDT'
2025-05-28 08:48:02,227 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 (desactivada o datos insuficientes).
2025-05-28 08:48:02,227 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1...
2025-05-28 08:48:02,227 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 08:48:02,227 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:02,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:02,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:02,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:02,228 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 08:48:02,229 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:02,230 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] LUT Kerma aplicada.
2025-05-28 08:48:02,230 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:02,230 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:02,230 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:02,923 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:48:02,924 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:48:03,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 08:48:03,010 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 procesado y guardado como: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 08:48:03,010 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1: 'FDT'
2025-05-28 08:48:03,010 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 (desactivada o datos insuficientes).
2025-05-28 08:48:03,011 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1...
2025-05-28 08:48:03,011 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 08:48:03,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:03,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:03,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:03,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:03,011 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 08:48:03,013 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:03,013 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] LUT Kerma aplicada.
2025-05-28 08:48:03,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:03,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:03,014 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:03,109 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 08:48:03,109 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 procesado y guardado como: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 08:48:03,109 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 08:48:03,114 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 08:48:03,114 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 08:48:03,114 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 (desactivada o datos insuficientes).
2025-05-28 08:48:03,114 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1...
2025-05-28 08:48:03,114 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 08:48:03,114 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:03,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:03,115 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 08:48:03,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 08:48:03,115 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 08:48:03,116 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:03,123 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] LUT Kerma aplicada.
2025-05-28 08:48:03,123 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:03,123 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:03,123 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:03,350 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 08:48:03,351 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 procesado y guardado como: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 08:48:03,351 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 08:48:03,352 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 08:48:03,352 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 08:48:03,352 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 (desactivada o datos insuficientes).
2025-05-28 08:48:03,352 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1...
2025-05-28 08:48:03,352 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 08:48:03,353 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:03,353 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:03,353 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 08:48:03,353 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 08:48:03,353 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 08:48:03,354 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:03,355 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] LUT Kerma aplicada.
2025-05-28 08:48:03,355 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:03,355 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:03,356 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:03,433 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 08:48:03,434 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 procesado y guardado como: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 08:48:03,434 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1: 'FDT'
2025-05-28 08:48:03,434 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 (desactivada o datos insuficientes).
2025-05-28 08:48:03,434 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1...
2025-05-28 08:48:03,434 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 08:48:03,435 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:03,435 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:03,435 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:03,435 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:03,436 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 08:48:03,437 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:03,437 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] LUT Kerma aplicada.
2025-05-28 08:48:03,437 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:03,437 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:03,437 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:04,169 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 08:48:04,169 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 procesado y guardado como: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 08:48:04,169 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1: 'FDT'
2025-05-28 08:48:04,169 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 (desactivada o datos insuficientes).
2025-05-28 08:48:04,170 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1...
2025-05-28 08:48:04,170 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 08:48:04,170 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:04,171 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:04,171 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:04,171 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:04,171 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 08:48:04,172 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:04,172 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] LUT Kerma aplicada.
2025-05-28 08:48:04,173 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:04,173 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:04,173 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:04,951 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 08:48:04,952 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 procesado y guardado como: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 08:48:04,952 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1: 'FDT'
2025-05-28 08:48:04,952 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 (desactivada o datos insuficientes).
2025-05-28 08:48:04,952 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1...
2025-05-28 08:48:04,952 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 08:48:04,953 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:04,953 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:04,953 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:04,953 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:04,953 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 08:48:04,954 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:04,955 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] LUT Kerma aplicada.
2025-05-28 08:48:04,955 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:04,955 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:04,955 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:05,669 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:05,670 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 procesado y guardado como: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:05,670 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1: 'FDT'
2025-05-28 08:48:05,671 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 (desactivada o datos insuficientes).
2025-05-28 08:48:05,671 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1...
2025-05-28 08:48:05,671 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 08:48:05,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:05,672 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:05,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:05,673 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:05,673 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 08:48:05,674 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:05,674 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] LUT Kerma aplicada.
2025-05-28 08:48:05,674 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:05,674 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:05,674 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:05,843 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 08:48:05,843 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 08:48:05,935 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 08:48:05,935 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 procesado y guardado como: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 08:48:05,938 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1: 'FDT'
2025-05-28 08:48:05,938 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 (desactivada o datos insuficientes).
2025-05-28 08:48:05,938 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1...
2025-05-28 08:48:05,938 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 08:48:05,938 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 08:48:05,939 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 08:48:05,939 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 08:48:05,939 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 08:48:05,939 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 08:48:05,940 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 08:48:05,940 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] LUT Kerma aplicada.
2025-05-28 08:48:05,941 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 08:48:05,941 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 08:48:05,941 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 08:48:06,119 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:06,119 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 procesado y guardado como: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:06,119 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 -> Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 08:48:06,119 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 -> Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 -> Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 -> Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 -> Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 -> Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 -> Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 -> Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 -> Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:06,120 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 -> Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 08:48:06,121 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 -> Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 08:48:06,121 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 -> Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:06,121 - __main__ - INFO - Se procesaron 12 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 08:48:06,121 - pacs_operations - INFO - Iniciando envío de 12 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 08:48:06,125 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 08:48:06,129 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:06,134 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 08:48:06,149 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 08:48:06,152 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:06,152 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:06,159 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:06,160 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:06,165 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:06,179 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:06,183 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:06,191 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:06,191 - pacs_operations - INFO - Asociación establecida con PACS para Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:06,194 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:06,199 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:06,212 - pacs_operations - INFO - Asociación establecida con PACS para Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:06,240 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 08:48:06,279 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:06,359 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:06,360 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:06,409 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:06,425 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:06,459 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 08:48:06,950 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:06,968 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:06,994 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:06,996 - pacs_operations - INFO - Asociación establecida con PACS para Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:07,185 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:07,219 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:07,252 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:07,275 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 08:48:07,317 - pacs_operations - INFO - Asociación establecida con PACS para Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:07,332 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:07,398 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:07,430 - pacs_operations - INFO - Asociación establecida con PACS para Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:12,069 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:12,200 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:14,880 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:14,896 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:14,907 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:17,257 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:17,258 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:17,266 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:17,279 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 08:48:17,287 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:17,300 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:17,302 - pacs_operations - INFO - Asociación establecida con PACS para Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:17,352 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:17,353 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:17,366 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:17,376 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:17,397 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 08:48:17,404 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:17,417 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:17,420 - pacs_operations - INFO - Asociación establecida con PACS para Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:17,543 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:17,926 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:17,929 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:17,944 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:17,962 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 08:48:17,966 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:17,973 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:17,977 - pacs_operations - INFO - Asociación establecida con PACS para Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:18,027 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:18,040 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:18,060 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:18,071 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:18,089 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 08:48:18,100 - pynetdicom.association - INFO - Requesting Association
2025-05-28 08:48:18,130 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 08:48:18,138 - pacs_operations - INFO - Asociación establecida con PACS para Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm. Contextos de presentación aceptados: 7
2025-05-28 08:48:18,198 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 08:48:18,355 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:18,357 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:18,364 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:18,443 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:18,447 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:18,458 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:18,467 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:18,478 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:18,495 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:18,664 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:18,665 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:18,671 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:19,805 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:19,806 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:19,809 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:20,025 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:20,026 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:20,030 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:20,948 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:20,948 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:20,952 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:21,397 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0110 - Unknown)
2025-05-28 08:48:21,398 - pacs_operations - ERROR - Excepción no esperada durante la operación PACS para Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
Traceback (most recent call last):
  File "/home/aotal/github/pacs/pacs_operations.py", line 118, in _perform_pacs_send_sync
    status_description = evt.STATUS_KEYWORDS.get(status_value, f'Estado desconocido (0x{status_value:04X})' if status_value is not None else 'Estado no recibido')
                         ^^^^^^^^^^^^^^^^^^^
AttributeError: module 'pynetdicom.events' has no attribute 'STATUS_KEYWORDS'
2025-05-28 08:48:21,404 - pynetdicom.association - INFO - Releasing Association
2025-05-28 08:48:21,406 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 0 de 12 exitosos, 12 de 12 fallidos.
2025-05-28 08:48:21,406 - __main__ - WARNING - Algunos ficheros procesados pudieron no haberse enviado a PACS.
2025-05-28 08:48:21,406 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 08:48:21,420 - __main__ - INFO - Aplicación finalizada.
2025-05-28 10:21:19,826 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 10:21:23,126 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 10:21:23,497 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 10:21:23,632 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 10:21:23,633 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 10:21:23,633 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 10:21:23,633 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 10:21:23,663 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 10:21:23,663 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 10:21:23,664 - __main__ - INFO - Se encontraron 12 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 10:21:23,665 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 ---
2025-05-28 10:21:23,665 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 10:21:23,694 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:24,363 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 descomprimido exitosamente.
2025-05-28 10:21:24,364 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 10:21:24,364 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 para clasificación BAML...
2025-05-28 10:21:25,424 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:25,426 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:25,426 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 ---
2025-05-28 10:21:25,449 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 10:21:25,483 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:26,016 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 descomprimido exitosamente.
2025-05-28 10:21:26,016 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 10:21:26,016 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 para clasificación BAML...
2025-05-28 10:21:27,533 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:27,533 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:27,534 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 ---
2025-05-28 10:21:27,602 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 10:21:27,688 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:28,502 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 descomprimido exitosamente.
2025-05-28 10:21:28,502 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 10:21:28,503 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 para clasificación BAML...
2025-05-28 10:21:29,470 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:29,470 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:21:30,584 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:30,584 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 ---
2025-05-28 10:21:30,584 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 10:21:30,585 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:30,637 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:31,259 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 descomprimido exitosamente.
2025-05-28 10:21:31,260 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 10:21:31,260 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 para clasificación BAML...
2025-05-28 10:21:32,067 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:32,068 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:21:33,638 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:33,638 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:21:34,097 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:34,098 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 ---
2025-05-28 10:21:34,098 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:34,098 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 10:21:34,197 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:35,311 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 descomprimido exitosamente.
2025-05-28 10:21:35,312 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 10:21:35,312 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 para clasificación BAML...
2025-05-28 10:21:37,821 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:37,821 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 ---
2025-05-28 10:21:37,821 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:37,822 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 10:21:37,855 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:38,429 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:38,429 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:21:38,433 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 descomprimido exitosamente.
2025-05-28 10:21:38,433 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 10:21:38,433 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 para clasificación BAML...
2025-05-28 10:21:41,378 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:41,379 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 ---
2025-05-28 10:21:41,379 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:41,379 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 10:21:41,452 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:42,321 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 descomprimido exitosamente.
2025-05-28 10:21:42,321 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 10:21:42,322 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 para clasificación BAML...
2025-05-28 10:21:43,572 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:43,572 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 ---
2025-05-28 10:21:43,572 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 10:21:43,572 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:43,621 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:44,214 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 descomprimido exitosamente.
2025-05-28 10:21:44,214 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 10:21:44,214 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 para clasificación BAML...
2025-05-28 10:21:45,113 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:45,120 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:45,121 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 ---
2025-05-28 10:21:45,159 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 10:21:45,174 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:45,707 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 descomprimido exitosamente.
2025-05-28 10:21:45,707 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 10:21:45,708 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 para clasificación BAML...
2025-05-28 10:21:47,498 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:47,508 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:21:47,591 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:47,592 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 ---
2025-05-28 10:21:47,593 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 10:21:47,593 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:47,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:48,452 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 descomprimido exitosamente.
2025-05-28 10:21:48,452 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 10:21:48,453 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 para clasificación BAML...
2025-05-28 10:21:49,475 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:49,475 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 ---
2025-05-28 10:21:49,475 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:49,476 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 10:21:49,507 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:50,030 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 descomprimido exitosamente.
2025-05-28 10:21:50,030 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 10:21:50,031 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 para clasificación BAML...
2025-05-28 10:21:51,135 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:51,135 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 ---
2025-05-28 10:21:51,136 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 10:21:51,136 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:51,185 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 10:21:51,770 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 descomprimido exitosamente.
2025-05-28 10:21:51,770 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 10:21:51,771 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 para clasificación BAML...
2025-05-28 10:21:53,871 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:53,872 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:21:54,553 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 10:21:54,554 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 10:21:54,555 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1: 'FDT'
2025-05-28 10:21:54,560 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 (desactivada o datos insuficientes).
2025-05-28 10:21:54,560 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1...
2025-05-28 10:21:54,560 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 10:21:54,560 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:54,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:54,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:21:54,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:21:54,561 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 10:21:54,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:54,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] LUT Kerma aplicada.
2025-05-28 10:21:54,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:54,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:54,629 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:54,902 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 10:21:54,902 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 procesado y guardado como: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 10:21:54,902 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1: 'FDT'
2025-05-28 10:21:54,902 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 (desactivada o datos insuficientes).
2025-05-28 10:21:54,902 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1...
2025-05-28 10:21:54,902 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 10:21:54,903 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:54,903 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:54,903 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:21:54,903 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:21:54,903 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 10:21:54,904 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:54,904 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] LUT Kerma aplicada.
2025-05-28 10:21:54,904 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:54,905 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:54,905 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:55,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 10:21:55,240 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 procesado y guardado como: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 10:21:55,240 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1: 'FDT'
2025-05-28 10:21:55,240 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 (desactivada o datos insuficientes).
2025-05-28 10:21:55,240 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1...
2025-05-28 10:21:55,240 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 10:21:55,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:55,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:55,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:21:55,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:21:55,241 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 10:21:55,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:55,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] LUT Kerma aplicada.
2025-05-28 10:21:55,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:55,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:55,243 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:55,682 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:21:55,683 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 procesado y guardado como: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:21:55,684 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1: 'FDT'
2025-05-28 10:21:55,685 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 (desactivada o datos insuficientes).
2025-05-28 10:21:55,685 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1...
2025-05-28 10:21:55,687 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 10:21:55,687 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:55,689 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:55,690 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:21:55,691 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:21:55,691 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 10:21:55,694 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:55,694 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] LUT Kerma aplicada.
2025-05-28 10:21:55,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:55,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:55,698 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:56,027 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 10:21:56,028 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 procesado y guardado como: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 10:21:56,028 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 10:21:56,063 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 10:21:56,063 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 10:21:56,064 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 (desactivada o datos insuficientes).
2025-05-28 10:21:56,064 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1...
2025-05-28 10:21:56,064 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 10:21:56,064 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:56,064 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:56,064 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 10:21:56,065 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 10:21:56,065 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 10:21:56,066 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:56,066 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] LUT Kerma aplicada.
2025-05-28 10:21:56,066 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:56,066 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:56,066 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:56,153 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 10:21:56,153 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 procesado y guardado como: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 10:21:56,153 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 10:21:56,154 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 10:21:56,154 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 10:21:56,154 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 (desactivada o datos insuficientes).
2025-05-28 10:21:56,154 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1...
2025-05-28 10:21:56,155 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 10:21:56,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:56,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:56,156 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 10:21:56,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 10:21:56,156 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 10:21:56,157 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:56,158 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] LUT Kerma aplicada.
2025-05-28 10:21:56,158 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:56,158 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:56,158 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:56,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 10:21:56,296 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 procesado y guardado como: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 10:21:56,296 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1: 'FDT'
2025-05-28 10:21:56,296 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 (desactivada o datos insuficientes).
2025-05-28 10:21:56,296 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1...
2025-05-28 10:21:56,297 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 10:21:56,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:56,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:56,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:21:56,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:21:56,298 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 10:21:56,299 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:56,299 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] LUT Kerma aplicada.
2025-05-28 10:21:56,299 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:56,300 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:56,300 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:56,614 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 10:21:56,615 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 procesado y guardado como: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 10:21:56,615 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 10:21:56,616 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 10:21:56,616 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 10:21:56,616 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 (desactivada o datos insuficientes).
2025-05-28 10:21:56,616 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1...
2025-05-28 10:21:56,616 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 10:21:56,616 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:56,616 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:56,616 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 10:21:56,616 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 10:21:56,617 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 10:21:56,617 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:56,617 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] LUT Kerma aplicada.
2025-05-28 10:21:56,618 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:56,618 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:56,618 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:57,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 10:21:57,372 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 procesado y guardado como: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 10:21:57,372 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1.  The image is a monochromatic texture with subtle variations in gray tones.  It has a soft, almost gradient-like quality, and lacks any distinct shapes or geometric elements.\n", Incomplete)., raw_output=Type 1.  The image is a monochromatic texture with subtle variations in gray tones.  It has a soft, almost gradient-like quality, and lacks any distinct shapes or geometric elements.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 10:21:57,375 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 10:21:57,375 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 10:21:57,376 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 (desactivada o datos insuficientes).
2025-05-28 10:21:57,376 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1...
2025-05-28 10:21:57,376 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 10:21:57,377 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:57,378 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:57,378 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 10:21:57,378 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 10:21:57,379 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 10:21:57,382 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:57,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] LUT Kerma aplicada.
2025-05-28 10:21:57,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:57,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:57,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:59,755 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:21:59,755 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 procesado y guardado como: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:21:59,755 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1: 'FDT'
2025-05-28 10:21:59,755 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 (desactivada o datos insuficientes).
2025-05-28 10:21:59,755 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1...
2025-05-28 10:21:59,755 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 10:21:59,756 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:21:59,756 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:21:59,756 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:21:59,756 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:21:59,756 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 10:21:59,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:21:59,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] LUT Kerma aplicada.
2025-05-28 10:21:59,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:21:59,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:21:59,758 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:21:59,822 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 10:21:59,822 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 10:22:00,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 10:22:00,008 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 procesado y guardado como: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 10:22:00,008 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 10:22:00,009 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 10:22:00,009 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 10:22:00,009 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 (desactivada o datos insuficientes).
2025-05-28 10:22:00,010 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1...
2025-05-28 10:22:00,010 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 10:22:00,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:22:00,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:22:00,010 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 10:22:00,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 10:22:00,011 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 10:22:00,012 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:22:00,012 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] LUT Kerma aplicada.
2025-05-28 10:22:00,012 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:22:00,012 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:22:00,012 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:22:00,186 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 10:22:00,186 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 procesado y guardado como: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 10:22:00,187 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1: 'FDT'
2025-05-28 10:22:00,187 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 (desactivada o datos insuficientes).
2025-05-28 10:22:00,187 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1...
2025-05-28 10:22:00,187 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 10:22:00,187 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 10:22:00,188 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 10:22:00,188 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 10:22:00,188 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 10:22:00,188 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 10:22:00,189 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 10:22:00,189 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] LUT Kerma aplicada.
2025-05-28 10:22:00,189 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 10:22:00,189 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 10:22:00,189 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 10:22:00,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,386 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 procesado y guardado como: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,386 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 -> Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 10:22:00,386 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 -> Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 10:22:00,386 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 -> Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 -> Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 -> Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 -> Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 -> Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 -> Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 -> Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,387 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 -> Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 10:22:00,388 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 -> Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 10:22:00,388 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 -> Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,388 - __main__ - INFO - Se procesaron 12 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 10:22:00,388 - pacs_operations - INFO - Iniciando envío de 12 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 10:22:00,421 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 10:22:00,425 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 10:22:00,430 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 10:22:00,448 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,451 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 10:22:00,454 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 10:22:00,455 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,458 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,458 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,466 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,479 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,493 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,584 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 10:22:00,585 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,636 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,640 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,650 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,641 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,644 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:00,651 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,660 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,666 - pacs_operations - INFO - Asociación establecida con PACS para Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,667 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,670 - pacs_operations - INFO - Asociación establecida con PACS para Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,688 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,713 - pacs_operations - INFO - Asociación establecida con PACS para Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,756 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,770 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:00,782 - pacs_operations - INFO - Asociación establecida con PACS para Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,958 - pacs_operations - INFO - Asociación establecida con PACS para Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:00,962 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:01,041 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:01,042 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:01,288 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:01,429 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:01,445 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:01,603 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:01,691 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:01,959 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:02,995 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:05,331 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:05,333 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:05,334 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:05,349 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 10:22:05,353 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:05,380 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:05,381 - pacs_operations - INFO - Asociación establecida con PACS para Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:05,450 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:05,864 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:05,866 - pacs_operations - INFO - ÉXITO: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:05,868 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:05,883 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 10:22:05,887 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:05,899 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:05,900 - pacs_operations - INFO - Asociación establecida con PACS para Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:05,972 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:06,028 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,035 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,058 - pacs_operations - INFO - ÉXITO: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,059 - pacs_operations - INFO - ÉXITO: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,061 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,062 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,072 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 10:22:06,080 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 10:22:06,085 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:06,087 - pynetdicom.association - INFO - Requesting Association
2025-05-28 10:22:06,108 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:06,110 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 10:22:06,112 - pacs_operations - INFO - Asociación establecida con PACS para Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:06,116 - pacs_operations - INFO - Asociación establecida con PACS para Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm. Contextos de presentación aceptados: 7
2025-05-28 10:22:06,259 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,272 - pacs_operations - INFO - ÉXITO: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,275 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,325 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:06,333 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,362 - pacs_operations - INFO - ÉXITO: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,385 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,388 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 10:22:06,408 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,413 - pacs_operations - INFO - ÉXITO: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,416 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,493 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,494 - pacs_operations - INFO - ÉXITO: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,496 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,540 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,543 - pacs_operations - INFO - ÉXITO: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,546 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,680 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,695 - pacs_operations - INFO - ÉXITO: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,719 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,941 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,942 - pacs_operations - INFO - ÉXITO: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,943 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,962 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 10:22:06,963 - pacs_operations - INFO - ÉXITO: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 10:22:06,964 - pynetdicom.association - INFO - Releasing Association
2025-05-28 10:22:06,967 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 12 de 12 exitosos, 0 de 12 fallidos.
2025-05-28 10:22:06,968 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-28 10:22:06,968 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 10:22:06,973 - __main__ - INFO - Aplicación finalizada.
2025-05-28 11:44:54,513 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 11:44:57,405 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 11:44:57,771 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 11:44:57,869 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 11:44:57,870 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 11:44:57,870 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 11:44:57,870 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 11:44:57,906 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 11:44:57,906 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 11:44:57,908 - __main__ - INFO - Se encontraron 12 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 11:44:57,908 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 ---
2025-05-28 11:44:57,909 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 11:44:57,924 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:44:58,617 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 descomprimido exitosamente.
2025-05-28 11:44:58,618 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 11:44:58,618 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 para clasificación BAML...
2025-05-28 11:44:59,722 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:44:59,729 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:44:59,729 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 ---
2025-05-28 11:44:59,752 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 11:44:59,790 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:00,385 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 descomprimido exitosamente.
2025-05-28 11:45:00,386 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 11:45:00,386 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 para clasificación BAML...
2025-05-28 11:45:02,301 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:02,302 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:02,302 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 ---
2025-05-28 11:45:02,354 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 11:45:02,486 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:03,151 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 descomprimido exitosamente.
2025-05-28 11:45:03,151 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 11:45:03,151 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 para clasificación BAML...
2025-05-28 11:45:03,813 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:03,813 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:04,916 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:04,916 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 ---
2025-05-28 11:45:04,916 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:04,917 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 11:45:04,964 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:05,568 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 descomprimido exitosamente.
2025-05-28 11:45:05,569 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 11:45:05,569 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 para clasificación BAML...
2025-05-28 11:45:07,892 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:07,892 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:07,930 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:07,931 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 ---
2025-05-28 11:45:07,931 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:07,931 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 11:45:08,023 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:09,504 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 descomprimido exitosamente.
2025-05-28 11:45:09,504 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 11:45:09,505 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 para clasificación BAML...
2025-05-28 11:45:12,109 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:12,109 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 ---
2025-05-28 11:45:12,109 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:12,110 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 11:45:12,152 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:12,811 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 descomprimido exitosamente.
2025-05-28 11:45:12,811 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 11:45:12,811 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 para clasificación BAML...
2025-05-28 11:45:13,846 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:13,847 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:15,548 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:15,548 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 ---
2025-05-28 11:45:15,548 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:15,549 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 11:45:15,607 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:16,675 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 descomprimido exitosamente.
2025-05-28 11:45:16,676 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 11:45:16,676 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 para clasificación BAML...
2025-05-28 11:45:17,694 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:17,694 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 ---
2025-05-28 11:45:17,694 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 11:45:17,694 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:17,741 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:18,341 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 descomprimido exitosamente.
2025-05-28 11:45:18,341 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 11:45:18,341 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 para clasificación BAML...
2025-05-28 11:45:19,237 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:19,238 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 ---
2025-05-28 11:45:19,238 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:19,238 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 11:45:19,268 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:19,891 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 descomprimido exitosamente.
2025-05-28 11:45:19,893 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 11:45:19,896 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 para clasificación BAML...
2025-05-28 11:45:21,671 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:21,672 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:21,672 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 ---
2025-05-28 11:45:21,723 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 11:45:21,850 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:22,560 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:22,565 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:23,565 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 descomprimido exitosamente.
2025-05-28 11:45:23,586 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 11:45:23,590 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 para clasificación BAML...
2025-05-28 11:45:24,545 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:24,547 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 ---
2025-05-28 11:45:24,548 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:24,548 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 11:45:24,991 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:25,519 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 descomprimido exitosamente.
2025-05-28 11:45:25,519 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 11:45:25,519 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 para clasificación BAML...
2025-05-28 11:45:26,490 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:26,490 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 ---
2025-05-28 11:45:26,491 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:26,491 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 11:45:26,546 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:45:27,140 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 descomprimido exitosamente.
2025-05-28 11:45:27,140 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 11:45:27,140 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 para clasificación BAML...
2025-05-28 11:45:27,965 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:27,965 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:29,390 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:29,390 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:30,279 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:45:30,314 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:45:30,446 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1: 'FDT'
2025-05-28 11:45:30,452 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 (desactivada o datos insuficientes).
2025-05-28 11:45:30,453 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1...
2025-05-28 11:45:30,464 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 11:45:30,485 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:30,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:30,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:30,520 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:30,534 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1
2025-05-28 11:45:30,568 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:30,569 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] LUT Kerma aplicada.
2025-05-28 11:45:30,569 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:30,569 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:30,569 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:30,907 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 11:45:30,907 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 procesado y guardado como: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 11:45:30,918 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:45:31,025 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:45:31,025 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:45:31,025 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 (desactivada o datos insuficientes).
2025-05-28 11:45:31,026 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1...
2025-05-28 11:45:31,026 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 11:45:31,026 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:31,026 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:31,026 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:45:31,027 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:45:31,027 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1
2025-05-28 11:45:31,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:31,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] LUT Kerma aplicada.
2025-05-28 11:45:31,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:31,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:31,029 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:31,245 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 11:45:31,246 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 procesado y guardado como: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 11:45:31,246 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1: 'FDT'
2025-05-28 11:45:31,246 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 (desactivada o datos insuficientes).
2025-05-28 11:45:31,246 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1...
2025-05-28 11:45:31,247 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 11:45:31,247 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:31,247 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:31,248 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:31,248 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:31,248 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1
2025-05-28 11:45:31,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:31,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] LUT Kerma aplicada.
2025-05-28 11:45:31,250 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:31,250 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:31,250 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:31,527 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:31,527 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 procesado y guardado como: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:31,527 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1: 'FDT'
2025-05-28 11:45:31,527 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 (desactivada o datos insuficientes).
2025-05-28 11:45:31,528 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1...
2025-05-28 11:45:31,528 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 11:45:31,528 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:31,528 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:31,528 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:31,528 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:31,529 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1
2025-05-28 11:45:31,530 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:31,530 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] LUT Kerma aplicada.
2025-05-28 11:45:31,530 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:31,530 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:31,530 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 11:45:32,104 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 procesado y guardado como: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 11:45:32,104 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:45:32,105 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:45:32,105 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:45:32,105 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,105 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1...
2025-05-28 11:45:32,106 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 11:45:32,106 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,106 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,106 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:45:32,106 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:45:32,106 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1
2025-05-28 11:45:32,107 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,107 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] LUT Kerma aplicada.
2025-05-28 11:45:32,108 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,108 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,108 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,190 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 11:45:32,191 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 procesado y guardado como: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 11:45:32,191 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:45:32,192 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:45:32,192 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:45:32,192 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,192 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1...
2025-05-28 11:45:32,193 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 11:45:32,193 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,193 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,193 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:45:32,194 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:45:32,194 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1
2025-05-28 11:45:32,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] LUT Kerma aplicada.
2025-05-28 11:45:32,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,293 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 11:45:32,293 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 procesado y guardado como: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 11:45:32,293 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1: 'FDT'
2025-05-28 11:45:32,294 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,294 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1...
2025-05-28 11:45:32,294 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 11:45:32,294 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:32,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:32,295 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1
2025-05-28 11:45:32,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] LUT Kerma aplicada.
2025-05-28 11:45:32,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,297 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,503 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 11:45:32,503 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 procesado y guardado como: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 11:45:32,504 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:45:32,505 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:45:32,505 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:45:32,505 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,505 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1...
2025-05-28 11:45:32,505 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 11:45:32,505 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,506 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:45:32,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:45:32,506 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1
2025-05-28 11:45:32,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] LUT Kerma aplicada.
2025-05-28 11:45:32,508 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,508 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,508 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,641 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:45:32,641 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 procesado y guardado como: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:45:32,641 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1: 'FDT'
2025-05-28 11:45:32,642 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,642 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1...
2025-05-28 11:45:32,642 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 11:45:32,642 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,642 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,643 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:32,643 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:32,643 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1
2025-05-28 11:45:32,644 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,644 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] LUT Kerma aplicada.
2025-05-28 11:45:32,644 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,645 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,645 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,757 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 11:45:32,758 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 procesado y guardado como: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 11:45:32,758 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1: 'FDT'
2025-05-28 11:45:32,758 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,758 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1...
2025-05-28 11:45:32,758 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 11:45:32,759 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,759 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,759 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:32,759 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:32,759 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1
2025-05-28 11:45:32,760 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,761 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] LUT Kerma aplicada.
2025-05-28 11:45:32,761 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,761 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,761 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,866 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:32,866 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 procesado y guardado como: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:32,866 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:45:32,867 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:45:32,868 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:45:32,868 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 (desactivada o datos insuficientes).
2025-05-28 11:45:32,868 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1...
2025-05-28 11:45:32,868 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 11:45:32,868 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:32,869 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:32,869 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:45:32,869 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:45:32,869 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1
2025-05-28 11:45:32,870 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:32,870 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] LUT Kerma aplicada.
2025-05-28 11:45:32,870 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:32,870 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:32,871 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:32,993 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 11:45:32,993 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 procesado y guardado como: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 11:45:35,066 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:45:35,066 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:45:35,066 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1: 'FDT'
2025-05-28 11:45:35,067 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 (desactivada o datos insuficientes).
2025-05-28 11:45:35,067 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1...
2025-05-28 11:45:35,067 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 11:45:35,067 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:45:35,067 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:45:35,067 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:45:35,067 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:45:35,068 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1
2025-05-28 11:45:35,068 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:45:35,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] LUT Kerma aplicada.
2025-05-28 11:45:35,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:45:35,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:45:35,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:45:35,150 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,151 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 procesado y guardado como: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,151 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238699.1 -> Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 11:45:35,151 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239054.1 -> Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 11:45:35,151 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239529.1 -> Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239343.1 -> Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239161.1 -> Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239247.1 -> Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238593.1 -> Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238878.1 -> Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239642.1 -> Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238792.1 -> Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414238968.1 -> Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414239432.1 -> Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,152 - __main__ - INFO - Se procesaron 12 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 11:45:35,154 - pacs_operations - INFO - Iniciando envío de 12 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 11:45:35,176 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm
2025-05-28 11:45:35,184 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:45:35,187 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:35,191 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:35,193 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm
2025-05-28 11:45:35,197 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:35,207 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,219 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:35,221 - pacs_operations - INFO - Asociación establecida con PACS para Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:35,225 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:35,227 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:35,233 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:35,234 - pacs_operations - INFO - Asociación establecida con PACS para Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:35,236 - pacs_operations - INFO - Asociación establecida con PACS para Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:35,253 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:35,254 - pacs_operations - INFO - Asociación establecida con PACS para Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:35,334 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm
2025-05-28 11:45:35,359 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:35,371 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:35,391 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:35,393 - pacs_operations - INFO - Asociación establecida con PACS para Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:35,475 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:35,612 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:35,621 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:35,708 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm
2025-05-28 11:45:35,721 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:35,739 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:35,748 - pacs_operations - INFO - Asociación establecida con PACS para Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:35,920 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:35,947 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:35,959 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:36,114 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm
2025-05-28 11:45:36,382 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:36,407 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:37,019 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:37,022 - pacs_operations - INFO - ÉXITO: Img4_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:37,025 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:37,054 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm
2025-05-28 11:45:37,229 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:37,230 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:37,231 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:37,232 - pacs_operations - INFO - ÉXITO: Img11_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:37,235 - pacs_operations - INFO - ÉXITO: Img2_SN1938BX_KVP70_mAs1.99_IE93.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:37,236 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:37,237 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:37,256 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm
2025-05-28 11:45:37,260 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:37,270 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm
2025-05-28 11:45:37,292 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:37,611 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:37,612 - pacs_operations - INFO - ÉXITO: Img8_SN1938BX_KVP70_mAs63.02_IE2904.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:37,614 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:37,629 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm
2025-05-28 11:45:37,632 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:45:37,676 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:37,679 - pacs_operations - INFO - ÉXITO: Img5_SN1938BX_KVP70_mAs10.02_IE468.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:37,679 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:37,869 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:37,870 - pacs_operations - INFO - ÉXITO: Img1_SN1938BX_KVP70_mAs0.99_IE46.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:37,871 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:37,966 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:37,968 - pacs_operations - INFO - Asociación establecida con PACS para Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:37,976 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:37,987 - pacs_operations - INFO - Asociación establecida con PACS para Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:37,989 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:37,989 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:37,991 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:37,997 - pacs_operations - INFO - Asociación establecida con PACS para Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:38,010 - pacs_operations - INFO - Asociación establecida con PACS para Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:38,031 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:45:38,158 - pacs_operations - INFO - Asociación establecida con PACS para Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:38,161 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:38,181 - pacs_operations - INFO - Asociación establecida con PACS para Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:45:38,272 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:38,342 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:38,344 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:38,528 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:38,792 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:45:39,924 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:39,927 - pacs_operations - INFO - ÉXITO: Img10_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:39,933 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:40,246 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:40,248 - pacs_operations - INFO - ÉXITO: Img3_SN1938BX_KVP70_mAs3.19_IE149.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:40,252 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:40,284 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:40,301 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:40,302 - pacs_operations - INFO - ÉXITO: Img6_SN1938BX_KVP70_mAs20.02_IE928.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:40,303 - pacs_operations - INFO - ÉXITO: Img7_SN1938BX_KVP70_mAs40.02_IE1849.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:40,305 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:40,305 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:40,339 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:40,340 - pacs_operations - INFO - ÉXITO: Img12_SN1938BX_KVP70_mAs0.58_IE27.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:40,342 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:40,468 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:45:40,468 - pacs_operations - INFO - ÉXITO: Img9_SN1938BX_KVP70_mAs80.02_IE3681.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:45:40,470 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:45:40,486 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 12 de 12 exitosos, 0 de 12 fallidos.
2025-05-28 11:45:40,487 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-28 11:45:40,487 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 11:45:40,506 - __main__ - INFO - Aplicación finalizada.
2025-05-28 11:55:59,304 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 11:56:06,889 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 11:56:07,688 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 11:56:07,870 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 11:56:07,870 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 11:56:07,874 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 11:56:07,874 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 11:56:07,948 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 11:56:07,948 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 11:56:07,948 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 11:56:07,949 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-05-28 11:56:07,949 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 11:56:07,959 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:09,298 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-05-28 11:56:09,298 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 11:56:09,298 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-05-28 11:56:12,633 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:12,642 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:12,645 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-05-28 11:56:14,091 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 11:56:14,316 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:15,780 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-05-28 11:56:15,781 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 11:56:15,781 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-05-28 11:56:17,602 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:17,603 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:17,603 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-05-28 11:56:17,640 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 11:56:17,778 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:18,932 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-05-28 11:56:18,933 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 11:56:18,933 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-05-28 11:56:19,620 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:56:19,620 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:56:20,926 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:20,927 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-05-28 11:56:20,927 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 11:56:20,964 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:21,409 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:22,176 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-05-28 11:56:22,176 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 11:56:22,176 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-05-28 11:56:24,019 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 11:56:24,020 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 11:56:24,470 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:56:24,470 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:56:26,823 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:26,824 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-05-28 11:56:26,825 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:26,825 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 11:56:27,695 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:28,619 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-05-28 11:56:28,623 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 11:56:28,623 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-05-28 11:56:31,476 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 11:56:31,485 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 11:56:34,255 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:34,258 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-05-28 11:56:34,259 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:34,260 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 11:56:34,358 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:35,037 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-05-28 11:56:35,037 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 11:56:35,037 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-05-28 11:56:36,564 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:36,565 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-05-28 11:56:36,565 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:36,565 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 11:56:37,029 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:37,254 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-28 11:56:37,255 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-28 11:56:37,546 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-05-28 11:56:37,547 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 11:56:37,547 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-05-28 11:56:39,648 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:39,648 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-05-28 11:56:39,649 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:39,649 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 11:56:40,068 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:40,685 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-05-28 11:56:40,685 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 11:56:40,685 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-05-28 11:56:41,446 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 11:56:41,447 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 11:56:42,461 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 11:56:42,462 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 11:56:43,739 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:43,740 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-05-28 11:56:43,740 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 11:56:43,740 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:43,940 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:44,490 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-05-28 11:56:44,491 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 11:56:44,491 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-05-28 11:56:45,555 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:45,556 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-05-28 11:56:45,556 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:45,556 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 11:56:45,714 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:46,486 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-05-28 11:56:46,491 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 11:56:46,491 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-05-28 11:56:47,233 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-28 11:56:48,560 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-28 11:56:50,095 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:50,101 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-05-28 11:56:50,103 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 11:56:50,101 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:50,516 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:51,072 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-05-28 11:56:51,073 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 11:56:51,073 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-05-28 11:56:52,810 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-28 11:56:52,810 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-28 11:56:54,951 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:54,952 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-05-28 11:56:54,952 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:54,952 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 11:56:55,036 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:56,324 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-05-28 11:56:56,324 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 11:56:56,324 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-05-28 11:56:57,538 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:57,539 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-05-28 11:56:57,539 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 11:56:57,539 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:57,677 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:56:58,232 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-05-28 11:56:58,232 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 11:56:58,233 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-05-28 11:56:59,946 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:56:59,947 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-05-28 11:56:59,947 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:56:59,947 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 11:57:00,089 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 11:57:00,590 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-05-28 11:57:00,591 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 11:57:00,591 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-05-28 11:57:01,550 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 11:57:01,550 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 11:57:02,507 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 11:57:02,515 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 11:57:02,541 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-05-28 11:57:02,543 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-05-28 11:57:02,544 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-05-28 11:57:02,549 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 11:57:02,554 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:02,571 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:02,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:57:02,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:57:02,577 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 11:57:02,620 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:02,620 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-05-28 11:57:02,620 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:02,624 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:02,624 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:02,822 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:02,822 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:02,822 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-05-28 11:57:02,822 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-05-28 11:57:02,822 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-05-28 11:57:02,823 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 11:57:02,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:02,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:02,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 11:57:02,824 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 11:57:02,824 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 11:57:02,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:02,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-05-28 11:57:02,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:02,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:02,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:02,940 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:02,940 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:02,940 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-05-28 11:57:02,940 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-05-28 11:57:02,941 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-05-28 11:57:02,941 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 11:57:02,942 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:02,942 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:02,943 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:57:02,943 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:57:02,943 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 11:57:02,944 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:02,944 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-05-28 11:57:02,944 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:02,944 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:02,945 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:03,889 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:03,890 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:03,890 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-05-28 11:57:03,890 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-05-28 11:57:03,890 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-05-28 11:57:03,890 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 11:57:03,891 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:03,891 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:03,891 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 11:57:03,891 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 11:57:03,892 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 11:57:03,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:03,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-05-28 11:57:03,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:03,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:03,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:04,456 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 11:57:04,456 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 11:57:05,955 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:05,956 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:05,956 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-05-28 11:57:05,956 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-05-28 11:57:05,956 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-05-28 11:57:05,956 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 11:57:05,956 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:05,957 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:05,957 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-28 11:57:05,957 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-28 11:57:05,957 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 11:57:05,958 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:05,958 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-05-28 11:57:05,959 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:05,959 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:05,959 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:06,093 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 11:57:06,094 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 11:57:06,094 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-05-28 11:57:06,094 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-05-28 11:57:06,094 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-05-28 11:57:06,094 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 11:57:06,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:06,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:06,095 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 11:57:06,095 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 11:57:06,095 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 11:57:06,096 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:06,096 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-05-28 11:57:06,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:06,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:06,098 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:07,101 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:07,101 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:07,101 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-05-28 11:57:07,101 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-05-28 11:57:07,101 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-05-28 11:57:07,102 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 11:57:07,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:07,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:07,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 11:57:07,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 11:57:07,103 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 11:57:07,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:07,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-05-28 11:57:07,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:07,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:07,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:07,658 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:07,658 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:07,658 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-05-28 11:57:07,658 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-05-28 11:57:07,658 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-05-28 11:57:07,658 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 11:57:07,659 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:07,659 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:07,659 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-28 11:57:07,659 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-28 11:57:07,659 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 11:57:07,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:07,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-05-28 11:57:07,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:07,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:07,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:08,218 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:08,218 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:08,218 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:57:08,235 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:57:08,236 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:57:08,236 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-05-28 11:57:08,236 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-05-28 11:57:08,236 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 11:57:08,236 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:08,237 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:08,237 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:57:08,237 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:57:08,237 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 11:57:08,238 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:08,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-05-28 11:57:08,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:08,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:08,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:08,743 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:08,744 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:08,744 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-05-28 11:57:08,744 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-05-28 11:57:08,744 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-05-28 11:57:08,744 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 11:57:08,744 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:08,745 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:08,745 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-28 11:57:08,745 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-28 11:57:08,745 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 11:57:08,746 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:08,747 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-05-28 11:57:08,747 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:08,747 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:08,747 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:09,159 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:09,159 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:09,159 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2", Incomplete)., raw_output=Type 2, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:57:09,161 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:57:09,161 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:57:09,161 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-05-28 11:57:09,161 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-05-28 11:57:09,161 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 11:57:09,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:09,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:09,161 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:57:09,162 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:57:09,162 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 11:57:09,163 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:09,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-05-28 11:57:09,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:09,172 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:09,173 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:11,224 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:11,225 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:11,225 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-05-28 11:57:11,225 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-05-28 11:57:11,225 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-05-28 11:57:11,225 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 11:57:11,226 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:11,226 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:11,226 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 11:57:11,226 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 11:57:11,226 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 11:57:11,227 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:11,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-05-28 11:57:11,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:11,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:11,228 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:11,843 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:11,844 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:11,844 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-05-28 11:57:11,844 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-05-28 11:57:11,844 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-05-28 11:57:11,844 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 11:57:11,845 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:11,845 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:11,845 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 11:57:11,845 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 11:57:11,846 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 11:57:11,847 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:11,847 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-05-28 11:57:11,847 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:11,847 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:11,848 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:12,259 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,259 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,259 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 11:57:12,260 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 11:57:12,260 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 11:57:12,261 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-05-28 11:57:12,261 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-05-28 11:57:12,261 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 11:57:12,262 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 11:57:12,262 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 11:57:12,262 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 11:57:12,262 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 11:57:12,262 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 11:57:12,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 11:57:12,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-05-28 11:57:12,264 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 11:57:12,264 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 11:57:12,264 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 11:57:12,789 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,789 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,789 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:12,790 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:12,791 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,791 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,791 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 11:57:12,792 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 11:57:12,809 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,822 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:12,825 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:12,830 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:12,838 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,860 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:12,860 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:12,861 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:12,862 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:12,863 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:12,868 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,881 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:12,889 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:12,901 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:12,907 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:12,908 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:12,915 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:12,921 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:12,931 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:12,940 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:12,959 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:12,961 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:12,964 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:12,968 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:12,994 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:12,994 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:13,002 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:13,032 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:13,069 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:13,085 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:13,096 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:13,110 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:13,300 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:14,813 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:15,554 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:15,657 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:17,703 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:17,758 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:18,719 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:19,242 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:19,976 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:19,978 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:19,982 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,022 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 11:57:20,034 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:20,100 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:20,104 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:20,240 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:20,327 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,330 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,334 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,358 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 11:57:20,388 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:20,429 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,430 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,434 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,443 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:20,447 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:20,453 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 11:57:20,469 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:20,475 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,476 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,481 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,498 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:20,500 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:20,515 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:20,528 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:20,550 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,557 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,562 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:20,563 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,576 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:20,598 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 11:57:20,610 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:20,611 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,615 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,625 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:20,625 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,629 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,640 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,643 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:20,660 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,678 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:20,678 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:20,689 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:20,697 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 11:57:20,757 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:20,787 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:20,798 - pynetdicom.association - INFO - Requesting Association
2025-05-28 11:57:20,821 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 11:57:20,824 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-28 11:57:21,178 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:21,324 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:21,359 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 11:57:21,718 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:21,722 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:21,724 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:21,817 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:21,818 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:21,819 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:21,950 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:21,961 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:21,962 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:21,981 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:21,982 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:21,984 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:22,012 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:22,016 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:22,017 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:22,060 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 11:57:22,063 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 11:57:22,066 - pynetdicom.association - INFO - Releasing Association
2025-05-28 11:57:22,084 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-05-28 11:57:22,084 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-28 11:57:22,085 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 11:57:22,110 - __main__ - INFO - Aplicación finalizada.
2025-05-28 12:36:07,404 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-05-28 12:36:12,680 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-05-28 12:36:13,385 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-05-28 12:36:13,594 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-05-28 12:36:13,594 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-05-28 12:36:13,596 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 12:36:13,596 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-05-28 12:36:13,641 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-05-28 12:36:13,641 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-05-28 12:36:13,644 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-05-28 12:36:13,644 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-05-28 12:36:13,645 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 12:36:13,715 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:14,373 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-05-28 12:36:14,373 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 12:36:14,374 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-05-28 12:36:15,385 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:15,388 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:15,406 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-05-28 12:36:15,406 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 12:36:15,496 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:16,056 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-05-28 12:36:16,056 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 12:36:16,056 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-05-28 12:36:17,337 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:17,338 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:17,338 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-05-28 12:36:17,379 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 12:36:17,416 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:17,942 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-05-28 12:36:17,942 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 12:36:17,942 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-05-28 12:36:18,927 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:18,928 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:18,928 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-05-28 12:36:18,989 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 12:36:19,136 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 12:36:19,137 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 12:36:19,143 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:19,740 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-05-28 12:36:19,740 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 12:36:19,740 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-05-28 12:36:21,399 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:21,399 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-05-28 12:36:21,400 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:21,400 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 12:36:21,666 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:22,355 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-05-28 12:36:22,355 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 12:36:22,355 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-05-28 12:36:24,625 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:24,625 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-05-28 12:36:24,626 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:24,626 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 12:36:24,712 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:25,293 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-05-28 12:36:25,293 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 12:36:25,294 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-05-28 12:36:25,463 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 12:36:25,463 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 12:36:26,405 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:26,405 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-05-28 12:36:26,405 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:26,406 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 12:36:26,439 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:26,940 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-05-28 12:36:26,940 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 12:36:26,941 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-05-28 12:36:27,755 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-28 12:36:27,755 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-28 12:36:28,014 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:28,015 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-05-28 12:36:28,015 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:28,016 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 12:36:28,056 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:28,643 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-05-28 12:36:28,643 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 12:36:28,644 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-05-28 12:36:30,857 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:30,858 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-05-28 12:36:30,858 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:30,858 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 12:36:30,893 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:31,487 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 12:36:31,488 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 12:36:31,496 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-05-28 12:36:31,497 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 12:36:31,497 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-05-28 12:36:32,495 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:32,496 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-05-28 12:36:32,496 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:32,496 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 12:36:32,551 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:33,078 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-05-28 12:36:33,078 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 12:36:33,078 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-05-28 12:36:35,947 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-28 12:36:35,947 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-28 12:36:36,797 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:36,797 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-05-28 12:36:36,798 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:36,798 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 12:36:36,858 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:37,498 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 12:36:37,499 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 12:36:37,501 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-05-28 12:36:37,502 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 12:36:37,502 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-05-28 12:36:39,734 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:39,734 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-05-28 12:36:39,735 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:39,735 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 12:36:39,852 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:40,507 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-05-28 12:36:40,507 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 12:36:40,507 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-05-28 12:36:41,735 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:41,735 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-05-28 12:36:41,735 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 12:36:41,735 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:41,809 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:42,337 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-05-28 12:36:42,338 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 12:36:42,338 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-05-28 12:36:44,000 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:44,000 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-05-28 12:36:44,000 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 12:36:44,000 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:44,238 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-05-28 12:36:44,849 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-05-28 12:36:44,849 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-05-28 12:36:44,883 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-05-28 12:36:44,884 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 12:36:44,884 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-05-28 12:36:45,907 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-05-28 12:36:45,907 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-05-28 12:36:46,728 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-05-28 12:36:46,729 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-05-28 12:36:46,729 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-05-28 12:36:46,729 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-05-28 12:36:46,765 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-05-28 12:36:46,774 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 12:36:46,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:46,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:46,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 12:36:46,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 12:36:46,785 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-05-28 12:36:46,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:46,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-05-28 12:36:46,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:46,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:46,805 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:47,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:47,386 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:47,386 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 is the best fit.  The image is circular, has a grid-like shape in the center, surrounding dots, and a blurred background.  While elements of Type 2 are present (simple graphic design, circular border), Type 3 is more comprehensive. Type 1 doesn't adequately describe the presence of the distinct geometric shapes.\n", Incomplete)., raw_output=Type 3 is the best fit.  The image is circular, has a grid-like shape in the center, surrounding dots, and a blurred background.  While elements of Type 2 are present (simple graphic design, circular border), Type 3 is more comprehensive. Type 1 doesn't adequately describe the presence of the distinct geometric shapes.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 12:36:47,402 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 12:36:47,402 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 12:36:47,402 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-05-28 12:36:47,402 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-05-28 12:36:47,403 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 12:36:47,403 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:47,403 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:47,403 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 12:36:47,403 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 12:36:47,404 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-05-28 12:36:47,405 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:47,405 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-05-28 12:36:47,405 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:47,405 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:47,405 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:47,701 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:47,701 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:47,701 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 12:36:47,702 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 12:36:47,702 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 12:36:47,702 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-05-28 12:36:47,702 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-05-28 12:36:47,703 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 12:36:47,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:47,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:47,703 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 12:36:47,704 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 12:36:47,704 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-05-28 12:36:47,705 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:47,705 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-05-28 12:36:47,705 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:47,705 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:47,706 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:47,895 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:47,896 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:47,896 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-05-28 12:36:47,896 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-05-28 12:36:47,896 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-05-28 12:36:47,897 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 12:36:47,897 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:47,897 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:47,897 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 12:36:47,898 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 12:36:47,898 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-05-28 12:36:47,899 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:47,899 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-05-28 12:36:47,900 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:47,900 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:47,900 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:48,662 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:48,662 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:48,662 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-05-28 12:36:48,662 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-05-28 12:36:48,663 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-05-28 12:36:48,663 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 12:36:48,663 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:48,664 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:48,664 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-28 12:36:48,664 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-28 12:36:48,664 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-05-28 12:36:48,665 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:48,665 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-05-28 12:36:48,665 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:48,665 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:48,666 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:48,993 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 12:36:48,993 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 12:36:48,994 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 is the best fit.  The image is circular, has a grid-like shape in the center, surrounding dots, and a blurred (or out-of-focus) background. While elements of Type 2 are present (simple graphic design, circular border), the grid and dots make Type 3 a more accurate description. Type 1 doesn't accurately capture the distinct elements within the circular design.\n", Incomplete)., raw_output=Type 3 is the best fit.  The image is circular, has a grid-like shape in the center, surrounding dots, and a blurred (or out-of-focus) background. While elements of Type 2 are present (simple graphic design, circular border), the grid and dots make Type 3 a more accurate description. Type 1 doesn't accurately capture the distinct elements within the circular design.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 12:36:48,995 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 12:36:48,995 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 12:36:48,995 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-05-28 12:36:48,995 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-05-28 12:36:48,996 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 12:36:48,996 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:48,996 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:48,996 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 12:36:48,997 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 12:36:48,997 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-05-28 12:36:48,998 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:48,998 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-05-28 12:36:48,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:48,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:48,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:49,368 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:49,369 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:49,369 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-05-28 12:36:49,369 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-05-28 12:36:49,370 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-05-28 12:36:49,370 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 12:36:49,370 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:49,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:49,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 12:36:49,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 12:36:49,372 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-05-28 12:36:49,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:49,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-05-28 12:36:49,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:49,374 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:49,374 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:49,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:49,826 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:49,826 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-05-28 12:36:49,826 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-05-28 12:36:49,827 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-05-28 12:36:49,827 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 12:36:49,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:49,827 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:49,828 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-28 12:36:49,828 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-28 12:36:49,828 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-05-28 12:36:49,829 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:49,829 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-05-28 12:36:49,829 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:49,829 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:49,829 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:50,285 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-05-28 12:36:50,285 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-05-28 12:36:50,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:50,325 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:50,325 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-05-28 12:36:50,326 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-05-28 12:36:50,326 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-05-28 12:36:50,326 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 12:36:50,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:50,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:50,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 12:36:50,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 12:36:50,326 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-05-28 12:36:50,327 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:50,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-05-28 12:36:50,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:50,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:50,330 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:50,599 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:50,600 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:50,600 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2 is the best fit.  The image is a simple graphic design with a small black geometric shape (a triangle) within a circular border on a square background.  It clearly exhibits a minimalist aesthetic.  The other types don't accurately describe the image.\n", Incomplete)., raw_output=Type 2 is the best fit.  The image is a simple graphic design with a small black geometric shape (a triangle) within a circular border on a square background.  It clearly exhibits a minimalist aesthetic.  The other types don't accurately describe the image.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 12:36:50,601 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 12:36:50,601 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 12:36:50,601 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-05-28 12:36:50,601 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-05-28 12:36:50,601 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 12:36:50,601 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:50,602 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:50,602 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 12:36:50,602 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 12:36:50,602 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-05-28 12:36:50,603 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:50,603 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-05-28 12:36:50,604 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:50,604 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:50,604 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:50,985 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:50,985 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:50,985 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-05-28 12:36:50,985 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-05-28 12:36:50,985 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-05-28 12:36:50,985 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 12:36:50,986 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:50,986 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:50,986 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-05-28 12:36:50,986 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-05-28 12:36:50,986 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-05-28 12:36:50,988 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:50,988 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-05-28 12:36:50,988 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:50,988 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:50,988 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:51,077 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:51,078 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:51,078 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-05-28 12:36:51,078 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-05-28 12:36:51,078 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-05-28 12:36:51,078 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 12:36:51,079 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:51,079 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:51,080 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-05-28 12:36:51,080 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-05-28 12:36:51,080 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-05-28 12:36:51,081 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:51,081 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-05-28 12:36:51,081 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:51,082 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:51,082 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:52,550 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:52,550 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:52,550 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-05-28 12:36:52,550 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-05-28 12:36:52,550 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-05-28 12:36:52,551 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 12:36:52,551 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:52,551 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:52,551 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-05-28 12:36:52,551 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-05-28 12:36:52,552 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-05-28 12:36:52,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:52,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-05-28 12:36:52,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:52,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:52,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:53,211 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,211 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,211 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-05-28 12:36:53,212 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-05-28 12:36:53,212 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-05-28 12:36:53,213 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-05-28 12:36:53,213 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-05-28 12:36:53,213 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 12:36:53,213 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-05-28 12:36:53,213 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-05-28 12:36:53,213 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-05-28 12:36:53,214 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-05-28 12:36:53,214 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-05-28 12:36:53,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-05-28 12:36:53,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-05-28 12:36:53,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-05-28 12:36:53,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-05-28 12:36:53,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-05-28 12:36:53,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,823 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,824 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,824 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:53,824 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,824 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:53,824 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 12:36:53,824 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:53,825 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,826 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,826 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-05-28 12:36:53,826 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-05-28 12:36:53,831 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,843 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:53,846 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:53,855 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:53,864 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:53,871 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:53,878 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:53,879 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:53,881 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:53,883 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:53,895 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:53,896 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:53,918 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:53,920 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:53,924 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:53,932 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:53,945 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:53,945 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:53,978 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:53,984 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:54,022 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:54,146 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:54,204 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:54,220 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:54,244 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:54,278 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:54,284 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:54,496 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:54,530 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:54,584 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:54,594 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:54,656 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:54,661 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:54,722 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:54,748 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:55,354 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:55,786 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:55,787 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:56,660 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:56,662 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:56,858 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:57,022 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:57,124 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:57,183 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:57,191 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:57,250 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:57,658 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:57,659 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:57,659 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:57,662 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:57,665 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:57,667 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:57,669 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:57,692 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:57,720 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:57,770 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:57,740 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:57,733 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:57,800 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-05-28 12:36:57,807 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-05-28 12:36:57,856 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-05-28 12:36:57,881 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:57,884 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:57,888 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:57,903 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:57,903 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:57,910 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:57,910 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:57,913 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:57,918 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:57,981 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:57,996 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:58,014 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:58,018 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:58,208 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-05-28 12:36:58,225 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:58,264 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:58,271 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:58,330 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-05-28 12:36:58,359 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:58,416 - pynetdicom.association - INFO - Requesting Association
2025-05-28 12:36:58,418 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:58,452 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:58,480 - pynetdicom.acse - INFO - Association Accepted
2025-05-28 12:36:58,485 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-05-28 12:36:58,559 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:58,647 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:58,773 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-05-28 12:36:59,296 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,297 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,302 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,319 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,336 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,342 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,415 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,458 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,468 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,564 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,565 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,567 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,607 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,608 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,610 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,674 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,676 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,677 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,705 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,713 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-05-28 12:36:59,714 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,715 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-05-28 12:36:59,716 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,717 - pynetdicom.association - INFO - Releasing Association
2025-05-28 12:36:59,736 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-05-28 12:36:59,736 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-05-28 12:36:59,736 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-05-28 12:36:59,742 - __main__ - INFO - Aplicación finalizada.
2025-06-04 11:03:06,883 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-04 11:03:10,972 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-04 11:03:11,363 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-04 11:03:11,473 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-04 11:03:11,474 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-04 11:03:11,476 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-04 11:03:11,476 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-04 11:03:11,511 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-04 11:03:11,511 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-04 11:03:11,512 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-04 11:03:11,512 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-04 11:03:11,512 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:03:11,542 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:18,318 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-04 11:03:18,318 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:03:18,318 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-04 11:03:23,949 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:23,952 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:23,952 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-04 11:03:23,992 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:03:24,066 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:27,453 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-04 11:03:27,458 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:03:27,458 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-04 11:03:27,755 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:29,760 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:32,338 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:33,577 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:33,582 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:33,585 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-04 11:03:33,607 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:03:33,654 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:34,467 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-04 11:03:34,467 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:03:34,467 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-04 11:03:35,209 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:36,339 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:37,216 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:37,683 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:38,373 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:38,374 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:38,374 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-04 11:03:38,487 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:03:38,634 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:39,069 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:39,587 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-04 11:03:39,587 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:03:39,587 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-04 11:03:40,076 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:41,725 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:41,726 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:41,740 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-04 11:03:41,748 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:03:41,838 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:42,129 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:42,524 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-04 11:03:42,525 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:03:42,525 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-04 11:03:42,728 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:43,040 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:43,079 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:44,374 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:44,729 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:45,561 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:46,262 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:46,307 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-04 11:03:46,307 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:03:46,307 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:46,356 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:46,381 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:47,254 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:47,839 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:47,869 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-04 11:03:47,869 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:03:47,869 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-04 11:03:49,567 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:49,846 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:50,394 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:50,512 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:51,197 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:51,648 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:51,648 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-04 11:03:51,649 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:03:51,649 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:51,687 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:52,242 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-04 11:03:52,243 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:03:52,243 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-04 11:03:52,375 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:52,624 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:54,512 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:54,575 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:54,576 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-04 11:03:54,576 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:54,577 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:03:54,624 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:54,642 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:03:55,551 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:55,558 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-04 11:03:55,558 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:03:55,558 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-04 11:03:56,356 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:56,475 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:58,364 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:58,411 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:59,198 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:03:59,630 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:03:59,955 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:03:59,955 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-04 11:03:59,955 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:03:59,955 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:00,004 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:04:00,739 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:00,739 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:00,747 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-04 11:04:00,748 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:04:00,748 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-04 11:04:02,219 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:02,741 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:02,955 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:04:02,956 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-04 11:04:02,956 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:04:02,956 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:03,121 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:04:03,390 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:03,691 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:03,691 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:03,707 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-04 11:04:03,712 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:04:03,713 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-04 11:04:04,054 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:06,055 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:06,694 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:07,691 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:08,652 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:08,813 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:09,084 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:04:09,084 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-04 11:04:09,084 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:09,085 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:04:09,188 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:04:09,882 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-04 11:04:09,882 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:04:09,883 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-04 11:04:10,225 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:11,248 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:12,854 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:13,461 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:14,708 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:16,998 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:19,065 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:19,316 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:19,839 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:04:19,840 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-04 11:04:19,840 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:04:19,842 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:19,923 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:04:21,324 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-04 11:04:21,324 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:04:21,324 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-04 11:04:21,654 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:23,074 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:23,654 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:26,619 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:27,317 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:29,428 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:29,771 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:04:29,772 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-04 11:04:29,773 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:29,773 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:04:29,857 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:04:31,409 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-04 11:04:31,410 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:04:31,410 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-04 11:04:31,479 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:32,997 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:04:32,998 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-04 11:04:32,999 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:32,999 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:04:33,431 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:04:34,021 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:34,715 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:34,716 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:34,769 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-04 11:04:34,770 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:04:34,770 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-04 11:04:34,947 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:35,417 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:35,983 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:36,129 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:04:36,140 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:36,150 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b702d2e70 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:36,226 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:36,226 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:36,227 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-04 11:04:36,227 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-04 11:04:36,235 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:04:36,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:36,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:36,269 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:36,269 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:36,270 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:04:36,392 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:36,393 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-04 11:04:36,394 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:36,395 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:36,397 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:36,874 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:36,875 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:36,875 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b702dec90 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:36,879 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:36,879 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:36,879 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-04 11:04:36,879 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-04 11:04:36,879 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:04:36,881 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:36,882 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:36,882 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:36,882 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:36,882 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:04:36,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:36,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-04 11:04:36,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:36,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:36,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:37,694 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:37,747 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:37,960 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:04:37,961 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:04:37,961 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b702ef320 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:37,962 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:37,962 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:37,962 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-04 11:04:37,962 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-04 11:04:37,963 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:04:37,963 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:37,964 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:37,964 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:37,964 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:37,965 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:04:37,966 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:37,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-04 11:04:37,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:37,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:37,967 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:38,110 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:38,111 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:38,111 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b702ff5f0 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:38,112 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:38,112 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:38,112 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-04 11:04:38,113 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-04 11:04:38,113 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:04:38,113 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:38,114 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:38,114 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:38,114 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:38,114 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:04:38,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:38,116 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-04 11:04:38,116 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:38,116 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:38,116 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:38,877 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:39,138 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:04:39,139 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:04:39,139 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70313740 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:39,140 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:39,140 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:39,140 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-06-04 11:04:39,140 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-06-04 11:04:39,140 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:04:39,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:39,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:39,141 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:39,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:39,141 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:04:39,142 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:39,142 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-06-04 11:04:39,142 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:39,143 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:39,143 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:39,342 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:04:39,342 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:04:39,343 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70323890 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:39,343 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:39,344 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:39,344 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-06-04 11:04:39,344 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-06-04 11:04:39,344 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:04:39,344 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:39,345 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:39,345 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:39,345 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:39,345 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:04:39,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:39,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-06-04 11:04:39,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:39,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:39,347 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:39,842 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:39,984 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:40,404 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:04:40,405 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:04:40,405 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70323bf0 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:40,409 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:40,409 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:40,409 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-06-04 11:04:40,411 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-06-04 11:04:40,411 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:04:40,411 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:40,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:40,412 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:40,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:40,413 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:04:40,416 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:40,416 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-06-04 11:04:40,417 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:40,425 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:40,425 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:42,878 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:43,418 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:44,011 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:44,066 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:44,263 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:45,280 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:04:45,280 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:04:45,280 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70333d10 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:45,282 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:45,282 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:45,282 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-06-04 11:04:45,282 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-06-04 11:04:45,282 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:04:45,283 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:45,283 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:45,283 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:45,283 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:45,283 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:04:45,285 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:45,285 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-06-04 11:04:45,286 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:45,286 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:45,286 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:45,718 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:04:45,718 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:04:45,718 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70348440 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:45,719 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:45,719 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:45,720 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-06-04 11:04:45,720 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-06-04 11:04:45,720 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:04:45,720 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:45,720 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:45,721 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:45,721 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:45,721 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:04:45,722 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:45,722 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-06-04 11:04:45,722 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:45,722 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:45,723 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:47,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:47,069 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:47,069 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b7036c2f0 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:47,070 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:47,070 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:47,070 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-06-04 11:04:47,070 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-06-04 11:04:47,070 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:04:47,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:47,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:47,071 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:47,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:47,071 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:04:47,072 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:47,073 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-06-04 11:04:47,073 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:47,073 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:47,073 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:47,705 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:04:47,705 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:04:47,706 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70299730 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:47,707 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:47,707 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:47,707 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-06-04 11:04:47,707 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-06-04 11:04:47,707 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:04:47,707 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:47,707 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:47,708 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:47,708 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:47,708 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:04:47,726 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:47,727 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-06-04 11:04:47,727 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:47,727 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:47,727 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:48,085 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:48,129 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:04:48,130 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:04:50,036 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400).
2025-06-04 11:04:52,012 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:52,263 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:52,735 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b702fd3a0 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:52,736 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:52,736 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:52,736 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-06-04 11:04:52,737 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-06-04 11:04:52,737 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:04:52,737 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:52,738 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:52,738 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:52,738 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:52,738 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:04:52,740 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:52,740 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-06-04 11:04:52,740 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:52,740 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:52,740 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:52,828 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:04:52,828 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:04:53,002 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b70333620 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:53,003 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:53,003 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:53,003 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-04 11:04:53,003 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-04 11:04:53,004 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:04:53,004 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:53,004 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:53,004 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:53,004 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:53,004 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:04:53,005 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:53,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-04 11:04:53,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:53,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:53,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:04:53,410 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:53,411 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:04:58,051 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:04:59,746 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 400 Bad Request. {"error":{"code":400,"message":"API key expired. Please renew the API key.","status":"INVALID_ARGUMENT","details":[{"@type":"type.googleapis.com/google.rpc.ErrorInfo","reason":"API_KEY_INVALID","domain":"googleapis.com","metadata":{"service":"generativelanguage.googleapis.com"}},{"@type":"type.googleapis.com/google.rpc.LocalizedMessage","locale":"en-US","message":"API key expired. Please renew the API key."}]}}, status_code=400)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x776b702883b0 state=finished raised BamlClientHttpError>]
2025-06-04 11:04:59,747 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:04:59,747 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:04:59,747 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-06-04 11:04:59,747 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-06-04 11:04:59,747 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:04:59,748 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:04:59,748 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:04:59,748 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:04:59,748 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:04:59,748 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:04:59,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:04:59,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-06-04 11:04:59,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:04:59,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:04:59,750 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:05:02,443 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,443 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,447 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:05:02,448 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:05:02,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:05:02,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:05:02,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:05:02,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,453 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-06-04 11:05:02,455 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-06-04 11:05:02,483 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:02,494 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:02,497 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:05:02,504 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:05:02,518 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:02,519 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:02,523 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:02,525 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:02,539 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:02,542 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:02,546 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:02,560 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:05:02,563 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:02,566 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:02,591 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:02,593 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:03,033 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:03,073 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:03,082 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:03,098 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:03,101 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:03,103 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:03,121 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:03,157 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:03,164 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:03,229 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:03,311 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:03,324 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:03,702 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:03,950 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:05:03,976 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:03,986 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:04,005 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:04,030 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:04,039 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:04,067 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:04,075 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:05,708 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:05,722 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:05,723 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:07,263 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:07,267 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:07,267 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:07,284 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:05:07,308 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:08,184 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:08,185 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:08,223 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:08,228 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:08,229 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:08,230 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:08,243 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:08,250 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:08,257 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:08,264 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:08,277 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:08,286 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:08,288 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:08,293 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:08,299 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:08,301 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:08,301 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:08,304 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:08,316 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:05:08,334 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:05:08,336 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:05:08,337 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:05:08,338 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:05:08,339 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:08,345 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:08,354 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:08,368 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:08,376 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:05:08,381 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:08,389 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:08,396 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:08,396 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:08,398 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:08,399 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:08,405 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:08,422 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:05:08,425 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:08,426 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:05:08,750 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:08,824 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:08,864 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:09,156 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:09,188 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:05:09,199 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:09,226 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:09,245 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:09,266 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:09,273 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:09,301 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:09,828 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:09,829 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:09,831 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:10,056 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:10,057 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:10,066 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:10,066 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:10,083 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:10,083 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:10,306 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:10,307 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:10,309 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:10,367 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:10,368 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:10,370 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:10,455 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:05:10,545 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:05:10,547 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:05:10,563 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-06-04 11:05:10,563 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-04 11:05:10,563 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-04 11:05:10,628 - __main__ - INFO - Aplicación finalizada.
2025-06-04 11:05:57,091 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-04 11:05:59,234 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-04 11:05:59,694 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-04 11:05:59,813 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-04 11:05:59,813 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-04 11:05:59,814 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-04 11:05:59,814 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-04 11:05:59,846 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-04 11:05:59,846 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-04 11:05:59,846 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-04 11:05:59,847 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-04 11:05:59,847 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:06:00,027 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:00,917 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-04 11:06:00,917 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:06:00,917 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-04 11:06:01,810 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:01,817 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:01,964 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-04 11:06:02,005 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:06:02,025 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:02,670 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-04 11:06:02,670 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:06:02,670 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-04 11:06:03,742 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:03,743 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:03,759 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-04 11:06:03,759 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:06:03,788 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:04,390 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-04 11:06:04,390 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:06:04,390 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-04 11:06:05,408 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:05,409 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:05,505 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-04 11:06:05,520 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:06:05,575 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:06,244 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-04 11:06:06,244 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:06:06,244 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-04 11:06:07,384 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:07,385 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:07,385 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-04 11:06:07,420 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:06:07,475 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:07,735 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 11:06:08,026 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 11:06:08,029 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-04 11:06:08,030 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:06:08,030 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-04 11:06:09,455 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 11:06:09,456 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 11:06:09,897 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 11:06:09,898 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 11:06:10,317 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:10,318 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-04 11:06:10,318 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:10,319 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:06:10,348 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:10,902 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-04 11:06:10,903 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:06:10,903 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-04 11:06:11,056 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 11:06:11,056 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 11:06:12,112 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:12,112 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-04 11:06:12,112 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:06:12,113 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:12,138 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:12,679 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-04 11:06:12,680 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:06:12,680 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-04 11:06:13,166 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-04 11:06:13,166 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-04 11:06:13,753 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:13,753 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-04 11:06:13,754 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:06:13,754 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:13,796 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:14,310 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-04 11:06:14,310 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:06:14,311 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-04 11:06:15,491 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 11:06:15,491 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 11:06:16,534 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:16,535 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-04 11:06:16,535 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:16,535 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:06:16,582 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:17,111 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-04 11:06:17,112 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:06:17,112 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-04 11:06:18,028 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:18,029 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-04 11:06:18,029 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:18,029 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:06:18,071 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:18,692 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-04 11:06:18,693 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:06:18,693 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-04 11:06:19,410 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 11:06:19,410 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 11:06:20,910 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-04 11:06:20,911 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-04 11:06:21,103 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:21,103 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-04 11:06:21,103 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:06:21,103 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:21,143 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:21,742 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-04 11:06:21,742 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:06:21,743 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-04 11:06:24,269 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:24,270 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-04 11:06:24,270 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:24,270 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:06:24,289 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:24,855 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-04 11:06:24,856 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:06:24,857 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-04 11:06:25,959 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:25,960 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-04 11:06:25,960 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:25,960 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:06:25,988 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:26,677 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-04 11:06:26,677 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:06:26,677 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-04 11:06:27,538 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:27,539 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-04 11:06:27,539 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:27,539 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:06:27,582 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 11:06:28,097 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-04 11:06:28,098 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:06:28,098 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-04 11:06:28,625 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-04 11:06:28,625 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-04 11:06:28,974 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 11:06:28,974 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 11:06:28,975 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-06-04 11:06:28,980 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-04 11:06:28,980 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-04 11:06:28,981 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:06:28,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:28,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:28,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 11:06:28,982 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 11:06:28,982 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 11:06:28,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:28,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-04 11:06:28,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:28,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:28,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,117 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:29,117 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:29,117 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-06-04 11:06:29,117 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,117 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-04 11:06:29,118 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:06:29,118 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,118 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,118 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 11:06:29,119 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 11:06:29,119 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 11:06:29,120 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,120 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-04 11:06:29,121 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,121 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,121 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,271 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:29,272 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:29,272 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-06-04 11:06:29,272 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,272 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-04 11:06:29,272 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:06:29,272 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,273 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,273 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 11:06:29,273 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 11:06:29,273 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 11:06:29,274 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,275 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-04 11:06:29,275 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,276 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,276 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,359 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:29,359 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:29,359 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-06-04 11:06:29,359 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,359 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-04 11:06:29,360 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:06:29,360 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,360 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,360 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 11:06:29,360 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 11:06:29,361 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 11:06:29,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-04 11:06:29,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,455 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:29,455 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:29,455 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-06-04 11:06:29,456 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,456 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-06-04 11:06:29,456 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:06:29,456 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,456 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,457 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-04 11:06:29,457 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-04 11:06:29,457 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 11:06:29,459 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,459 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-06-04 11:06:29,459 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,459 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,459 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,508 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:06:29,509 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:06:29,509 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-06-04 11:06:29,509 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,509 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-06-04 11:06:29,510 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:06:29,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,511 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,511 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 11:06:29,511 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 11:06:29,512 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 11:06:29,513 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,513 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-06-04 11:06:29,514 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,515 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,516 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:29,575 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:29,575 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-06-04 11:06:29,575 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,575 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-06-04 11:06:29,575 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:06:29,575 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 11:06:29,576 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 11:06:29,576 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 11:06:29,577 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,577 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-06-04 11:06:29,577 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,578 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,578 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,771 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:29,771 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:29,771 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-06-04 11:06:29,771 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,771 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-06-04 11:06:29,772 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:06:29,772 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,772 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,772 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-04 11:06:29,773 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-04 11:06:29,773 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 11:06:29,774 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,774 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-06-04 11:06:29,774 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,775 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,775 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:29,834 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 11:06:29,835 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 11:06:29,876 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:29,876 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:29,876 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-04 11:06:29,883 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:06:29,884 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:06:29,884 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-06-04 11:06:29,884 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-06-04 11:06:29,884 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:06:29,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:29,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:29,885 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:06:29,885 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:06:29,885 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 11:06:29,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:29,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-06-04 11:06:29,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:29,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:29,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:30,004 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:30,004 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:30,005 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2", Incomplete)., raw_output=Type 2, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-04 11:06:30,006 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 11:06:30,006 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 11:06:30,006 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-06-04 11:06:30,006 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-06-04 11:06:30,006 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:06:30,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:30,007 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:30,007 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 11:06:30,007 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 11:06:30,007 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 11:06:30,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:30,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-06-04 11:06:30,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:30,009 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:30,009 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:30,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:30,069 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:30,069 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-06-04 11:06:30,069 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-06-04 11:06:30,069 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-06-04 11:06:30,069 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:06:30,069 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:30,070 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:30,070 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-04 11:06:30,070 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-04 11:06:30,070 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 11:06:30,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:30,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-06-04 11:06:30,071 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:30,072 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:30,072 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:30,110 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:30,110 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:30,110 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-06-04 11:06:30,110 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-06-04 11:06:30,110 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-06-04 11:06:30,111 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:06:30,111 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:30,111 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:30,111 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 11:06:30,111 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 11:06:30,111 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 11:06:30,112 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:30,113 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-06-04 11:06:30,113 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:30,113 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:30,113 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:30,211 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:30,211 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:30,829 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 11:06:30,829 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 11:06:30,829 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-06-04 11:06:30,829 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-04 11:06:30,830 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-04 11:06:30,830 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:06:30,830 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:30,830 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:30,831 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 11:06:30,831 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 11:06:30,831 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 11:06:30,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:30,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-04 11:06:30,832 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:30,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:30,833 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:30,883 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:30,883 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,318 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 11:06:33,319 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 11:06:33,320 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'FDT'
2025-06-04 11:06:33,320 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-06-04 11:06:33,321 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-06-04 11:06:33,322 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:06:33,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 11:06:33,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 11:06:33,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 11:06:33,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 11:06:33,324 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 11:06:33,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 11:06:33,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-06-04 11:06:33,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 11:06:33,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 11:06:33,326 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 11:06:33,364 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,364 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,364 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,364 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:33,365 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,366 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:33,366 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:33,366 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:33,366 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,366 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,366 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-06-04 11:06:33,367 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-06-04 11:06:33,371 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,373 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:33,379 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:33,389 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:33,389 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:33,391 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:33,394 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:33,409 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:33,422 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:33,429 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:33,429 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:33,430 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:33,456 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:33,478 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:33,495 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:33,523 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:33,526 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:33,634 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,646 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:33,677 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:33,694 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:33,723 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:33,736 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:33,793 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:33,808 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:33,825 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:33,840 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:33,911 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:34,064 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:34,194 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:34,204 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:34,253 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:34,265 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:34,507 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:34,619 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:34,646 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:34,673 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:34,686 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:34,868 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:35,032 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:35,406 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:35,409 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:35,413 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:35,420 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 11:06:35,425 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:35,451 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:35,453 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:35,538 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:35,625 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:35,629 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:35,630 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:35,660 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 11:06:35,664 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:35,674 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:35,675 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:35,751 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:35,788 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:35,790 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:35,793 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:35,807 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 11:06:35,824 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:35,847 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:35,850 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:35,903 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:35,903 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:35,905 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:35,907 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:35,915 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:35,917 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:35,935 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:35,936 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 11:06:35,946 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:35,946 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:35,963 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:35,970 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:35,977 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:35,980 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:36,065 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:36,266 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:36,310 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:36,365 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:36,368 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:36,374 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:36,385 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:36,394 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 11:06:36,396 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:36,410 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:36,411 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:36,420 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:36,421 - pynetdicom.association - INFO - Requesting Association
2025-06-04 11:06:36,423 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:36,454 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 11:06:36,460 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:36,460 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 11:06:36,472 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:36,481 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:36,634 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 11:06:36,829 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:36,834 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:36,846 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:36,858 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:36,862 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:36,870 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:37,009 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:37,011 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:37,014 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:37,050 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:37,124 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 11:06:37,124 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:37,125 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 11:06:37,126 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:37,127 - pynetdicom.association - INFO - Releasing Association
2025-06-04 11:06:37,143 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-06-04 11:06:37,144 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-04 11:06:37,144 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-04 11:06:37,179 - __main__ - INFO - Aplicación finalizada.
2025-06-04 13:24:56,436 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-04 13:25:04,710 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-04 13:25:05,161 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-04 13:25:05,307 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-04 13:25:05,308 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-04 13:25:05,310 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-04 13:25:05,310 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-04 13:25:05,363 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-04 13:25:05,363 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-04 13:25:05,365 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-04 13:25:05,365 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-04 13:25:05,365 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 13:25:05,608 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:06,316 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-04 13:25:06,317 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 13:25:06,317 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-04 13:25:08,800 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:08,837 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:08,992 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-04 13:25:09,009 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 13:25:10,292 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:11,031 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-04 13:25:11,035 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 13:25:11,040 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-04 13:25:12,990 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:13,064 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:13,065 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-04 13:25:13,127 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 13:25:14,011 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:14,821 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-04 13:25:14,822 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 13:25:14,822 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-04 13:25:14,821 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 13:25:14,825 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 13:25:16,044 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:16,045 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-04 13:25:16,045 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:16,046 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 13:25:16,511 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 13:25:16,511 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 13:25:16,761 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:17,529 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-04 13:25:17,529 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 13:25:17,529 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-04 13:25:18,759 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:18,760 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-04 13:25:18,760 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:18,760 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 13:25:19,074 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:19,724 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-04 13:25:19,724 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 13:25:19,725 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-04 13:25:22,050 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:22,050 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-04 13:25:22,051 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:22,051 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 13:25:22,450 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:22,992 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 13:25:22,993 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 13:25:22,999 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-04 13:25:22,999 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 13:25:22,999 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-04 13:25:24,524 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:24,525 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-04 13:25:24,526 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:24,526 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 13:25:24,724 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-04 13:25:24,724 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-04 13:25:25,401 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:26,094 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-04 13:25:26,094 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 13:25:26,094 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-04 13:25:27,496 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:27,496 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-04 13:25:27,496 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 13:25:27,497 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:27,972 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:28,612 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-04 13:25:28,613 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 13:25:28,613 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-04 13:25:28,972 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 13:25:28,972 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 13:25:31,085 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:31,086 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-04 13:25:31,086 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 13:25:31,086 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:31,301 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 13:25:31,302 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 13:25:32,007 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:32,601 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-04 13:25:32,601 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 13:25:32,601 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-04 13:25:33,441 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:33,442 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-04 13:25:33,442 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:33,442 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 13:25:33,653 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:33,890 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-04 13:25:33,891 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-04 13:25:34,222 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-04 13:25:34,222 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 13:25:34,223 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-04 13:25:36,295 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:36,295 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-04 13:25:36,296 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:36,296 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 13:25:36,623 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:37,163 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 13:25:37,163 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 13:25:37,178 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-04 13:25:37,178 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 13:25:37,178 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-04 13:25:39,918 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:39,919 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-04 13:25:39,919 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:39,919 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 13:25:40,179 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:40,685 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-04 13:25:40,685 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 13:25:40,685 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-04 13:25:41,745 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:41,745 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-04 13:25:41,745 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 13:25:41,745 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:41,913 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:42,469 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-04 13:25:42,469 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-04 13:25:42,477 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-04 13:25:42,478 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 13:25:42,478 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-04 13:25:43,425 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:43,425 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-04 13:25:43,426 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 13:25:43,426 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:43,578 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-04 13:25:44,199 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-04 13:25:44,200 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 13:25:44,200 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-04 13:25:44,867 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-04 13:25:44,867 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-04 13:25:45,208 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-04 13:25:45,214 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-04 13:25:45,237 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-06-04 13:25:45,238 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-04 13:25:45,240 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-04 13:25:45,242 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 13:25:45,246 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:45,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:45,256 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 13:25:45,257 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 13:25:45,258 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-04 13:25:45,291 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:45,291 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-04 13:25:45,291 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:45,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:45,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:45,582 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:45,582 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:45,582 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-06-04 13:25:45,583 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-04 13:25:45,583 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-04 13:25:45,583 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 13:25:45,583 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:45,584 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:45,584 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 13:25:45,584 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 13:25:45,584 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-04 13:25:45,585 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:45,586 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-04 13:25:45,586 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:45,586 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:45,586 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:45,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:45,661 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:45,662 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-04 13:25:45,695 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 13:25:45,695 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 13:25:45,696 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-04 13:25:45,696 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-04 13:25:45,696 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 13:25:45,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:45,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:45,697 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 13:25:45,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 13:25:45,697 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-04 13:25:45,698 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:45,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-04 13:25:45,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:45,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:45,700 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:45,781 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:45,781 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:45,782 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-06-04 13:25:45,782 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-04 13:25:45,782 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-04 13:25:45,782 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 13:25:45,782 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:45,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:45,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 13:25:45,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 13:25:45,783 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-04 13:25:45,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:45,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-04 13:25:45,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:45,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:45,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:46,693 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:46,693 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:46,694 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-06-04 13:25:46,694 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-06-04 13:25:46,694 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-06-04 13:25:46,694 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 13:25:46,694 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:46,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:46,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-04 13:25:46,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-04 13:25:46,695 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-04 13:25:46,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:46,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-06-04 13:25:46,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:46,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:46,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:46,780 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 13:25:46,781 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 13:25:46,781 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-06-04 13:25:46,781 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-06-04 13:25:46,781 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-06-04 13:25:46,781 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 13:25:46,782 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:46,782 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:46,782 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 13:25:46,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 13:25:46,783 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-04 13:25:46,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:46,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-06-04 13:25:46,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:46,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:46,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:46,860 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:46,861 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:46,861 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-06-04 13:25:46,861 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-06-04 13:25:46,861 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-06-04 13:25:46,861 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 13:25:46,862 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:46,862 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:46,862 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 13:25:46,862 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 13:25:46,862 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-04 13:25:46,863 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:46,864 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-06-04 13:25:46,864 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:46,864 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:46,864 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:46,917 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:46,917 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:46,917 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-06-04 13:25:46,917 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-06-04 13:25:46,918 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-06-04 13:25:46,918 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 13:25:46,918 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:46,918 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:46,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-04 13:25:46,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-04 13:25:46,919 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-04 13:25:46,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:46,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-06-04 13:25:46,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:46,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:46,921 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:47,033 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:47,033 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:47,033 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-06-04 13:25:47,034 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-06-04 13:25:47,034 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-06-04 13:25:47,034 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 13:25:47,034 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:47,034 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:47,034 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 13:25:47,035 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 13:25:47,035 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-04 13:25:47,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:47,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-06-04 13:25:47,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:47,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:47,036 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:47,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:47,157 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:47,157 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2", Incomplete)., raw_output=Type 2, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-04 13:25:47,158 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 13:25:47,158 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 13:25:47,158 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-06-04 13:25:47,158 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-06-04 13:25:47,158 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 13:25:47,159 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:47,159 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:47,159 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 13:25:47,159 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 13:25:47,160 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-04 13:25:47,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:47,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-06-04 13:25:47,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:47,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:47,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:47,294 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:47,295 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:47,295 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-06-04 13:25:47,295 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-06-04 13:25:47,295 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-06-04 13:25:47,295 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 13:25:47,295 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:47,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:47,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-04 13:25:47,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-04 13:25:47,297 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-04 13:25:47,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:47,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-06-04 13:25:47,298 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:47,299 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:47,299 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:47,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:47,507 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:47,508 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-06-04 13:25:47,508 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-06-04 13:25:47,508 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-06-04 13:25:47,509 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 13:25:47,509 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:47,509 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:47,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-04 13:25:47,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-04 13:25:47,510 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-04 13:25:47,512 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:47,512 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-06-04 13:25:47,512 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:47,512 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:47,513 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:47,615 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:47,616 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:47,616 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-04 13:25:47,617 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-06-04 13:25:47,618 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-04 13:25:47,618 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-04 13:25:47,618 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-04 13:25:47,618 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 13:25:47,618 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:47,619 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:47,619 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-04 13:25:47,619 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-04 13:25:47,619 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-04 13:25:47,620 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:47,620 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-04 13:25:47,620 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:47,621 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:47,621 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:47,718 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:47,719 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,160 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-04 13:25:49,161 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-04 13:25:49,162 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'FDT'
2025-06-04 13:25:49,162 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-06-04 13:25:49,162 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-06-04 13:25:49,162 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 13:25:49,163 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-06-04 13:25:49,163 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-04 13:25:49,163 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-04 13:25:49,163 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-04 13:25:49,163 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-04 13:25:49,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-04 13:25:49,165 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-06-04 13:25:49,165 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-06-04 13:25:49,165 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-04 13:25:49,165 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-04 13:25:49,448 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,449 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,449 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,450 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:49,450 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,450 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:49,450 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 13:25:49,451 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:49,451 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:49,451 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:49,451 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,452 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:49,452 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:49,452 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:49,453 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,453 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,453 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-06-04 13:25:49,473 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-06-04 13:25:49,505 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,627 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:49,771 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:49,799 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,800 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,814 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:49,818 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,843 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,844 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,846 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,895 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,899 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,905 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:49,913 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,927 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:49,939 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:49,966 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,969 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,973 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,973 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:49,975 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,975 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,975 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:49,976 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,984 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:49,976 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:49,979 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,982 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:49,977 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:49,995 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:49,996 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:50,012 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:50,389 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:50,504 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:50,910 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:50,911 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:50,912 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:50,919 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:50,988 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:51,202 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:53,510 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:53,512 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:53,512 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:53,654 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-04 13:25:53,659 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:53,695 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:53,696 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:53,741 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:54,245 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,246 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,248 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,265 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-04 13:25:54,272 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:54,288 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:54,288 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:54,329 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:54,621 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,622 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,623 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,641 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-04 13:25:54,650 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:54,662 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:54,664 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:54,709 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:54,709 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,789 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,802 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,805 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,810 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,810 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,826 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:54,832 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-04 13:25:54,836 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:54,838 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:54,850 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:54,854 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:54,861 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:54,865 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:54,939 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,955 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,958 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,982 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,985 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:54,985 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,990 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:54,999 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,992 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-04 13:25:54,997 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:54,993 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:55,022 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:55,038 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:55,064 - pynetdicom.association - INFO - Requesting Association
2025-06-04 13:25:55,093 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:55,093 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:55,094 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:55,096 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:55,118 - pynetdicom.acse - INFO - Association Accepted
2025-06-04 13:25:55,122 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-04 13:25:55,183 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:55,388 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-04 13:25:55,814 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:55,815 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:55,815 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:55,864 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:55,865 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:55,866 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:55,869 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:55,870 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:55,871 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:55,988 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-04 13:25:55,989 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-04 13:25:55,989 - pynetdicom.association - INFO - Releasing Association
2025-06-04 13:25:56,006 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-06-04 13:25:56,007 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-04 13:25:56,007 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-04 13:25:56,022 - __main__ - INFO - Aplicación finalizada.
2025-06-06 14:01:49,943 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-06 14:01:52,967 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-06 14:01:53,351 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-06 14:01:53,531 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-06 14:01:53,531 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-06 14:01:53,532 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-06 14:01:53,532 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-06 14:01:53,563 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-06 14:01:53,563 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-06 14:01:53,566 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-06 14:01:53,567 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-06 14:01:53,567 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-06 14:01:53,598 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:01:54,188 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-06 14:01:54,188 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-06 14:01:54,188 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-06 14:01:55,105 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:01:55,108 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:01:55,108 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-06 14:01:55,153 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-06 14:01:55,197 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:01:55,820 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-06 14:01:55,821 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-06 14:01:55,821 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-06 14:01:57,360 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:01:57,361 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:01:57,361 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-06 14:01:57,551 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-06 14:01:57,673 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:01:58,564 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-06 14:01:58,564 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-06 14:01:58,565 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-06 14:01:59,818 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:01:59,819 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:01:59,819 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-06 14:01:59,844 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-06 14:01:59,862 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:00,472 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-06 14:02:00,472 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-06 14:02:00,472 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-06 14:02:00,975 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-06 14:02:00,975 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-06 14:02:01,583 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:01,583 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-06 14:02:01,583 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-06 14:02:01,583 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:01,620 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:02,163 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-06 14:02:02,163 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-06 14:02:02,164 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-06 14:02:04,331 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:04,331 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-06 14:02:04,331 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-06 14:02:04,332 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:04,367 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:04,928 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-06 14:02:04,928 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-06 14:02:04,928 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-06 14:02:05,428 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-06 14:02:05,428 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-06 14:02:06,456 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:06,457 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-06 14:02:06,457 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:06,457 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-06 14:02:06,544 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:07,127 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-06 14:02:07,127 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-06 14:02:07,131 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-06 14:02:07,132 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-06 14:02:07,132 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-06 14:02:08,405 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:08,406 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-06 14:02:08,406 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-06 14:02:08,407 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:08,437 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:09,163 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-06 14:02:09,163 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-06 14:02:09,163 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-06 14:02:10,151 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-06 14:02:10,151 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-06 14:02:11,554 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:11,554 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-06 14:02:11,555 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-06 14:02:11,555 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:11,582 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:12,189 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-06 14:02:12,189 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-06 14:02:12,190 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-06 14:02:12,509 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-06 14:02:12,510 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-06 14:02:13,086 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:13,086 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-06 14:02:13,086 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:13,087 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-06 14:02:13,130 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:13,690 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-06 14:02:13,690 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-06 14:02:13,691 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-06 14:02:15,742 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-06 14:02:15,742 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-06 14:02:16,708 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:16,708 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-06 14:02:16,708 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:16,710 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-06 14:02:16,849 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:17,378 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-06 14:02:17,378 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-06 14:02:17,378 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-06 14:02:20,016 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:20,017 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-06 14:02:20,017 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:20,017 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-06 14:02:20,068 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:20,645 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-06 14:02:20,645 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-06 14:02:20,645 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-06 14:02:23,865 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:23,865 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-06 14:02:23,866 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:23,867 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-06 14:02:23,941 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:24,483 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-06 14:02:24,483 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-06 14:02:24,484 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-06 14:02:25,312 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:25,313 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-06 14:02:25,313 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-06 14:02:25,313 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:25,347 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-06 14:02:25,913 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-06 14:02:25,913 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-06 14:02:25,913 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-06 14:02:27,175 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-06 14:02:27,179 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-06 14:02:27,210 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-06 14:02:27,252 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'ErrorBAMLExecutorGeneral'
2025-06-06 14:02:27,252 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-06 14:02:27,253 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,253 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-06 14:02:27,257 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-06 14:02:27,258 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,262 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-06 14:02:27,262 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-06 14:02:27,263 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-06 14:02:27,284 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,284 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-06 14:02:27,285 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,285 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,285 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,368 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:27,369 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:27,369 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-06-06 14:02:27,370 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,370 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-06 14:02:27,370 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-06 14:02:27,370 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,370 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-06 14:02:27,371 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-06 14:02:27,371 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-06 14:02:27,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-06 14:02:27,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,436 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:27,436 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:27,437 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-06 14:02:27,438 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-06-06 14:02:27,438 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-06 14:02:27,438 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,438 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-06 14:02:27,439 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-06 14:02:27,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,439 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,440 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-06 14:02:27,440 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-06 14:02:27,440 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-06 14:02:27,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-06 14:02:27,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,441 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,489 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-06 14:02:27,490 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-06 14:02:27,531 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:27,531 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:27,532 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-06-06 14:02:27,532 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,532 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-06 14:02:27,533 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-06 14:02:27,533 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,534 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,534 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-06 14:02:27,535 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-06 14:02:27,536 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-06 14:02:27,537 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,537 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-06 14:02:27,537 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,538 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,538 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,715 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:27,715 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:27,716 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-06-06 14:02:27,716 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,716 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-06-06 14:02:27,717 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-06 14:02:27,717 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,717 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,717 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-06 14:02:27,717 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-06 14:02:27,718 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-06 14:02:27,719 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,719 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-06-06 14:02:27,719 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,719 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,720 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,781 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-06 14:02:27,781 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-06 14:02:27,781 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-06-06 14:02:27,782 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,782 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-06-06 14:02:27,782 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-06 14:02:27,782 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-06 14:02:27,783 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-06 14:02:27,783 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-06 14:02:27,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,784 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-06-06 14:02:27,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,785 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,849 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:27,849 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:27,850 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-06-06 14:02:27,850 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,850 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-06-06 14:02:27,850 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-06 14:02:27,850 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,851 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,851 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-06 14:02:27,851 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-06 14:02:27,851 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-06 14:02:27,852 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,853 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-06-06 14:02:27,853 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,853 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,853 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,915 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:27,916 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:27,916 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-06-06 14:02:27,916 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,916 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-06-06 14:02:27,916 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-06 14:02:27,917 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,917 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,917 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-06 14:02:27,917 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-06 14:02:27,917 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-06 14:02:27,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-06-06 14:02:27,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:27,976 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:27,976 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:27,976 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-06 14:02:27,977 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'ErrorBAMLExecutorGeneral'
2025-06-06 14:02:27,977 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-06 14:02:27,978 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-06-06 14:02:27,978 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-06-06 14:02:27,978 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-06 14:02:27,978 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:27,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:27,979 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-06 14:02:27,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-06 14:02:27,979 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-06 14:02:27,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:27,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-06-06 14:02:27,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:27,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:27,981 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:28,039 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:28,039 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:28,039 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2", Incomplete)., raw_output=Type 2, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-06 14:02:28,040 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLExecutorGeneral'
2025-06-06 14:02:28,040 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-06 14:02:28,040 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-06-06 14:02:28,041 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-06-06 14:02:28,041 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-06 14:02:28,041 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:28,041 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:28,042 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-06 14:02:28,042 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-06 14:02:28,042 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-06 14:02:28,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:28,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-06-06 14:02:28,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:28,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:28,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:28,315 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:28,316 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:28,318 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2 is the best fit.  The image is a simple graphic design with a small black geometric shape (a triangle) inside a circular border.  The aesthetic is minimalist.\n", Incomplete)., raw_output=Type 2 is the best fit.  The image is a simple graphic design with a small black geometric shape (a triangle) inside a circular border.  The aesthetic is minimalist.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-06 14:02:28,321 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'ErrorBAMLExecutorGeneral'
2025-06-06 14:02:28,321 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-06 14:02:28,321 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-06-06 14:02:28,321 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-06-06 14:02:28,321 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-06 14:02:28,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:28,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:28,322 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-06 14:02:28,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-06 14:02:28,322 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-06 14:02:28,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:28,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-06-06 14:02:28,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:28,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:28,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:29,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:29,151 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:29,151 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-06-06 14:02:29,151 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-06-06 14:02:29,152 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-06-06 14:02:29,152 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-06 14:02:29,152 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:29,152 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:29,153 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-06 14:02:29,153 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-06 14:02:29,153 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-06 14:02:29,154 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:29,154 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-06-06 14:02:29,154 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:29,154 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:29,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:29,483 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:29,483 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:29,483 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-06 14:02:29,484 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-06-06 14:02:29,484 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-06 14:02:29,484 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-06 14:02:29,484 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-06 14:02:29,485 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-06 14:02:29,485 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:29,486 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:29,486 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-06 14:02:29,486 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-06 14:02:29,486 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-06 14:02:29,487 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:29,487 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-06 14:02:29,487 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:29,487 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:29,487 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:30,729 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:30,729 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,113 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-06 14:02:31,113 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-06 14:02:31,114 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'FDT'
2025-06-06 14:02:31,114 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-06-06 14:02:31,114 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-06-06 14:02:31,114 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-06 14:02:31,114 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-06-06 14:02:31,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-06 14:02:31,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-06 14:02:31,115 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-06 14:02:31,115 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-06 14:02:31,116 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-06 14:02:31,117 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-06-06 14:02:31,117 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-06-06 14:02:31,117 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-06 14:02:31,117 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-06 14:02:31,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,293 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,293 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,293 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:31,293 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,293 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:31,293 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,294 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-06-06 14:02:31,295 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@jupyter.arnau.scs.es:11112).
2025-06-06 14:02:31,304 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,312 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,315 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:31,318 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,322 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:31,327 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,331 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:31,342 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,346 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,355 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,364 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,367 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,374 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:31,385 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,392 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:31,410 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:31,733 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,734 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,734 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,736 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,737 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,739 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,740 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,749 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,746 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,748 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,742 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:31,755 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,755 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,759 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,772 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:31,780 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:32,157 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:32,634 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:33,474 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:33,655 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:33,733 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:36,800 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:36,803 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:36,804 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:36,805 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:36,823 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:36,931 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:36,997 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-06 14:02:37,181 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:37,363 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:37,458 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:37,644 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:37,671 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:37,704 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:37,731 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:37,766 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:37,847 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:37,856 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:37,894 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:37,896 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-06 14:02:37,904 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:37,926 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-06 14:02:37,947 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:37,955 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:37,974 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:37,975 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:37,992 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:38,006 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:38,008 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:38,013 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:38,041 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:38,058 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:38,060 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:38,111 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:38,133 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:38,156 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:38,205 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-06 14:02:38,215 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:38,338 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:38,342 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:38,469 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:38,487 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:38,633 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:38,898 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:39,253 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,258 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,260 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,283 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,285 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,286 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,309 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@jupyter.arnau.scs.es:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-06 14:02:39,332 - pynetdicom.association - INFO - Requesting Association
2025-06-06 14:02:39,381 - pynetdicom.acse - INFO - Association Accepted
2025-06-06 14:02:39,387 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-06 14:02:39,473 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,493 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,500 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,559 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,561 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,565 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,653 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-06 14:02:39,661 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,677 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,681 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,706 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,707 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,708 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,849 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,850 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,854 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:39,901 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:39,903 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:39,904 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:40,078 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-06 14:02:40,079 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-06 14:02:40,080 - pynetdicom.association - INFO - Releasing Association
2025-06-06 14:02:40,087 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-06-06 14:02:40,088 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-06 14:02:40,088 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-06 14:02:40,123 - __main__ - INFO - Aplicación finalizada.
2025-06-19 12:53:03,918 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 12:53:07,291 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 12:53:07,709 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 12:53:07,860 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 12:53:07,861 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 12:53:07,861 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 12:53:07,862 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 12:53:07,921 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 12:53:07,921 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 12:53:07,922 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 12:53:07,922 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-19 12:53:07,923 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:53:07,948 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:53:08,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-19 12:53:08,650 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:53:08,650 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-19 12:53:09,887 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:53:09,888 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:53:09,907 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-19 12:53:09,948 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:53:10,381 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:53:10,982 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-19 12:53:10,983 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:53:10,983 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-19 12:53:12,484 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:53:12,485 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:53:12,487 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-19 12:53:12,501 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:53:12,534 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:53:13,233 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-19 12:53:13,234 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:53:13,235 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-19 12:53:14,379 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 12:53:14,381 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 12:53:14,778 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:53:14,790 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-19 12:53:14,791 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:53:14,793 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:53:14,847 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:53:57,170 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-19 12:54:04,540 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:54:16,889 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:54:18,548 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:54:20,567 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-19 12:54:33,583 - __main__ - INFO - Proceso interrumpido por el usuario.
2025-06-19 12:54:33,593 - __main__ - INFO - Aplicación finalizada.
2025-06-19 12:54:57,316 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 12:55:10,832 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 12:55:12,079 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 12:55:12,587 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 12:55:12,595 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 12:55:12,613 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 12:55:12,613 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 12:55:13,349 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 12:55:13,349 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 12:55:13,386 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 12:55:13,387 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-19 12:55:13,387 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:55:13,452 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:15,705 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-19 12:55:15,767 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:55:15,767 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-19 12:55:18,996 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:19,041 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:19,041 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-19 12:55:19,196 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:55:19,684 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:20,975 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-19 12:55:20,975 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:55:20,975 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-19 12:55:22,925 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:22,928 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:22,928 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-19 12:55:22,953 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:55:23,028 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:24,064 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-19 12:55:24,064 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:55:24,064 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-19 12:55:25,503 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:25,504 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:25,528 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-19 12:55:25,529 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:55:25,590 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:26,389 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 12:55:26,393 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 12:55:26,401 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-19 12:55:26,402 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:55:26,402 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-19 12:55:28,063 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:55:28,063 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:55:28,555 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:28,555 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-19 12:55:28,555 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 12:55:28,559 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:28,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:29,910 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-19 12:55:29,911 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 12:55:29,911 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-19 12:55:33,855 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:55:33,855 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:55:35,235 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:35,242 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-19 12:55:35,243 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:35,243 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 12:55:35,314 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:36,671 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-19 12:55:36,671 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 12:55:36,671 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-19 12:55:38,409 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 12:55:38,447 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 12:55:41,412 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:41,434 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:41,613 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-19 12:55:41,613 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 12:55:41,854 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:43,693 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-19 12:55:43,700 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 12:55:43,701 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-19 12:55:49,153 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:55:49,159 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:55:50,478 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:50,480 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-19 12:55:50,483 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:50,483 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 12:55:51,018 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:52,378 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-19 12:55:52,379 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 12:55:52,382 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-19 12:55:55,855 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:55:55,857 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:55:56,251 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:56,252 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-19 12:55:56,252 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:56,252 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 12:55:56,350 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:55:57,154 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-19 12:55:57,154 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 12:55:57,155 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-19 12:55:59,109 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:55:59,110 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-19 12:55:59,110 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 12:55:59,110 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:55:59,220 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:56:00,401 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 12:56:00,401 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 12:56:00,410 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-19 12:56:00,411 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 12:56:00,411 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-19 12:56:03,601 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 12:56:03,609 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 12:56:04,771 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:56:04,771 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-19 12:56:04,771 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 12:56:04,772 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:56:04,842 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:56:05,726 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-19 12:56:05,726 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 12:56:05,726 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-19 12:56:08,009 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 12:56:08,010 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 12:56:12,454 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:56:12,564 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-19 12:56:12,570 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 12:56:12,617 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:56:13,325 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:57:39,104 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-19 12:57:39,247 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 12:57:39,281 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-19 12:57:48,492 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:57:48,586 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-19 12:57:48,595 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 12:57:48,638 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:57:49,754 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:57:57,585 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-19 12:57:57,600 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 12:57:57,601 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-19 12:57:59,977 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:57:59,979 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-19 12:57:59,980 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:57:59,980 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 12:58:00,985 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:58:02,117 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:58:02,120 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:58:02,152 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-19 12:58:02,152 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 12:58:02,152 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-19 12:58:04,549 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:58:04,567 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:58:04,585 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-06-19 12:58:04,799 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-19 12:58:04,799 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-19 12:58:04,800 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:58:04,813 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 12:58:04,837 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 12:58:04,837 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 12:58:04,842 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 12:58:04,847 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:58:04,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 12:58:04,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-19 12:58:04,919 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 12:58:04,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 12:58:04,920 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 12:58:09,369 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 12:58:09,369 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 12:58:09,384 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-06-19 12:58:09,384 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-19 12:58:09,384 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-19 12:58:09,384 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:58:09,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 12:58:09,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 12:58:09,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 12:58:09,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 12:58:09,385 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:58:09,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 12:58:09,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-19 12:58:09,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 12:58:09,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 12:58:09,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 12:58:10,328 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 12:58:10,328 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 12:58:10,346 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1.  The image is a monochromatic texture with subtle variations in gray tones and a soft, gradient-like appearance.  It lacks the geometric shapes or defined structures described in Types 2 and 3.\n", Incomplete)., raw_output=Type 1.  The image is a monochromatic texture with subtle variations in gray tones and a soft, gradient-like appearance.  It lacks the geometric shapes or defined structures described in Types 2 and 3.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 12:58:10,544 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 12:58:10,544 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 12:58:10,544 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-19 12:58:10,544 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-19 12:58:10,544 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:58:10,544 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 12:58:10,545 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 12:58:10,545 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 12:58:10,551 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 12:58:10,551 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:58:10,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 12:58:10,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-19 12:58:10,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 12:58:10,553 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 12:58:10,557 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 12:58:13,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 12:58:13,165 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 12:58:13,174 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-06-19 12:58:13,175 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-19 12:58:13,176 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-19 12:58:13,181 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:58:13,182 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 12:58:13,183 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 12:58:13,183 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 12:58:13,184 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 12:58:13,184 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:58:13,194 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 12:58:13,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-19 12:58:13,195 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 12:58:13,196 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 12:58:13,196 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 12:58:22,285 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 12:58:22,287 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 12:58:24,136 - __main__ - INFO - Proceso interrumpido por el usuario.
2025-06-19 12:58:24,136 - __main__ - INFO - Aplicación finalizada.
2025-06-19 12:58:56,275 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 12:59:01,484 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 12:59:02,001 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 12:59:02,164 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 12:59:02,167 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 12:59:02,175 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 12:59:02,176 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 12:59:02,325 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 12:59:02,326 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 12:59:02,336 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 12:59:02,336 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-19 12:59:02,336 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:59:02,471 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:03,771 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-19 12:59:03,772 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 12:59:03,772 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-19 12:59:08,540 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:08,633 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:08,635 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-19 12:59:08,738 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:59:08,952 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:10,783 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-19 12:59:10,786 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 12:59:10,787 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-19 12:59:13,360 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:13,378 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:13,378 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-19 12:59:13,417 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:59:13,463 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:13,982 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 12:59:13,984 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 12:59:14,666 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-19 12:59:14,666 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 12:59:14,666 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-19 12:59:16,714 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:16,851 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-19 12:59:16,851 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:59:16,770 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:59:16,852 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:59:16,858 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:17,643 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:18,936 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-19 12:59:18,974 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 12:59:18,974 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-19 12:59:21,233 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:21,235 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-19 12:59:21,236 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:21,243 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 12:59:21,331 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:22,772 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 12:59:22,785 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-19 12:59:22,812 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 12:59:22,812 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-19 12:59:22,810 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 12:59:25,444 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:59:25,448 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:59:28,075 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:28,109 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-19 12:59:28,109 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 12:59:28,111 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:28,470 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:29,996 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-19 12:59:30,085 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 12:59:30,088 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-19 12:59:33,946 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:33,954 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-19 12:59:33,956 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 12:59:33,955 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:34,238 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:35,396 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-19 12:59:35,396 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 12:59:35,396 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-19 12:59:37,217 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:37,218 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-19 12:59:37,219 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 12:59:37,218 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:37,272 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:38,063 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-19 12:59:38,064 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 12:59:38,064 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-19 12:59:39,806 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:59:39,806 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:59:40,799 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 12:59:40,800 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 12:59:42,817 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:42,818 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-19 12:59:42,818 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:42,824 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 12:59:42,929 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:44,232 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-19 12:59:44,233 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 12:59:44,235 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-19 12:59:46,089 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 12:59:46,089 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 12:59:46,411 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:46,412 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-19 12:59:46,412 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:46,412 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 12:59:46,478 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:47,480 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-19 12:59:47,480 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 12:59:47,480 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-19 12:59:52,613 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 12:59:52,630 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-19 12:59:52,631 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 12:59:52,647 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 12:59:52,968 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 12:59:54,741 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-19 12:59:54,743 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 12:59:54,743 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-19 12:59:56,068 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 12:59:56,078 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 13:00:00,548 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 13:00:00,720 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-19 13:00:00,721 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 13:00:00,725 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 13:00:11,754 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 13:00:13,530 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-19 13:00:13,530 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 13:00:13,530 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-19 13:00:15,812 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 13:00:15,827 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 13:00:15,830 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-19 13:00:15,928 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:00:15,979 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 13:00:16,705 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-19 13:00:16,710 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:00:16,711 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-19 13:00:18,254 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 13:00:18,260 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 13:00:18,260 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-19 13:00:18,295 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 13:00:18,328 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 13:00:18,982 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-19 13:00:18,982 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 13:00:18,983 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-19 13:00:19,890 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 13:00:19,890 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 13:00:20,229 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 13:00:20,240 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-06-19 13:00:20,240 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-19 13:00:20,242 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-19 13:00:20,242 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 13:00:20,253 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 13:00:20,269 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:20,283 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:20,285 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 13:00:20,296 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 13:00:20,297 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 13:00:20,389 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:20,389 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-19 13:00:20,389 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:20,394 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:20,394 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:20,990 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:00:20,993 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:00:20,994 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-06-19 13:00:20,995 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-19 13:00:20,995 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-19 13:00:20,995 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 13:00:20,995 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:20,996 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:20,996 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 13:00:20,996 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 13:00:20,997 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 13:00:20,998 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:20,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-19 13:00:20,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:20,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:20,999 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:23,366 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 13:00:23,367 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 13:00:23,405 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:00:23,405 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:00:23,405 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-06-19 13:00:23,405 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-19 13:00:23,406 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-19 13:00:23,406 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 13:00:23,406 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:23,410 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:23,410 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 13:00:23,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 13:00:23,413 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 13:00:23,415 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:23,416 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-19 13:00:23,416 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:23,416 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:23,417 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:23,931 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 13:00:23,931 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 13:00:23,972 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:00:23,973 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:00:23,981 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-06-19 13:00:23,982 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-19 13:00:23,982 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-19 13:00:23,982 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 13:00:23,982 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:23,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:23,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 13:00:23,983 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 13:00:23,983 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 13:00:23,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:23,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-19 13:00:23,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:23,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:23,984 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:25,832 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 13:00:25,832 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 13:00:49,265 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:00:50,337 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:00:50,353 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2", Incomplete)., raw_output=Type 2, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 13:00:50,527 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 13:00:50,527 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 13:00:50,527 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-06-19 13:00:50,527 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-06-19 13:00:50,528 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 13:00:50,538 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:50,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:50,562 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 13:00:50,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 13:00:50,562 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 13:00:50,939 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:50,939 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-06-19 13:00:50,939 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:50,940 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:50,960 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:55,336 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 13:00:55,336 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 13:00:55,337 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-06-19 13:00:55,337 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-06-19 13:00:55,337 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-06-19 13:00:55,338 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 13:00:55,338 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:55,338 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:55,338 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 13:00:55,342 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 13:00:55,343 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 13:00:55,345 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:55,345 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-06-19 13:00:55,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:55,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:55,346 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:56,055 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:00:56,057 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:00:56,058 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-06-19 13:00:56,058 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-06-19 13:00:56,059 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-06-19 13:00:56,059 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 13:00:56,059 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:56,059 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:56,060 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 13:00:56,060 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 13:00:56,060 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 13:00:56,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:56,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-06-19 13:00:56,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:56,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:56,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:00:57,093 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:00:57,093 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:00:57,093 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-06-19 13:00:57,093 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-06-19 13:00:57,093 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-06-19 13:00:57,094 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 13:00:57,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:00:57,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:00:57,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-19 13:00:57,094 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-19 13:00:57,095 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 13:00:57,096 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:00:57,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-06-19 13:00:57,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:00:57,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:00:57,097 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:02,206 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:02,210 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:02,212 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 13:01:02,218 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 13:01:02,219 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 13:01:02,219 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-06-19 13:01:02,219 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-06-19 13:01:02,219 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 13:01:02,220 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:01:02,220 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:01:02,220 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 13:01:02,220 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 13:01:02,220 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 13:01:02,236 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:01:02,238 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-06-19 13:01:02,238 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:01:02,238 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:01:02,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:02,684 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:02,687 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:02,687 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-06-19 13:01:02,687 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-06-19 13:01:02,687 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-06-19 13:01:02,690 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 13:01:02,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:01:02,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:01:02,696 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-19 13:01:02,697 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-19 13:01:02,697 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 13:01:02,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:01:02,710 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-06-19 13:01:02,710 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:01:02,710 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:01:02,712 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:03,209 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:03,213 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:03,213 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-06-19 13:01:03,213 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-06-19 13:01:03,215 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-06-19 13:01:03,218 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 13:01:03,220 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:01:03,222 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:01:03,223 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-19 13:01:03,223 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-19 13:01:03,224 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 13:01:03,232 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:01:03,234 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-06-19 13:01:03,234 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:01:03,234 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:01:03,235 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:05,471 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:05,474 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:05,475 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-06-19 13:01:05,482 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-06-19 13:01:05,482 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-06-19 13:01:05,488 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 13:01:05,488 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:01:05,490 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:01:05,491 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 13:01:05,491 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 13:01:05,491 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 13:01:05,497 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:01:05,505 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-06-19 13:01:05,506 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:01:05,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:01:05,508 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:05,883 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:01:05,883 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:01:05,883 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-06-19 13:01:05,883 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-19 13:01:05,883 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-19 13:01:05,883 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:01:05,883 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:01:05,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:01:05,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 13:01:05,884 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 13:01:05,885 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:01:05,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:01:05,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-19 13:01:05,887 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:01:05,887 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:01:05,887 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:09,541 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,542 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,552 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'FDT'
2025-06-19 13:01:09,553 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-06-19 13:01:09,554 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-06-19 13:01:09,555 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 13:01:09,558 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:01:09,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:01:09,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 13:01:09,561 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 13:01:09,562 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 13:01:09,564 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:01:09,565 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-06-19 13:01:09,566 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:01:09,567 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:01:09,567 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:01:09,778 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,784 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,813 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,815 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:01:09,815 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:09,816 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:09,817 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:01:09,817 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,817 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,817 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-06-19 13:01:09,820 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-06-19 13:01:09,842 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,846 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:01:09,871 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 13:01:09,896 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:09,898 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:09,903 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:09,917 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 13:01:09,923 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:09,937 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,942 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:09,955 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:09,966 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:09,977 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 13:01:09,984 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:10,000 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:01:10,006 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:01:11,978 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:11,983 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:11,990 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:11,999 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:12,000 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,000 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,001 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:12,024 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:12,030 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:12,032 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,036 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:01:12,056 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,035 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,044 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,054 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,107 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:01:12,703 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:01:12,706 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:01:13,889 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:01:14,051 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:01:14,319 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:01:14,320 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:01:14,486 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:05:46,355 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 13:05:49,506 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 13:05:49,991 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 13:05:50,154 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 13:05:50,155 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 13:05:50,155 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 13:05:50,155 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 13:05:50,188 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 13:05:50,188 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 13:05:50,188 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 13:05:50,189 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-19 13:05:50,189 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:05:50,195 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 13:05:50,906 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-19 13:05:50,906 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:05:50,907 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-19 13:05:51,803 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 13:05:51,805 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 13:05:55,936 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 13:05:55,943 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 13:05:55,944 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 13:05:55,944 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-19 13:05:55,944 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-19 13:05:55,944 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:05:55,944 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 13:05:55,945 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 13:05:55,945 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 13:05:55,945 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 13:05:55,945 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 13:05:55,951 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 13:05:55,951 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-19 13:05:55,951 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 13:05:55,952 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 13:05:55,952 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 13:05:56,005 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:05:56,006 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:05:56,006 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:05:56,006 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-06-19 13:05:56,007 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-06-19 13:05:56,012 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 13:05:56,014 - pynetdicom.association - INFO - Requesting Association
2025-06-19 13:05:56,039 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 13:05:56,040 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 13:05:56,072 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 13:05:58,961 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 13:05:58,964 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 13:05:58,964 - pynetdicom.association - INFO - Releasing Association
2025-06-19 13:05:58,978 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-06-19 13:05:58,978 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-19 13:05:58,978 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 13:05:58,980 - __main__ - INFO - Aplicación finalizada.
2025-06-19 14:55:15,015 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 14:55:18,966 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 14:55:19,502 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 14:55:19,711 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 14:55:19,712 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 14:55:19,714 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 14:55:19,715 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 14:55:19,789 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 14:55:19,789 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 14:55:19,791 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 14:55:19,791 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-19 14:55:19,791 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:55:19,848 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 14:55:20,982 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-19 14:55:20,983 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:55:20,983 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-19 14:55:22,467 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 14:55:22,470 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 14:55:28,532 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 14:55:28,532 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 14:55:28,534 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-06-19 14:55:28,534 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-19 14:55:28,534 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-19 14:55:28,534 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:55:28,535 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 14:55:28,536 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 14:55:28,536 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 14:55:28,536 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 14:55:28,536 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:55:28,543 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 14:55:28,543 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-19 14:55:28,543 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 14:55:28,543 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 14:55:28,544 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 14:55:28,637 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:55:28,637 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:55:28,638 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:55:28,638 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-06-19 14:55:28,638 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-06-19 14:55:28,651 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:55:28,663 - pynetdicom.association - INFO - Requesting Association
2025-06-19 14:55:28,719 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 14:55:28,720 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 14:55:28,745 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 14:55:30,680 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 14:55:30,681 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 14:55:30,682 - pynetdicom.association - INFO - Releasing Association
2025-06-19 14:55:30,695 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-06-19 14:55:30,696 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-19 14:55:30,696 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 14:55:30,698 - __main__ - INFO - Aplicación finalizada.
2025-06-19 14:56:04,344 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 14:56:05,258 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 14:56:05,568 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 14:56:05,621 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 14:56:05,621 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 14:56:05,622 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 14:56:05,622 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 14:56:05,626 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 14:56:05,627 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 14:56:05,627 - __main__ - INFO - Se encontraron 1 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 14:56:05,627 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-19 14:56:05,628 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:56:05,632 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 14:56:06,139 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-19 14:56:06,139 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:56:06,139 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-19 14:56:08,341 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 14:56:08,342 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 14:56:12,013 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 14:56:12,013 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 14:56:12,014 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-06-19 14:56:12,014 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-19 14:56:12,015 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-19 14:56:12,015 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:56:12,015 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 14:56:12,016 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 14:56:12,016 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 14:56:12,016 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 14:56:12,016 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 14:56:12,018 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 14:56:12,018 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-19 14:56:12,018 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 14:56:12,019 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 14:56:12,019 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 14:56:12,079 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:56:12,079 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:56:12,079 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:56:12,079 - __main__ - INFO - Se procesaron 1 ficheros con éxito. Iniciando envío a PACS...
2025-06-19 14:56:12,080 - pacs_operations - INFO - Iniciando envío de 1 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-06-19 14:56:12,083 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 14:56:12,086 - pynetdicom.association - INFO - Requesting Association
2025-06-19 14:56:12,093 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 14:56:12,094 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 14:56:12,116 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 14:56:13,413 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 14:56:13,414 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 14:56:13,416 - pynetdicom.association - INFO - Releasing Association
2025-06-19 14:56:13,429 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 1 de 1 exitosos, 0 de 1 fallidos.
2025-06-19 14:56:13,429 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-19 14:56:13,429 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 14:56:13,430 - __main__ - INFO - Aplicación finalizada.
2025-06-19 15:02:39,546 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-06-19 15:02:40,445 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-06-19 15:02:40,758 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-06-19 15:02:40,811 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-06-19 15:02:40,812 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-06-19 15:02:40,812 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 15:02:40,812 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-06-19 15:02:40,817 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-06-19 15:02:40,818 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-06-19 15:02:40,818 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-06-19 15:02:40,819 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-06-19 15:02:40,819 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 15:02:40,824 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:02:41,384 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-06-19 15:02:41,385 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 15:02:41,385 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-06-19 15:02:44,137 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:02:44,139 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:02:44,154 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-06-19 15:02:44,162 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 15:02:44,166 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:02:47,103 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-06-19 15:02:47,104 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 15:02:47,104 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-06-19 15:02:55,743 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:02:55,746 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-06-19 15:02:55,749 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 15:02:55,746 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:02:55,820 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:02:56,403 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-06-19 15:02:56,404 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 15:02:56,405 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-06-19 15:02:57,662 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:02:57,663 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:02:57,663 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-06-19 15:02:57,686 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 15:02:57,715 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:02:58,568 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-06-19 15:02:58,568 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 15:02:58,568 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-06-19 15:03:02,200 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:02,201 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-06-19 15:03:02,201 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:02,202 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 15:03:02,228 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:02,754 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-06-19 15:03:02,754 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 15:03:02,754 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-06-19 15:03:05,109 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:05,111 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-06-19 15:03:05,111 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:05,112 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 15:03:05,157 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:05,744 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 15:03:05,745 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-06-19 15:03:05,745 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 15:03:05,746 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 15:03:05,746 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-06-19 15:03:07,012 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:07,013 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-06-19 15:03:07,013 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:07,081 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 15:03:07,442 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:07,958 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 15:03:07,958 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 15:03:07,963 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-06-19 15:03:07,964 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 15:03:07,965 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-06-19 15:03:09,350 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:09,351 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-06-19 15:03:09,351 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:09,352 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 15:03:09,410 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:09,976 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-06-19 15:03:09,977 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 15:03:09,977 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-06-19 15:03:10,150 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 15:03:10,150 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 15:03:13,029 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:13,030 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-06-19 15:03:13,030 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:13,030 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 15:03:13,062 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:13,284 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 15:03:13,285 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 15:03:13,585 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-06-19 15:03:13,585 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 15:03:13,585 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-06-19 15:03:14,968 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:14,968 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-06-19 15:03:14,969 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:14,969 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 15:03:15,013 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:15,536 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 15:03:15,536 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 15:03:15,552 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-06-19 15:03:15,552 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 15:03:15,552 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-06-19 15:03:18,725 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 15:03:18,725 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 15:03:19,191 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:19,191 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-06-19 15:03:19,192 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:19,192 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 15:03:19,218 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:19,777 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-06-19 15:03:19,777 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 15:03:19,777 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-06-19 15:03:23,626 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:23,627 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-06-19 15:03:23,627 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 15:03:23,627 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:23,658 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:24,177 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-06-19 15:03:24,177 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 15:03:24,177 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-06-19 15:03:27,100 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-06-19 15:03:27,100 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-06-19 15:03:28,006 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:28,007 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-06-19 15:03:28,007 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:28,008 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 15:03:28,033 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:28,678 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-06-19 15:03:28,678 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 15:03:28,678 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-06-19 15:03:31,344 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:31,345 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-06-19 15:03:31,345 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:31,345 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 15:03:31,368 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-06-19 15:03:31,974 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-06-19 15:03:31,974 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 15:03:31,974 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-06-19 15:03:34,392 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-06-19 15:03:34,393 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-06-19 15:03:34,435 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-06-19 15:03:34,437 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-06-19 15:03:34,437 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 15:03:35,476 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 15:03:35,476 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 15:03:35,476 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-06-19 15:03:35,476 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-06-19 15:03:35,476 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 15:03:35,476 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:35,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:35,477 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 15:03:35,477 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 15:03:35,477 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-06-19 15:03:35,499 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:35,499 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-06-19 15:03:35,499 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:35,500 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:35,501 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:35,554 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:35,556 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:35,556 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 is the best fit.  The image is circular, has a grid-like shape in the center, surrounding dots, and a blurred (or out-of-focus) background. While elements of Type 2 are present (simple graphic design, circular border), Type 3 encompasses all the key features more accurately. Type 1 doesn't capture the distinct shapes and structure within the image.\n", Incomplete)., raw_output=Type 3 is the best fit.  The image is circular, has a grid-like shape in the center, surrounding dots, and a blurred (or out-of-focus) background. While elements of Type 2 are present (simple graphic design, circular border), Type 3 encompasses all the key features more accurately. Type 1 doesn't capture the distinct shapes and structure within the image.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 15:03:35,558 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 15:03:35,558 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 15:03:35,559 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-06-19 15:03:35,559 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-06-19 15:03:35,559 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 15:03:35,560 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:35,560 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:35,560 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 15:03:35,560 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 15:03:35,560 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-06-19 15:03:35,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:35,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-06-19 15:03:35,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:35,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:35,562 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:35,655 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:35,655 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:35,655 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 15:03:35,657 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 15:03:35,657 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 15:03:35,657 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-06-19 15:03:35,657 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-06-19 15:03:35,658 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 15:03:35,658 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:35,658 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:35,658 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 15:03:35,658 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 15:03:35,659 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-06-19 15:03:35,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:35,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-06-19 15:03:35,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:35,660 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:35,661 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:35,707 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:35,708 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:35,708 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-06-19 15:03:35,708 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-06-19 15:03:35,709 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-06-19 15:03:35,709 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 15:03:35,710 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:35,710 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:35,711 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 15:03:35,711 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 15:03:35,712 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-06-19 15:03:35,713 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:35,714 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-06-19 15:03:35,714 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:35,714 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:35,714 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:36,319 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:36,319 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:36,320 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-06-19 15:03:36,320 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-06-19 15:03:36,321 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-06-19 15:03:36,321 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 15:03:36,321 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:36,321 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:36,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-19 15:03:36,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-19 15:03:36,322 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-06-19 15:03:36,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:36,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-06-19 15:03:36,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:36,324 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:36,325 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:36,768 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 15:03:36,768 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 15:03:36,768 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-06-19 15:03:36,768 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-06-19 15:03:36,768 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-06-19 15:03:36,768 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 15:03:36,769 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:36,769 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:36,769 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 15:03:36,769 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 15:03:36,770 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-06-19 15:03:36,775 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:36,775 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-06-19 15:03:36,776 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:36,776 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:36,777 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:37,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:37,140 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:37,140 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-06-19 15:03:37,140 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-06-19 15:03:37,140 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-06-19 15:03:37,140 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 15:03:37,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:37,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:37,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 15:03:37,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 15:03:37,141 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-06-19 15:03:37,143 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:37,143 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-06-19 15:03:37,143 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:37,144 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:37,145 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:37,352 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:37,352 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:37,352 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-06-19 15:03:37,352 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-06-19 15:03:37,352 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-06-19 15:03:37,353 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 15:03:37,353 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:37,353 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:37,354 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-19 15:03:37,354 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-19 15:03:37,354 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-06-19 15:03:37,355 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:37,355 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-06-19 15:03:37,356 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:37,356 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:37,356 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:37,691 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:37,692 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:37,692 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-06-19 15:03:37,692 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-06-19 15:03:37,692 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-06-19 15:03:37,692 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 15:03:37,692 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:37,693 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:37,693 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 15:03:37,693 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 15:03:37,693 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-06-19 15:03:37,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:37,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-06-19 15:03:37,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:37,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:37,695 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:37,814 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:37,814 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:37,814 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2", Incomplete)., raw_output=Type 2, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 15:03:37,816 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 15:03:37,816 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 15:03:37,816 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-06-19 15:03:37,816 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-06-19 15:03:37,816 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 15:03:37,816 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:37,817 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:37,817 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 15:03:37,817 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 15:03:37,817 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-06-19 15:03:37,818 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:37,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-06-19 15:03:37,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:37,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:37,819 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:37,926 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:37,927 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:37,927 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-06-19 15:03:37,927 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-06-19 15:03:37,927 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-06-19 15:03:37,927 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 15:03:37,927 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:37,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:37,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-06-19 15:03:37,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-06-19 15:03:37,928 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-06-19 15:03:37,930 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:37,930 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-06-19 15:03:37,930 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:37,930 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:37,931 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:38,006 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:38,006 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:38,007 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-06-19 15:03:38,007 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-06-19 15:03:38,007 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-06-19 15:03:38,007 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 15:03:38,007 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:38,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:38,008 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-06-19 15:03:38,009 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-06-19 15:03:38,009 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-06-19 15:03:38,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:38,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-06-19 15:03:38,010 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:38,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:38,011 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:38,144 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,144 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,287 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-06-19 15:03:38,287 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-06-19 15:03:38,288 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-06-19 15:03:38,288 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-06-19 15:03:38,288 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-06-19 15:03:38,288 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 15:03:38,289 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:38,289 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:38,289 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-06-19 15:03:38,290 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-06-19 15:03:38,290 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-06-19 15:03:38,291 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:38,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-06-19 15:03:38,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:38,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:38,292 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:38,332 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:38,332 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:38,492 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1.  The image is a monochromatic texture with subtle variations in shades of gray.  It has a soft, gradient-like quality, lacking any defined shapes or geometric elements.\n", Incomplete)., raw_output=Type 1.  The image is a monochromatic texture with subtle variations in shades of gray.  It has a soft, gradient-like quality, lacking any defined shapes or geometric elements.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-06-19 15:03:38,494 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-06-19 15:03:38,494 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-06-19 15:03:38,494 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-06-19 15:03:38,494 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-06-19 15:03:38,494 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 15:03:38,494 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-06-19 15:03:38,495 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-06-19 15:03:38,495 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-06-19 15:03:38,495 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-06-19 15:03:38,495 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-06-19 15:03:38,496 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-06-19 15:03:38,497 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-06-19 15:03:38,497 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-06-19 15:03:38,497 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-06-19 15:03:38,497 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-06-19 15:03:38,647 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,647 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,648 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,648 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:38,648 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,648 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:38,648 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 15:03:38,649 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:38,649 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:38,649 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:38,649 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,649 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:38,649 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:38,650 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:38,650 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,650 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:38,650 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-06-19 15:03:38,651 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-06-19 15:03:39,838 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:39,847 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:39,851 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:39,860 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:39,865 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:39,868 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:39,871 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:39,874 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:39,877 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:39,884 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:39,884 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:39,886 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:39,920 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:39,927 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:39,935 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:39,942 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:39,965 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:40,044 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:40,081 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:40,099 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:40,278 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:40,280 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:40,283 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:40,283 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:40,311 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:40,487 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:40,683 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:40,697 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:40,698 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:40,712 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:40,859 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:40,860 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:40,982 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:41,023 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:41,034 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:41,067 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:43,352 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:44,589 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:45,040 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:45,042 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:45,173 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:45,187 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:45,209 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:45,231 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-06-19 15:03:45,247 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:45,269 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:45,281 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:45,591 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:46,144 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:46,159 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:46,160 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:46,173 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-06-19 15:03:46,192 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:46,216 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:46,217 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:46,462 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:46,730 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:46,732 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:46,733 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:46,747 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-06-19 15:03:46,750 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:46,760 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:46,762 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:46,843 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:47,672 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:47,675 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:47,675 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:47,689 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:47,693 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:47,704 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:47,707 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:47,799 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:49,184 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:49,185 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:49,187 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:49,193 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-06-19 15:03:49,197 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:49,203 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:49,205 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:49,538 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:49,998 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:50,016 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:50,016 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:50,035 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-06-19 15:03:50,037 - pynetdicom.association - INFO - Requesting Association
2025-06-19 15:03:50,045 - pynetdicom.acse - INFO - Association Accepted
2025-06-19 15:03:50,045 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-06-19 15:03:50,201 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-06-19 15:03:54,473 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:54,476 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:54,478 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:54,496 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:54,530 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:54,530 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:54,743 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:54,746 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:54,748 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:54,886 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:54,890 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:54,891 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:55,209 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:55,213 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:55,214 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:56,111 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:56,112 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:56,114 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:57,973 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:57,975 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:57,978 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:58,510 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-06-19 15:03:58,511 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-06-19 15:03:58,512 - pynetdicom.association - INFO - Releasing Association
2025-06-19 15:03:58,526 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-06-19 15:03:58,526 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-06-19 15:03:58,526 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-06-19 15:03:58,534 - __main__ - INFO - Aplicación finalizada.
2025-07-07 09:20:36,626 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-07-07 09:20:38,798 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-07-07 09:20:39,194 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-07-07 09:20:39,319 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-07-07 09:20:39,319 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-07-07 09:20:39,320 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 09:20:39,320 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-07-07 09:20:39,360 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-07-07 09:20:39,360 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-07-07 09:20:39,360 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-07-07 09:20:39,361 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-07-07 09:20:39,361 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:20:39,409 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:20:40,062 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-07-07 09:20:40,063 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:20:40,063 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-07-07 09:20:41,627 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:20:41,629 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:20:41,655 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-07-07 09:20:41,671 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:20:41,731 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:20:43,833 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-07-07 09:20:43,834 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:20:43,834 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-07-07 09:20:47,528 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:20:50,528 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:20:50,529 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-07-07 09:20:50,551 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:20:50,606 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:20:51,244 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-07-07 09:20:51,244 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:20:51,244 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-07-07 09:20:52,763 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:20:55,693 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:20:55,710 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-07-07 09:20:55,710 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:20:55,913 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:20:56,197 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:20:56,197 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 09:20:56,508 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 09:20:56,507 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:20:56,512 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-07-07 09:20:56,513 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:20:56,513 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-07-07 09:20:58,130 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:20:58,130 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-07-07 09:20:58,131 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:20:58,131 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:20:58,167 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:20:58,760 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-07-07 09:20:58,760 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:20:58,760 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-07-07 09:21:01,242 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:01,245 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-07-07 09:21:01,246 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:21:01,245 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:01,278 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:01,812 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-07-07 09:21:01,813 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:21:01,813 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-07-07 09:21:03,105 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:03,105 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-07-07 09:21:03,106 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:03,106 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:21:03,136 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:03,651 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:21:03,652 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:21:03,655 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-07-07 09:21:03,656 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:21:03,656 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-07-07 09:21:05,050 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:05,050 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-07-07 09:21:05,050 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:05,051 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:21:05,088 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:05,645 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-07-07 09:21:05,645 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:21:05,645 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-07-07 09:21:07,553 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 09:21:07,553 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 09:21:08,080 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:08,081 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-07-07 09:21:08,081 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:08,081 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:21:08,108 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:08,658 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-07-07 09:21:08,658 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:21:08,658 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-07-07 09:21:09,866 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:09,866 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-07-07 09:21:09,866 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:21:09,867 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:09,898 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:10,420 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-07-07 09:21:10,420 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:21:10,420 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-07-07 09:21:10,935 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:21:10,935 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:21:13,390 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:21:13,390 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:21:13,799 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:14,656 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-07-07 09:21:14,657 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:21:14,657 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:14,699 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:15,256 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-07-07 09:21:15,256 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:21:15,257 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-07-07 09:21:17,617 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:17,618 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-07-07 09:21:17,618 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:21:17,618 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:17,654 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:17,882 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:21:17,882 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:21:18,170 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-07-07 09:21:18,170 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:21:18,170 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-07-07 09:21:19,214 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:19,214 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-07-07 09:21:19,215 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:19,215 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:21:19,276 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:19,802 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-07-07 09:21:19,802 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:21:19,802 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-07-07 09:21:20,553 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:21:20,553 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:21:20,822 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:20,823 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-07-07 09:21:20,823 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:20,823 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:21:20,859 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:21:21,417 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-07-07 09:21:21,417 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:21:21,417 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-07-07 09:21:22,656 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:21:22,661 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:21:22,664 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-07-07 09:21:22,670 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-07-07 09:21:22,670 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-07-07 09:21:22,672 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:21:22,678 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:22,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:22,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 09:21:22,699 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 09:21:22,699 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:21:22,730 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:22,730 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-07-07 09:21:22,730 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:22,731 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:22,731 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:22,800 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:22,800 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:22,800 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-07-07 09:21:22,801 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-07-07 09:21:22,801 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-07-07 09:21:22,801 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:21:22,801 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:22,802 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:22,802 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:21:22,802 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:21:22,802 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:21:22,803 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:22,803 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-07-07 09:21:22,803 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:22,804 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:22,804 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:22,893 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:22,893 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:22,893 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:21:22,904 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:21:22,904 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:21:22,904 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-07-07 09:21:22,904 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-07-07 09:21:22,904 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:21:22,905 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:22,905 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:22,905 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:21:22,906 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:21:22,907 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:21:22,909 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:22,909 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-07-07 09:21:22,910 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:22,910 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:22,910 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:23,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:23,156 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:23,157 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 is the best fit.  While elements of Type 1 and Type 2 are present, Type 3 most accurately encompasses all the key features: the circular design, the grayscale palette, the grid-like central shape, and the surrounding dots.  The blurred background is also a good match.\n", Incomplete)., raw_output=Type 3 is the best fit.  While elements of Type 1 and Type 2 are present, Type 3 most accurately encompasses all the key features: the circular design, the grayscale palette, the grid-like central shape, and the surrounding dots.  The blurred background is also a good match.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:21:23,159 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:21:23,159 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:21:23,159 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-07-07 09:21:23,159 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-07-07 09:21:23,160 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:21:23,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:23,161 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:23,162 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:21:23,162 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:21:23,162 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:21:23,163 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:23,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-07-07 09:21:23,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:23,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:23,164 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:23,560 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:23,561 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:23,561 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-07-07 09:21:23,562 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-07-07 09:21:23,562 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-07-07 09:21:23,563 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:21:23,563 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:23,564 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:23,565 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:21:23,565 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:21:23,567 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:21:23,570 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:23,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-07-07 09:21:23,572 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:23,573 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:23,574 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:23,821 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:21:23,822 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:21:23,822 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-07-07 09:21:23,822 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-07-07 09:21:23,822 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-07-07 09:21:23,823 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:21:23,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:23,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:23,823 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 09:21:23,824 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 09:21:23,824 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:21:23,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:23,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-07-07 09:21:23,825 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:23,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:23,826 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:23,928 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:23,928 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:23,928 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("The best classification for the image is **Type 3**.  It's a circular design in grayscale, features a grid-like shape (the microchip) in the center, has surrounding dots, and a blurred (or simply plain) background.  While elements of Type 2 are present (simple graphic design, minimalist), Type 3 is the most encompassing and accurate description.\n", Incomplete)., raw_output=The best classification for the image is **Type 3**.  It's a circular design in grayscale, features a grid-like shape (the microchip) in the center, has surrounding dots, and a blurred (or simply plain) background.  While elements of Type 2 are present (simple graphic design, minimalist), Type 3 is the most encompassing and accurate description.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:21:23,929 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:21:23,929 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:21:23,929 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-07-07 09:21:23,929 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-07-07 09:21:23,930 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:21:23,930 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:23,930 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:23,930 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:21:23,931 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:21:23,931 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:21:23,932 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:23,932 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-07-07 09:21:23,932 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:23,932 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:23,933 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:24,044 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:24,045 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:24,045 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-07-07 09:21:24,045 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-07-07 09:21:24,045 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-07-07 09:21:24,045 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:21:24,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:24,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:24,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:21:24,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:21:24,047 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:21:24,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:24,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-07-07 09:21:24,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:24,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:24,048 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:24,128 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:24,128 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:24,129 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-07-07 09:21:24,129 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-07-07 09:21:24,129 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-07-07 09:21:24,130 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:21:24,130 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:24,130 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:24,131 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:21:24,131 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:21:24,131 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:21:24,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:24,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-07-07 09:21:24,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:24,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:24,133 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:24,181 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:24,181 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:24,181 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-07-07 09:21:24,181 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-07-07 09:21:24,182 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-07-07 09:21:24,182 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:21:24,182 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:24,182 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:24,182 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:21:24,182 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:21:24,182 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:21:24,184 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:24,184 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-07-07 09:21:24,184 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:24,184 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:24,184 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:24,320 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:24,320 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:24,320 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-07-07 09:21:24,320 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-07-07 09:21:24,320 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-07-07 09:21:24,321 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:21:24,321 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:24,321 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:24,321 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:21:24,322 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:21:24,322 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:21:24,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:24,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-07-07 09:21:24,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:24,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:24,323 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:24,384 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:24,385 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:24,385 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 is the best fit.  While elements of Type 2 are present (simple graphic, circular border), the image's grayscale nature, grid-like central shape, surrounding dots, and somewhat blurred background all strongly suggest Type 3 as the most accurate classification.\n", Incomplete)., raw_output=Type 3 is the best fit.  While elements of Type 2 are present (simple graphic, circular border), the image's grayscale nature, grid-like central shape, surrounding dots, and somewhat blurred background all strongly suggest Type 3 as the most accurate classification.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:21:24,386 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:21:24,386 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:21:24,386 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-07-07 09:21:24,386 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-07-07 09:21:24,386 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:21:24,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:24,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:24,387 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:21:24,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:21:24,387 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:21:24,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:24,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-07-07 09:21:24,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:24,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:24,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:26,854 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:21:26,854 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:21:27,373 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:27,374 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:27,374 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:21:27,377 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:21:27,377 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:21:27,378 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-07-07 09:21:27,378 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-07-07 09:21:27,378 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:21:27,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:27,379 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:27,381 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:21:27,382 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:21:27,382 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:21:27,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:27,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-07-07 09:21:27,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:27,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:27,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:27,519 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,521 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,521 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'FDT'
2025-07-07 09:21:27,521 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-07-07 09:21:27,521 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-07-07 09:21:27,521 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:21:27,521 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:21:27,522 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:21:27,522 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:21:27,523 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:21:27,523 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:21:27,524 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:21:27,524 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-07-07 09:21:27,524 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:21:27,524 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:21:27,526 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:21:27,775 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,775 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,775 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,775 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:27,776 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-07-07 09:21:27,777 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-07-07 09:21:27,841 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:28,875 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:28,879 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:28,883 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:28,885 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:28,888 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:28,922 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:28,929 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:28,939 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:28,947 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:28,971 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:28,990 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:28,993 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:29,010 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:29,018 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:29,032 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:29,414 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,417 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,424 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,423 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,423 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,424 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,429 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,432 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,433 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,436 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,454 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,454 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,458 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,476 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,478 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:29,489 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:29,906 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:30,056 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:30,112 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:31,968 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:41,664 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:41,671 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:38,807 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:41,685 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:47,831 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:47,835 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:47,837 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:47,860 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:21:47,905 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:47,947 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:47,951 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:48,118 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:48,175 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:48,177 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:48,177 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:48,197 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:21:48,205 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:48,225 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:48,228 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:49,039 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:51,133 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:51,136 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:51,138 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:51,151 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:21:51,155 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:51,198 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:51,198 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:51,352 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:53,321 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:53,322 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:53,324 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:53,339 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:53,342 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:53,607 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:53,610 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:53,648 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:53,649 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:53,670 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:53,698 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:21:53,702 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:54,860 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:54,874 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:54,878 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:55,227 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:55,229 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:55,251 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:55,252 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:55,263 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:55,263 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:55,272 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:55,280 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:21:55,313 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:21:55,342 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:21:55,345 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:21:55,387 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:55,404 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:55,410 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:55,594 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:21:57,290 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:57,328 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:57,329 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:21:58,027 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:21:58,028 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:21:58,029 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:22:00,285 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:22:00,289 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:22:00,289 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:22:04,159 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:22:04,159 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:22:04,159 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:22:04,196 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:22:04,197 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:22:04,198 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:22:04,466 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 09:22:04,467 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 09:22:04,467 - pynetdicom.association - INFO - Releasing Association
2025-07-07 09:22:04,480 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-07-07 09:22:04,481 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-07-07 09:22:04,481 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 09:22:04,487 - __main__ - INFO - Aplicación finalizada.
2025-07-07 09:30:46,264 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-07-07 09:30:51,078 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-07-07 09:30:51,476 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-07-07 09:30:51,580 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-07-07 09:30:51,581 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-07-07 09:30:51,583 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 09:30:51,584 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-07-07 09:30:51,642 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-07-07 09:30:51,643 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-07-07 09:30:51,644 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-07-07 09:30:51,644 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-07-07 09:30:51,645 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:30:51,685 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:30:52,330 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-07-07 09:30:52,330 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:30:52,330 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-07-07 09:30:53,361 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:30:53,364 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:30:53,364 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-07-07 09:30:53,397 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:30:53,422 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:30:54,017 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-07-07 09:30:54,017 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:30:54,017 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-07-07 09:30:55,520 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:30:55,522 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:30:55,522 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-07-07 09:30:55,589 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:30:55,669 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:30:56,466 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-07-07 09:30:56,468 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:30:56,469 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-07-07 09:31:00,591 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:00,591 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-07-07 09:31:00,591 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:31:00,592 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:00,650 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:01,766 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-07-07 09:31:01,767 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:31:01,767 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-07-07 09:31:03,606 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:03,607 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-07-07 09:31:03,607 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:31:03,607 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:03,811 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:04,391 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-07-07 09:31:04,391 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:31:04,391 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-07-07 09:31:07,280 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:31:07,281 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:31:07,429 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 09:31:07,429 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 09:31:09,233 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:09,234 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-07-07 09:31:09,234 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:31:09,234 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:09,264 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:10,770 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-07-07 09:31:10,771 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:31:10,772 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-07-07 09:31:11,848 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:11,848 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-07-07 09:31:11,848 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:31:11,849 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:11,926 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:12,468 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-07-07 09:31:12,469 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:31:12,469 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-07-07 09:31:13,670 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:13,670 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-07-07 09:31:13,670 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:31:13,670 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:13,793 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:14,407 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-07-07 09:31:14,407 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:31:14,408 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-07-07 09:31:16,662 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 09:31:16,665 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 09:31:18,347 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:18,347 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-07-07 09:31:18,348 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:31:18,348 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:18,441 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:18,748 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 09:31:18,748 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 09:31:19,048 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-07-07 09:31:19,048 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:31:19,048 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-07-07 09:31:20,358 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:20,358 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-07-07 09:31:20,358 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:31:20,358 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:20,412 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:20,929 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-07-07 09:31:20,929 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:31:20,936 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-07-07 09:31:23,285 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:31:23,286 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:31:23,541 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:23,542 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-07-07 09:31:23,542 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:23,542 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:31:23,591 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:24,193 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-07-07 09:31:24,194 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:31:24,194 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-07-07 09:31:25,402 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:31:25,403 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:31:26,374 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:31:26,374 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:31:26,787 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:26,788 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-07-07 09:31:26,788 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:26,789 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:31:26,828 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:27,495 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-07-07 09:31:27,495 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:31:27,496 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-07-07 09:31:28,545 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:28,545 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-07-07 09:31:28,545 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:31:28,546 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:28,582 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:29,157 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-07-07 09:31:29,157 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:31:29,157 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-07-07 09:31:29,899 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 09:31:29,899 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 09:31:30,637 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:30,640 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-07-07 09:31:30,641 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:30,641 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:31:30,836 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 09:31:31,431 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-07-07 09:31:31,431 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:31:31,431 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-07-07 09:31:32,054 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 09:31:32,054 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 09:31:33,008 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 09:31:33,011 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:31:33,012 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 09:31:33,033 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:31:33,037 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:31:33,037 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-07-07 09:31:33,037 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-07-07 09:31:33,038 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:31:33,038 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:33,040 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:33,040 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:31:33,040 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:31:33,040 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 09:31:33,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:33,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-07-07 09:31:33,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:33,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:33,103 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:33,331 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:33,332 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:33,337 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 best describes the image.  While elements of Type 2 are present (simple graphic, circular border), the presence of the grid-like shape, surrounding dots, and blurred background make Type 3 the most accurate overall classification. Type 1 is incorrect because the image doesn't have a \"soft, gradient-like quality\".\n", Incomplete)., raw_output=Type 3 best describes the image.  While elements of Type 2 are present (simple graphic, circular border), the presence of the grid-like shape, surrounding dots, and blurred background make Type 3 the most accurate overall classification. Type 1 is incorrect because the image doesn't have a "soft, gradient-like quality".
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:31:33,338 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:31:33,338 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:31:33,338 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-07-07 09:31:33,338 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-07-07 09:31:33,338 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:31:33,338 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:33,339 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:33,339 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:31:33,339 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:31:33,339 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 09:31:33,340 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:33,340 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-07-07 09:31:33,340 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:33,340 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:33,340 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:33,406 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:33,406 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:33,406 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-07-07 09:31:33,406 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-07-07 09:31:33,408 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-07-07 09:31:33,408 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:31:33,408 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:33,408 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:33,409 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:31:33,409 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:31:33,411 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 09:31:33,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:33,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-07-07 09:31:33,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:33,412 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:33,413 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:33,463 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:33,463 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:33,464 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-07-07 09:31:33,464 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-07-07 09:31:33,464 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-07-07 09:31:33,464 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:31:33,464 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:33,465 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:33,465 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 09:31:33,465 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 09:31:33,465 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 09:31:33,466 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:33,467 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-07-07 09:31:33,467 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:33,467 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:33,467 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:34,146 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:34,147 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:34,147 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2\n", Incomplete)., raw_output=Type 2
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 09:31:34,148 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 09:31:34,148 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 09:31:34,148 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-07-07 09:31:34,148 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-07-07 09:31:34,148 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:31:34,149 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:34,149 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:34,149 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 09:31:34,149 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 09:31:34,149 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 09:31:34,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:34,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-07-07 09:31:34,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:34,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:34,152 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:34,240 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:31:34,240 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:31:34,763 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:31:34,763 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:31:34,763 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-07-07 09:31:34,763 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-07-07 09:31:34,764 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-07-07 09:31:34,764 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:31:34,764 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:34,764 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:34,765 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 09:31:34,765 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 09:31:34,765 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 09:31:34,766 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:34,766 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-07-07 09:31:34,766 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:34,767 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:34,767 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:35,481 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:35,481 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:35,481 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-07-07 09:31:35,481 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-07-07 09:31:35,481 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-07-07 09:31:35,481 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:31:35,482 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:35,482 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:35,482 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 09:31:35,482 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 09:31:35,482 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 09:31:35,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:35,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-07-07 09:31:35,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:35,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:35,484 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:36,123 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:36,123 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:36,123 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-07-07 09:31:36,123 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-07-07 09:31:36,124 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-07-07 09:31:36,124 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:31:36,124 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:36,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:36,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:31:36,125 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:31:36,125 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 09:31:36,128 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:36,131 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-07-07 09:31:36,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:36,132 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:36,133 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:37,098 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:37,098 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:37,098 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-07-07 09:31:37,099 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-07-07 09:31:37,099 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-07-07 09:31:37,099 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:31:37,099 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:37,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:37,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:31:37,100 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:31:37,100 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 09:31:37,101 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:37,101 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-07-07 09:31:37,101 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:37,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:37,102 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:37,440 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:37,441 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:37,441 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-07-07 09:31:37,441 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-07-07 09:31:37,441 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-07-07 09:31:37,441 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:31:37,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:37,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:37,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:31:37,442 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:31:37,442 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 09:31:37,443 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:37,443 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-07-07 09:31:37,444 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:37,444 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:37,444 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:37,699 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 09:31:37,699 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 09:31:38,236 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:38,236 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:38,236 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-07-07 09:31:38,236 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-07-07 09:31:38,237 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-07-07 09:31:38,237 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:31:38,237 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:38,237 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:38,237 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 09:31:38,237 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 09:31:38,237 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 09:31:38,238 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:38,238 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-07-07 09:31:38,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:38,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:38,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:38,507 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:38,508 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:38,508 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-07-07 09:31:38,508 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-07-07 09:31:38,508 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-07-07 09:31:38,509 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:31:38,509 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:38,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:38,510 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 09:31:38,511 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 09:31:38,511 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 09:31:38,516 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:38,516 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-07-07 09:31:38,516 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:38,516 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:38,517 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:39,210 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:39,210 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:39,211 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'FDT'
2025-07-07 09:31:39,211 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-07-07 09:31:39,211 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-07-07 09:31:39,211 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:31:39,212 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:39,212 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:39,212 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:31:39,212 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:31:39,213 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 09:31:39,214 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:39,214 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-07-07 09:31:39,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:39,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:39,215 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:39,607 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,607 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,607 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'FDT'
2025-07-07 09:31:39,608 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-07-07 09:31:39,608 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-07-07 09:31:39,608 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:31:39,608 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 09:31:39,608 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 09:31:39,609 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 09:31:39,609 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 09:31:39,609 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 09:31:39,610 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 09:31:39,610 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-07-07 09:31:39,610 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 09:31:39,611 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 09:31:39,611 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 09:31:39,755 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,756 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,756 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,756 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:39,756 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,757 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:39,758 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:39,758 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:39,758 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,758 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,758 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-07-07 09:31:39,759 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-07-07 09:31:39,801 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,841 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,844 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:39,848 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,864 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:31:39,875 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,887 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:31:39,891 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,897 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,905 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,924 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,930 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,941 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:31:39,954 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:39,970 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 09:31:39,977 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:31:40,013 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,016 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,020 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,034 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,036 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,037 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,037 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,037 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,038 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,049 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,041 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 09:31:40,039 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,056 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,062 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,067 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,073 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 09:31:40,444 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:41,293 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:41,531 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:41,544 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:41,652 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:41,809 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:42,290 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:31:56,808 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 09:33:52,374 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,508 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,508 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,391 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,522 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,524 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,524 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,530 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,524 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,530 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,535 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,547 - pynetdicom.association - ERROR - DIMSE timeout reached while waiting for message response
2025-07-07 09:33:52,552 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,585 - pynetdicom.association - ERROR - Network timeout reached
2025-07-07 09:33:52,591 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:52,701 - pacs_operations - ERROR - No se recibió dataset de estado de C-STORE para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm.
2025-07-07 09:33:52,722 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:52,804 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:52,805 - pacs_operations - ERROR - No se recibió dataset de estado de C-STORE para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm.
2025-07-07 09:33:52,824 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:52,830 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:52,837 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:53,036 - pynetdicom.association - INFO - Aborting Association
2025-07-07 09:33:54,430 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 09:33:54,273 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 09:33:57,037 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:33:57,085 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:34:01,462 - pacs_operations - ERROR - No se recibió dataset de estado de C-STORE para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm.
2025-07-07 09:34:01,467 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 09:34:01,836 - pacs_operations - ERROR - No se recibió dataset de estado de C-STORE para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm.
2025-07-07 09:34:01,836 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 09:34:01,882 - pynetdicom.association - INFO - Requesting Association
2025-07-07 09:34:01,947 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:49:38,720 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-07-07 10:49:51,205 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-07-07 10:49:52,244 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-07-07 10:49:52,619 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-07-07 10:49:52,620 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-07-07 10:49:52,621 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 10:49:52,621 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-07-07 10:49:52,671 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-07-07 10:49:52,672 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-07-07 10:49:52,681 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-07-07 10:49:52,681 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-07-07 10:49:52,681 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 10:49:52,786 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:49:55,816 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-07-07 10:49:55,817 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 10:49:55,817 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-07-07 10:50:03,656 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:03,658 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:03,658 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-07-07 10:50:03,745 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 10:50:03,902 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:05,649 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-07-07 10:50:05,650 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 10:50:05,650 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-07-07 10:50:11,260 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 10:50:11,260 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 10:50:12,469 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:12,469 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-07-07 10:50:12,469 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 10:50:12,469 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:12,500 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:13,043 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-07-07 10:50:13,044 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 10:50:13,044 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-07-07 10:50:16,858 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:16,859 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:16,859 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-07-07 10:50:16,938 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 10:50:16,965 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:18,231 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-07-07 10:50:18,232 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 10:50:18,232 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-07-07 10:50:18,680 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 10:50:18,680 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 10:50:21,703 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 10:50:21,703 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 10:50:22,924 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:22,925 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-07-07 10:50:22,925 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:22,925 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 10:50:23,026 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:23,644 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-07-07 10:50:23,645 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 10:50:23,645 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-07-07 10:50:26,627 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 10:50:26,627 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 10:50:27,030 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:27,031 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-07-07 10:50:27,031 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 10:50:27,031 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:27,074 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:27,702 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-07-07 10:50:27,703 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 10:50:27,703 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-07-07 10:50:29,287 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:29,288 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-07-07 10:50:29,288 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 10:50:29,288 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:29,322 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:30,254 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-07-07 10:50:30,255 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 10:50:30,256 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-07-07 10:50:30,375 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 10:50:30,375 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 10:50:31,816 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:31,817 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-07-07 10:50:31,817 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:31,817 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 10:50:31,854 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:32,439 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-07-07 10:50:32,440 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 10:50:32,440 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-07-07 10:50:33,317 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 10:50:33,317 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 10:50:35,488 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 10:50:35,489 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 10:50:36,387 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:36,388 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-07-07 10:50:36,388 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:36,388 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 10:50:36,478 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:37,037 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-07-07 10:50:37,037 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 10:50:37,037 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-07-07 10:50:38,120 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:38,121 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-07-07 10:50:38,121 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 10:50:38,121 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:38,150 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:38,717 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-07-07 10:50:38,717 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 10:50:38,717 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-07-07 10:50:39,695 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 10:50:39,696 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 10:50:42,243 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:42,244 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-07-07 10:50:42,245 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:42,245 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 10:50:42,302 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:42,968 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-07-07 10:50:42,969 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 10:50:42,969 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-07-07 10:50:45,220 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 10:50:45,220 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 10:50:45,510 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:45,511 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-07-07 10:50:45,511 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:45,511 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 10:50:45,548 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:46,072 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-07-07 10:50:46,073 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 10:50:46,073 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-07-07 10:50:47,353 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:47,354 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-07-07 10:50:47,354 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:47,354 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 10:50:47,386 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:47,914 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-07-07 10:50:47,914 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 10:50:47,915 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-07-07 10:50:48,124 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 10:50:48,124 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 10:50:50,990 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 10:50:50,991 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 10:50:52,895 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:52,895 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-07-07 10:50:52,895 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:52,896 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 10:50:56,451 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 10:50:57,066 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-07-07 10:50:57,066 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 10:50:57,067 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-07-07 10:50:58,902 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 10:50:58,906 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 10:50:58,907 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-07-07 10:50:58,913 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-07-07 10:50:58,913 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-07-07 10:50:58,915 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 10:50:58,916 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:50:58,935 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:50:58,936 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 10:50:58,936 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 10:50:58,936 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 10:50:58,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:50:58,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-07-07 10:50:58,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:50:58,979 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:50:58,980 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:50:59,059 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:50:59,060 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:50:59,060 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-07-07 10:50:59,060 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-07-07 10:50:59,060 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-07-07 10:50:59,060 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 10:50:59,060 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:50:59,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:50:59,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 10:50:59,061 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 10:50:59,061 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 10:50:59,062 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:50:59,062 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-07-07 10:50:59,062 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:50:59,063 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:50:59,063 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:50:59,137 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:50:59,138 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:50:59,138 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'FDT'
2025-07-07 10:50:59,138 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-07-07 10:50:59,138 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-07-07 10:50:59,139 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 10:50:59,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:50:59,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:50:59,139 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 10:50:59,140 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 10:50:59,140 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 10:50:59,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:50:59,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-07-07 10:50:59,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:50:59,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:50:59,141 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:50:59,248 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:50:59,248 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:50:59,248 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'TOR'
2025-07-07 10:50:59,248 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-07-07 10:50:59,248 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-07-07 10:50:59,248 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 10:50:59,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:50:59,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:50:59,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 10:50:59,249 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 10:50:59,249 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 10:50:59,250 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:50:59,250 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-07-07 10:50:59,251 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:50:59,251 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:50:59,251 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:00,039 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:00,040 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:00,040 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'MTF'
2025-07-07 10:51:00,041 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-07-07 10:51:00,041 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-07-07 10:51:00,041 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 10:51:00,042 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:00,042 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:00,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 10:51:00,043 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 10:51:00,044 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 10:51:00,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:00,045 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-07-07 10:51:00,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:00,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:00,046 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:00,555 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 10:51:00,555 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 10:51:00,556 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-07-07 10:51:00,556 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-07-07 10:51:00,556 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-07-07 10:51:00,556 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 10:51:00,556 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:00,556 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:00,557 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 10:51:00,557 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 10:51:00,557 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 10:51:00,558 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:00,558 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-07-07 10:51:00,558 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:00,559 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:00,559 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:01,025 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:01,025 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:01,025 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-07-07 10:51:01,025 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-07-07 10:51:01,026 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-07-07 10:51:01,026 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 10:51:01,026 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:01,026 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:01,026 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 10:51:01,027 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 10:51:01,027 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 10:51:01,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:01,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-07-07 10:51:01,028 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:01,029 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:01,029 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:01,239 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:01,239 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:01,239 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-07-07 10:51:01,239 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-07-07 10:51:01,239 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-07-07 10:51:01,239 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 10:51:01,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:01,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:01,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 10:51:01,240 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 10:51:01,240 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 10:51:01,241 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:01,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-07-07 10:51:01,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:01,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:01,242 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:01,404 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:01,405 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:01,405 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 10:51:01,450 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 10:51:01,451 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 10:51:01,451 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-07-07 10:51:01,451 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-07-07 10:51:01,451 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 10:51:01,451 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:01,452 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:01,452 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 10:51:01,452 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 10:51:01,452 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 10:51:01,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:01,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-07-07 10:51:01,453 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:01,454 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:01,454 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:01,589 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:01,590 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:01,595 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-07-07 10:51:01,595 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-07-07 10:51:01,595 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-07-07 10:51:01,596 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 10:51:01,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:01,596 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:01,597 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 10:51:01,597 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 10:51:01,597 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 10:51:01,598 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:01,599 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-07-07 10:51:01,599 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:01,599 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:01,599 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:01,766 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:01,766 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:01,766 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'MTF'
2025-07-07 10:51:01,767 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-07-07 10:51:01,767 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-07-07 10:51:01,767 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 10:51:01,767 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:01,767 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:01,768 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 10:51:01,768 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 10:51:01,768 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 10:51:01,770 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:01,770 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-07-07 10:51:01,770 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:01,771 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:01,771 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:01,886 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:01,886 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:01,887 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'TOR'
2025-07-07 10:51:01,887 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-07-07 10:51:01,887 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-07-07 10:51:01,887 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 10:51:01,887 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:01,888 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:01,888 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 10:51:01,888 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 10:51:01,888 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 10:51:01,889 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:01,889 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-07-07 10:51:01,889 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:01,889 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:01,890 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:02,151 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:02,152 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:02,152 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 10:51:02,153 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 10:51:02,154 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 10:51:02,154 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-07-07 10:51:02,154 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-07-07 10:51:02,154 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 10:51:02,154 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:02,154 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:02,155 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 10:51:02,155 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 10:51:02,155 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 10:51:02,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:02,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-07-07 10:51:02,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:02,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:02,156 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:02,356 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,357 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,357 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 10:51:02,358 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 10:51:02,358 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 10:51:02,358 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-07-07 10:51:02,358 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-07-07 10:51:02,360 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 10:51:02,361 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 10:51:02,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 10:51:02,362 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 10:51:02,362 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 10:51:02,362 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 10:51:02,364 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 10:51:02,364 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-07-07 10:51:02,365 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 10:51:02,365 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 10:51:02,365 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 10:51:02,505 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,505 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,505 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,505 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:02,505 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,506 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:02,506 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 10:51:02,507 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:02,507 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:02,507 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:02,507 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,508 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:02,508 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:02,508 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:02,508 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,508 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,508 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-07-07 10:51:02,509 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-07-07 10:51:02,662 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,702 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:02,718 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:02,735 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:02,740 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:02,749 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:02,806 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:02,815 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:02,842 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,867 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:02,899 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,915 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:02,933 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:02,958 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:02,971 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:03,003 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:04,422 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,430 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,431 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,432 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,435 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,447 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,440 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,449 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,446 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,437 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,448 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:04,440 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,460 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,477 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,482 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:04,483 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:05,094 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:07,201 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:10,963 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:10,966 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:10,967 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:10,984 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:13,239 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:14,396 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:25,249 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:25,258 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:25,260 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:25,283 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 10:51:25,306 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:25,329 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:25,331 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:25,425 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:26,231 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:26,232 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:26,234 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:26,247 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 10:51:26,254 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:26,261 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:26,263 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:26,365 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:26,564 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:26,565 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:26,566 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:26,579 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 10:51:26,582 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:26,588 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:26,589 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:26,681 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:27,919 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:27,920 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:27,922 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:27,924 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:27,926 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:27,927 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:27,928 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:27,942 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:27,969 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:27,972 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:27,977 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:27,978 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:27,979 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 10:51:27,989 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:27,992 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 10:51:28,009 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:28,024 - pynetdicom.association - INFO - Requesting Association
2025-07-07 10:51:28,042 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:28,073 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:28,078 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 10:51:28,079 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 10:51:28,541 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:28,727 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:28,729 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:28,752 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:28,897 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:28,947 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 10:51:28,982 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:29,006 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:29,009 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:33,806 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:33,807 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:33,809 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:34,630 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:34,634 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:34,634 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:35,024 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:35,026 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:35,028 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:37,624 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:37,641 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:37,642 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:37,678 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:37,688 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:37,689 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:37,842 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 10:51:37,845 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 10:51:37,846 - pynetdicom.association - INFO - Releasing Association
2025-07-07 10:51:37,858 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-07-07 10:51:37,858 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-07-07 10:51:37,858 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 10:51:37,912 - __main__ - INFO - Aplicación finalizada.
2025-07-07 11:16:29,890 - root - INFO - Logging configurado. Nivel: INFO. Archivo de log: /home/aotal/github/pacs/dicom_workflow.log
2025-07-07 11:16:33,663 - baml_classification - INFO - Variables de entorno (.env) cargadas para BAML.
2025-07-07 11:16:34,040 - baml_classification - INFO - Variables de entorno BAML reseteadas/aplicadas al cliente.
2025-07-07 11:16:34,191 - pacs_operations - WARNING - No se pudo importar StoragePresentationContexts. Los contextos de almacenamiento se añadirán explícitamente.
2025-07-07 11:16:34,191 - __main__ - INFO - Iniciando aplicación desde: main.py
2025-07-07 11:16:34,221 - __main__ - INFO - ===== INICIO DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 11:16:34,222 - __main__ - INFO - Cargando datos de calibración para LUT Kerma desde: /home/aotal/github/pacs/data/linearizacion.csv
2025-07-07 11:16:34,484 - dicom_processing_pipeline - INFO - Datos de calibración para LUT Kerma cargados desde /home/aotal/github/pacs/data/linearizacion.csv: 6 puntos.
2025-07-07 11:16:34,484 - __main__ - INFO - Cálculo y almacenamiento de parámetros de linealización física está DESACTIVADO.
2025-07-07 11:16:34,487 - __main__ - INFO - Se encontraron 14 ficheros para procesar en /home/aotal/github/pacs/input_dicom_files.
2025-07-07 11:16:34,487 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 ---
2025-07-07 11:16:34,487 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 11:16:34,513 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:16:35,441 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 descomprimido exitosamente.
2025-07-07 11:16:35,442 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 11:16:35,444 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 para clasificación BAML...
2025-07-07 11:16:37,250 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:16:37,254 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:16:37,254 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 ---
2025-07-07 11:16:37,581 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 11:16:37,691 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:16:39,284 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 descomprimido exitosamente.
2025-07-07 11:16:39,295 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 11:16:39,296 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 para clasificación BAML...
2025-07-07 11:16:45,435 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 11:16:45,435 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 11:16:46,443 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:16:46,444 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 ---
2025-07-07 11:16:46,445 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:16:46,445 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 11:16:46,552 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:16:47,347 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 descomprimido exitosamente.
2025-07-07 11:16:47,348 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 11:16:47,348 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 para clasificación BAML...
2025-07-07 11:16:49,379 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:16:49,380 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:16:49,381 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 ---
2025-07-07 11:16:49,409 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 11:16:50,398 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:16:50,883 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 11:16:50,884 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 11:16:51,477 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 descomprimido exitosamente.
2025-07-07 11:16:51,477 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 11:16:51,478 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 para clasificación BAML...
2025-07-07 11:16:55,169 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:16:55,170 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 ---
2025-07-07 11:16:55,170 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 11:16:55,171 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:16:55,199 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:16:55,789 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 descomprimido exitosamente.
2025-07-07 11:16:55,789 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 11:16:55,789 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 para clasificación BAML...
2025-07-07 11:16:58,222 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:16:58,222 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 ---
2025-07-07 11:16:58,223 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:16:58,223 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 11:16:58,264 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:16:58,781 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 descomprimido exitosamente.
2025-07-07 11:16:58,781 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 11:16:58,781 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 para clasificación BAML...
2025-07-07 11:17:01,128 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:01,129 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 ---
2025-07-07 11:17:01,130 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:01,130 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 11:17:01,161 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:01,699 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 descomprimido exitosamente.
2025-07-07 11:17:01,700 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 11:17:01,700 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 para clasificación BAML...
2025-07-07 11:17:03,277 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:03,277 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 ---
2025-07-07 11:17:03,279 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:03,280 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 11:17:03,305 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:03,846 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 descomprimido exitosamente.
2025-07-07 11:17:03,847 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 11:17:03,847 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 para clasificación BAML...
2025-07-07 11:17:06,657 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 11:17:06,658 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 11:17:08,063 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type3
2025-07-07 11:17:08,064 - baml_classification - INFO - Clasificación BAML original: 'Type3', Mapeada a: 'TOR'
2025-07-07 11:17:09,547 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:09,547 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 ---
2025-07-07 11:17:09,547 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:09,548 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 11:17:09,583 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:10,069 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 descomprimido exitosamente.
2025-07-07 11:17:10,070 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 11:17:10,070 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 para clasificación BAML...
2025-07-07 11:17:12,078 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:12,078 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 ---
2025-07-07 11:17:12,078 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 11:17:12,079 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:12,110 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:12,763 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 descomprimido exitosamente.
2025-07-07 11:17:12,763 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 11:17:12,763 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 para clasificación BAML...
2025-07-07 11:17:13,276 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 11:17:13,276 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 11:17:16,305 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type1
2025-07-07 11:17:16,305 - baml_classification - INFO - Clasificación BAML original: 'Type1', Mapeada a: 'FDT'
2025-07-07 11:17:18,788 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:18,815 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:18,818 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 ---
2025-07-07 11:17:18,818 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 11:17:18,894 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:19,578 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 descomprimido exitosamente.
2025-07-07 11:17:19,579 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 11:17:19,579 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 para clasificación BAML...
2025-07-07 11:17:19,697 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"40s"}]}}, status_code=429).
2025-07-07 11:17:21,698 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:22,158 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:22,158 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 ---
2025-07-07 11:17:22,158 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:22,159 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 11:17:22,190 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:22,746 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"37s"}]}}, status_code=429).
2025-07-07 11:17:22,749 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 descomprimido exitosamente.
2025-07-07 11:17:22,749 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 11:17:22,750 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 para clasificación BAML...
2025-07-07 11:17:23,031 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"37s"}]}}, status_code=429).
2025-07-07 11:17:25,032 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:25,745 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:25,746 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:25,760 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 ---
2025-07-07 11:17:25,768 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 11:17:25,798 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:26,033 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"34s"}]}}, status_code=429).
2025-07-07 11:17:26,529 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 descomprimido exitosamente.
2025-07-07 11:17:26,530 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 11:17:26,530 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 para clasificación BAML...
2025-07-07 11:17:26,746 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:26,874 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"33s"}]}}, status_code=429).
2025-07-07 11:17:28,541 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:28,542 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:28,542 - __main__ - INFO - --- Iniciando procesamiento para: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 ---
2025-07-07 11:17:28,558 - dicom_processing_pipeline - INFO - Leyendo y (si es necesario) descomprimiendo: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 11:17:28,592 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 está comprimido (JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])). Descomprimiendo...
2025-07-07 11:17:29,977 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:29,978 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"30s"}]}}, status_code=429).
2025-07-07 11:17:30,119 - baml_classification - INFO - Clasificación BAML recibida (desde .value): Type2
2025-07-07 11:17:30,119 - baml_classification - INFO - Clasificación BAML original: 'Type2', Mapeada a: 'MTF'
2025-07-07 11:17:30,172 - dicom_processing_pipeline - INFO - Archivo 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 descomprimido exitosamente.
2025-07-07 11:17:30,173 - dicom_processing_pipeline - INFO - Archivo DICOM leído y pixel_array (para BAML) obtenido de: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 11:17:30,173 - __main__ - INFO - Enviando imagen 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 para clasificación BAML...
2025-07-07 11:17:30,510 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:31,996 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:32,296 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"27s"}]}}, status_code=429).
2025-07-07 11:17:32,970 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"27s"}]}}, status_code=429).
2025-07-07 11:17:33,788 - baml_classification - INFO - Pixel array convertido a PNG base64 exitosamente.
2025-07-07 11:17:33,795 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:33,799 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1: 'FDT'
2025-07-07 11:17:33,814 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 (desactivada o datos insuficientes).
2025-07-07 11:17:33,814 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1...
2025-07-07 11:17:33,819 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 11:17:33,828 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:33,848 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:33,849 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 11:17:33,852 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 11:17:33,855 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1
2025-07-07 11:17:33,909 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:33,909 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] LUT Kerma aplicada.
2025-07-07 11:17:33,909 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:33,912 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:33,913 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:34,252 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:34,252 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 procesado y guardado como: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:34,253 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1: 'TOR'
2025-07-07 11:17:34,253 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 (desactivada o datos insuficientes).
2025-07-07 11:17:34,253 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1...
2025-07-07 11:17:34,253 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 11:17:34,253 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:34,254 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:34,254 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 11:17:34,254 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 11:17:34,254 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1
2025-07-07 11:17:34,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:34,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] LUT Kerma aplicada.
2025-07-07 11:17:34,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:34,255 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:34,256 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:34,738 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"25s"}]}}, status_code=429).
2025-07-07 11:17:34,807 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:34,807 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 procesado y guardado como: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:34,811 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 1", Incomplete)., raw_output=Type 1, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 11:17:35,075 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:35,075 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:35,076 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 (desactivada o datos insuficientes).
2025-07-07 11:17:35,076 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1...
2025-07-07 11:17:35,077 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 11:17:35,078 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:35,078 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:35,079 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:35,079 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:35,080 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1
2025-07-07 11:17:35,082 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:35,083 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] LUT Kerma aplicada.
2025-07-07 11:17:35,083 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:35,084 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:35,084 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:35,203 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:35,204 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 procesado y guardado como: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:35,204 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 3 is the best fit.  While elements of Type 1 and Type 2 are present, Type 3 most accurately describes the overall composition: a circular design, a grid-like element in the center, surrounding dots, and a blurred (or plain) background.\n", Incomplete)., raw_output=Type 3 is the best fit.  While elements of Type 1 and Type 2 are present, Type 3 most accurately describes the overall composition: a circular design, a grid-like element in the center, surrounding dots, and a blurred (or plain) background.
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 11:17:35,205 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:35,205 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:35,205 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 (desactivada o datos insuficientes).
2025-07-07 11:17:35,205 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1...
2025-07-07 11:17:35,206 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 11:17:35,206 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:35,206 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:35,206 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:35,206 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:35,207 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1
2025-07-07 11:17:35,208 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:35,208 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] LUT Kerma aplicada.
2025-07-07 11:17:35,208 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:35,208 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:35,208 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:35,326 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 2.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"24s"}]}}, status_code=429).
2025-07-07 11:17:36,579 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:36,698 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:36,699 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 procesado y guardado como: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:36,699 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlValidationError: BamlValidationError(message=Failed to parse LLM response: Failed to coerce value: <root>: Expected ImageClass enum value, got String("Type 2\n", Incomplete)., raw_output=Type 2
, prompt=[43muser: [0mClassify<image_placeholder base64>into just one of the following categories,  :
Type1: Monochromatic, low-contrast texture with shades of gray, soft, gradient-like quality.
Type2: Simple graphic design with a small black geometric shape, circular border, minimalist aesthetic.
Type3: Circular design in grayscale, grid-like shape at the center, surrounding dots, blurred background.
Image:<image_placeholder base64>
)
2025-07-07 11:17:36,700 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:36,700 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:36,700 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 (desactivada o datos insuficientes).
2025-07-07 11:17:36,701 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1...
2025-07-07 11:17:36,701 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 11:17:36,701 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:36,701 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:36,702 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:36,702 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:36,702 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1
2025-07-07 11:17:36,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:36,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] LUT Kerma aplicada.
2025-07-07 11:17:36,703 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:36,704 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:36,704 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:37,257 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 11:17:37,257 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 procesado y guardado como: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 11:17:37,258 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1: 'TOR'
2025-07-07 11:17:37,258 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 (desactivada o datos insuficientes).
2025-07-07 11:17:37,258 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1...
2025-07-07 11:17:37,258 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 11:17:37,259 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:37,259 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:37,259 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 11:17:37,260 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 11:17:37,260 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1
2025-07-07 11:17:37,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:37,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] LUT Kerma aplicada.
2025-07-07 11:17:37,261 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:37,262 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:37,263 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:37,345 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:38,424 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:38,425 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 procesado y guardado como: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:38,425 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1: 'TOR'
2025-07-07 11:17:38,425 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 (desactivada o datos insuficientes).
2025-07-07 11:17:38,425 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1...
2025-07-07 11:17:38,425 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 11:17:38,425 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:38,426 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:38,426 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'TOR'
2025-07-07 11:17:38,426 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] 'ImageComments' después de actualizar. Valor: 'TOR'
2025-07-07 11:17:38,426 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1
2025-07-07 11:17:38,427 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:38,427 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] LUT Kerma aplicada.
2025-07-07 11:17:38,427 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:38,427 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:38,428 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:38,747 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:38,908 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"21s"}]}}, status_code=429).
2025-07-07 11:17:39,168 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 4.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"20s"}]}}, status_code=429).
2025-07-07 11:17:39,385 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:39,386 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 procesado y guardado como: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:39,386 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1: 'MTF'
2025-07-07 11:17:39,386 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 (desactivada o datos insuficientes).
2025-07-07 11:17:39,386 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1...
2025-07-07 11:17:39,386 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 11:17:39,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:39,386 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:39,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 11:17:39,387 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 11:17:39,387 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1
2025-07-07 11:17:39,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:39,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] LUT Kerma aplicada.
2025-07-07 11:17:39,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:39,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:39,388 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:39,529 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:39,530 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 procesado y guardado como: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:39,530 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1: 'FDT'
2025-07-07 11:17:39,530 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 (desactivada o datos insuficientes).
2025-07-07 11:17:39,530 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1...
2025-07-07 11:17:39,531 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 11:17:39,531 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:39,532 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:39,532 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'FDT'
2025-07-07 11:17:39,532 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] 'ImageComments' después de actualizar. Valor: 'FDT'
2025-07-07 11:17:39,534 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1
2025-07-07 11:17:39,537 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:39,538 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] LUT Kerma aplicada.
2025-07-07 11:17:39,539 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:39,540 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:39,540 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:39,720 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:39,722 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 procesado y guardado como: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:39,722 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1: 'MTF'
2025-07-07 11:17:39,722 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 (desactivada o datos insuficientes).
2025-07-07 11:17:39,722 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1...
2025-07-07 11:17:39,723 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 11:17:39,723 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:39,723 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:39,723 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Estableciendo (sobrescribiendo) 'ImageComments' a: 'MTF'
2025-07-07 11:17:39,723 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] 'ImageComments' después de actualizar. Valor: 'MTF'
2025-07-07 11:17:39,724 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1
2025-07-07 11:17:39,726 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:39,726 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] LUT Kerma aplicada.
2025-07-07 11:17:39,726 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:39,726 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:39,731 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:40,056 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:40,056 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 procesado y guardado como: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:40,977 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:41,928 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"18s"}]}}, status_code=429).
2025-07-07 11:17:43,170 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:43,762 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"16s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x75982e6e8680 state=finished raised BamlClientHttpError>]
2025-07-07 11:17:43,841 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:43,841 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:43,841 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 (desactivada o datos insuficientes).
2025-07-07 11:17:43,841 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1...
2025-07-07 11:17:43,841 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 11:17:43,841 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:43,842 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:43,842 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:43,842 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:43,842 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1
2025-07-07 11:17:43,843 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:43,844 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] LUT Kerma aplicada.
2025-07-07 11:17:43,844 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:43,844 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:43,844 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:43,903 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:43,903 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 procesado y guardado como: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:44,626 - baml_classification - INFO - Retrying baml_classification._clasificar_con_baml_tenacity in 8.0 seconds as it raised BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"model":"gemini-1.5-flash","location":"global"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"15s"}]}}, status_code=429).
2025-07-07 11:17:46,909 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:48,265 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"11s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x75982e689310 state=finished raised BamlClientHttpError>]
2025-07-07 11:17:48,266 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:48,266 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:48,266 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 (desactivada o datos insuficientes).
2025-07-07 11:17:48,266 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1...
2025-07-07 11:17:48,266 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 11:17:48,266 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:48,266 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:48,267 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:48,267 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:48,267 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1
2025-07-07 11:17:48,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:48,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] LUT Kerma aplicada.
2025-07-07 11:17:48,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:48,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:48,268 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:48,316 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:48,317 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 procesado y guardado como: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:49,934 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:52,306 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"7s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x75982eff0740 state=finished raised BamlClientHttpError>]
2025-07-07 11:17:52,309 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:52,309 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:52,309 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 (desactivada o datos insuficientes).
2025-07-07 11:17:52,310 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1...
2025-07-07 11:17:52,310 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 11:17:52,311 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:52,313 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:52,314 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:52,314 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:52,314 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1
2025-07-07 11:17:52,316 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:52,316 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] LUT Kerma aplicada.
2025-07-07 11:17:52,317 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:52,318 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:52,318 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:52,434 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:52,434 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 procesado y guardado como: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:52,627 - baml_classification - INFO - Intentando clasificación BAML (con tenacity)...
2025-07-07 11:17:54,028 - baml_classification - ERROR - Error ejecutando clasificación BAML con tenacity en executor.
Traceback (most recent call last):
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_classification.py", line 124, in _clasificar_con_baml_tenacity
    result = b.ClassifyImage(img=baml_input_image) # Esta es la llamada que puede fallar
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/baml_client/sync_client.py", line 126, in ClassifyImage
    return cast(types.ImageClass, raw.cast_to(types, types, partial_types, False))
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
baml_py.internal_monkeypatch.BamlClientHttpError: BamlClientHttpError(client_name=Gemini, message=Request failed with status code: 429 Too Many Requests. {"error":{"code":429,"message":"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.","status":"RESOURCE_EXHAUSTED","details":[{"@type":"type.googleapis.com/google.rpc.QuotaFailure","violations":[{"quotaMetric":"generativelanguage.googleapis.com/generate_content_free_tier_requests","quotaId":"GenerateRequestsPerDayPerProjectPerModel-FreeTier","quotaDimensions":{"location":"global","model":"gemini-1.5-flash"},"quotaValue":"50"}]},{"@type":"type.googleapis.com/google.rpc.Help","links":[{"description":"Learn more about Gemini API quotas","url":"https://ai.google.dev/gemini-api/docs/rate-limits"}]},{"@type":"type.googleapis.com/google.rpc.RetryInfo","retryDelay":"6s"}]}}, status_code=429)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aotal/github/pacs/baml_classification.py", line 175, in obtener_clasificacion_baml
    clasificacion_final = await loop.run_in_executor(None, _clasificar_con_baml_tenacity, imagen_base64)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/anaconda3/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/aotal/github/pacs/.venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x75982e688da0 state=finished raised BamlClientHttpError>]
2025-07-07 11:17:54,029 - __main__ - INFO - Clasificación BAML (mapeada) para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1: 'ErrorBAMLExecutorGeneral'
2025-07-07 11:17:54,029 - __main__ - WARNING - Clasificación BAML para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 indicó problema o era inválida: 'ErrorBAMLExecutorGeneral'. Usando 'ClasificacionFallida'.
2025-07-07 11:17:54,029 - __main__ - INFO - Linealización física omitida para 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 (desactivada o datos insuficientes).
2025-07-07 11:17:54,029 - __main__ - INFO - Aplicando modificaciones finales y LUT Kerma a 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1...
2025-07-07 11:17:54,030 - dicom_processing_pipeline - INFO - Procesando dataset para PACS: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 11:17:54,030 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientID establecido/actualizado a: SN1938BX
2025-07-07 11:17:54,030 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PatientName establecido/actualizado a: ARDX134107_Paret
2025-07-07 11:17:54,030 - dicom_processing_pipeline - WARNING - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Clasificación BAML mapeada fue 'ClasificacionFallida' (error o placeholder). No se actualizará 'ImageComments'.
2025-07-07 11:17:54,031 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] No se escribió ningún valor de clasificación BAML en 'ImageComments'.
2025-07-07 11:17:54,031 - dicom_processing_pipeline - INFO - Aplicando Kerma LUT al dataset SOPInstanceUID: 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1
2025-07-07 11:17:54,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] PhotometricInterpretation es MONOCHROME1. Considera si MONOCHROME2 es más apropiado para Kerma (GSDF).
2025-07-07 11:17:54,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] LUT Kerma aplicada.
2025-07-07 11:17:54,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Forzando ImageType a un valor conocido y válido.
2025-07-07 11:17:54,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] ImageType (0008,0008) recreado con valor: ['DERIVED', 'PRIMARY', 'IMG_PROC_FINAL']
2025-07-07 11:17:54,032 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] SpecificCharacterSet no presente. Establecido a 'ISO_IR 192'.
2025-07-07 11:17:54,104 - dicom_processing_pipeline - INFO - [1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1] Archivo DICOM procesado y guardado como: /home/aotal/github/pacs/output_processed_dicom/Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,104 - __main__ - INFO - Fichero 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 procesado y guardado como: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,105 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241874.1 -> Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,105 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242484.1 -> Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:54,105 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241986.1 -> Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242369.1 -> Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242891.1 -> Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242276.1 -> Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242185.1 -> Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242696.1 -> Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241784.1 -> Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242600.1 -> Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242787.1 -> Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414242079.1 -> Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241600.1 -> Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - ÉXITO en procesamiento de 1.3.46.670589.30.41.0.1.128635482625724.1743414241688.1 -> Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,106 - __main__ - INFO - Se procesaron 14 ficheros con éxito. Iniciando envío a PACS...
2025-07-07 11:17:54,107 - pacs_operations - INFO - Iniciando envío de 14 archivos desde /home/aotal/github/pacs/output_processed_dicom al PACS (DCM4CHEE@localhost:11112).
2025-07-07 11:17:54,205 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,224 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,233 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:54,237 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,242 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:17:54,244 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,257 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:54,259 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,275 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,283 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,294 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,301 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,322 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:17:54,329 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,340 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:17:54,354 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:54,464 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,465 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,467 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,468 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,469 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,473 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,474 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,476 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:54,482 - pacs_operations - INFO - Asociación establecida con PACS para Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,483 - pacs_operations - INFO - Asociación establecida con PACS para Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,486 - pacs_operations - INFO - Asociación establecida con PACS para Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,507 - pacs_operations - INFO - Asociación establecida con PACS para Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,508 - pacs_operations - INFO - Asociación establecida con PACS para Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,508 - pacs_operations - INFO - Asociación establecida con PACS para Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,508 - pacs_operations - INFO - Asociación establecida con PACS para Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,510 - pacs_operations - INFO - Asociación establecida con PACS para Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:54,852 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:54,853 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:55,662 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:56,109 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:56,125 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:56,197 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:56,390 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:56,477 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:59,493 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:17:59,497 - pacs_operations - INFO - ÉXITO: Img33_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:17:59,499 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:17:59,524 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm
2025-07-07 11:17:59,536 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:59,565 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:59,567 - pacs_operations - INFO - Asociación establecida con PACS para Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:59,659 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:17:59,735 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:17:59,744 - pacs_operations - INFO - ÉXITO: Img29_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:17:59,777 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:17:59,783 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm
2025-07-07 11:17:59,805 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:17:59,818 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:17:59,819 - pacs_operations - INFO - Asociación establecida con PACS para Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:17:59,910 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:18:00,698 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:00,698 - pacs_operations - INFO - ÉXITO: Img26_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:00,700 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:00,714 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm
2025-07-07 11:18:00,716 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:18:00,726 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:18:00,728 - pacs_operations - INFO - Asociación establecida con PACS para Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:18:00,857 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:18:05,685 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:05,690 - pacs_operations - INFO - ÉXITO: Img28_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:05,692 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:05,707 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:18:05,711 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:18:05,730 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:18:05,732 - pacs_operations - INFO - Asociación establecida con PACS para Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:18:05,747 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:05,753 - pacs_operations - INFO - ÉXITO: Img25_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:05,754 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:05,777 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm
2025-07-07 11:18:05,780 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:18:05,810 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:18:05,812 - pacs_operations - INFO - Asociación establecida con PACS para Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:18:05,875 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:18:05,917 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:05,923 - pacs_operations - INFO - ÉXITO: Img35_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:05,924 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:05,941 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:05,947 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:18:05,963 - pacs_operations - INFO - Intentando asociar con PACS (DCM4CHEE@localhost:11112) para enviar: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm
2025-07-07 11:18:05,964 - pacs_operations - INFO - ÉXITO: Img31_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:06,003 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:06,007 - pynetdicom.association - INFO - Requesting Association
2025-07-07 11:18:06,032 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:06,041 - pacs_operations - INFO - ÉXITO: Img32_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:06,042 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:06,045 - pynetdicom.acse - INFO - Association Accepted
2025-07-07 11:18:06,048 - pacs_operations - INFO - Asociación establecida con PACS para Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm. Contextos de presentación aceptados: 7
2025-07-07 11:18:06,228 - pynetdicom._handlers - INFO - Sending Store Request: MsgID 1
2025-07-07 11:18:08,032 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:08,032 - pacs_operations - INFO - ÉXITO: Img30_SN1938BX_KVP70_mAs3.19_IE112.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:08,033 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:08,189 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:08,190 - pacs_operations - INFO - ÉXITO: Img38_SN1938BX_KVP70_mAs20.02_IE931.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:08,190 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:09,357 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:09,369 - pacs_operations - INFO - ÉXITO: Img34_SN1938BX_KVP70_mAs3.19_IE111.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:09,370 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:14,536 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:14,536 - pacs_operations - INFO - ÉXITO: Img36_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:14,537 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:14,592 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:14,594 - pacs_operations - INFO - ÉXITO: Img27_SN1938BX_KVP70_mAs4.99_IE233.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:14,595 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:14,606 - pynetdicom._handlers - INFO - Received Store Response (Status: 0x0000 - Success)
2025-07-07 11:18:14,608 - pacs_operations - INFO - ÉXITO: Img37_SN1938BX_KVP70_mAs20.02_IE930.dcm enviado correctamente a PACS. Estado: 0x0000
2025-07-07 11:18:14,609 - pynetdicom.association - INFO - Releasing Association
2025-07-07 11:18:14,627 - pacs_operations - INFO - Resultado del envío masivo a PACS desde /home/aotal/github/pacs/output_processed_dicom: 14 de 14 exitosos, 0 de 14 fallidos.
2025-07-07 11:18:14,627 - __main__ - INFO - Todos los ficheros procesados enviados a PACS exitosamente.
2025-07-07 11:18:14,628 - __main__ - INFO - ===== FIN DEL WORKFLOW DE PROCESAMIENTO DICOM (CON BAML MAPEADO Y SOBRESCRITO) =====
2025-07-07 11:18:14,682 - __main__ - INFO - Aplicación finalizada.
